"use strict";(self.webpackChunkskote=self.webpackChunkskote||[]).push([[328],{4328:(U,u,l)=>{l.r(u),l.d(u,{ClientPortalModule:()=>B});var c=l(177),r=l(9417),p=l(803),e=l(4438);function h(s,i){if(1&s){const t=e.RV6();e.j41(0,"tr")(1,"td")(2,"div",25),e.nrm(3,"i",26),e.EFF(4),e.k0s()(),e.j41(5,"td"),e.EFF(6),e.k0s(),e.j41(7,"td"),e.EFF(8),e.k0s(),e.j41(9,"td"),e.EFF(10),e.nI1(11,"date"),e.k0s(),e.j41(12,"td")(13,"span"),e.EFF(14),e.nI1(15,"titlecase"),e.k0s()(),e.j41(16,"td")(17,"button",27),e.bIt("click",function(){const n=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.downloadDocument(n))}),e.nrm(18,"i",28),e.k0s()()()}if(2&s){const t=i.$implicit,o=e.XpG();e.R7$(4),e.SpI(" ",t.name," "),e.R7$(2),e.JRh(t.type),e.R7$(2),e.JRh(t.size),e.R7$(2),e.JRh(e.i5U(11,7,t.uploadDate,"shortDate")),e.R7$(3),e.HbH(o.getStatusClass(t.status)),e.R7$(),e.SpI(" ",e.bMT(15,10,t.status)," ")}}function g(s,i){1&s&&(e.j41(0,"tr")(1,"td",29),e.EFF(2," No documents found matching your criteria. "),e.k0s()())}let f=(()=>{class s{constructor(){this.documents=[],this.filteredDocuments=[],this.selectedCategory="all",this.searchTerm=""}ngOnInit(){this.loadDocuments()}loadDocuments(){this.documents=[{id:1,name:"W2_2024.pdf",type:"PDF",size:"245 KB",uploadDate:"2024-01-15",status:"approved",category:"tax-documents"},{id:2,name:"Bank_Statement_Jan2024.pdf",type:"PDF",size:"1.2 MB",uploadDate:"2024-02-01",status:"reviewed",category:"financial-statements"},{id:3,name:"Receipt_Office_Supplies.jpg",type:"Image",size:"890 KB",uploadDate:"2024-02-10",status:"pending",category:"receipts"}],this.filteredDocuments=[...this.documents]}filterDocuments(){this.filteredDocuments=this.documents.filter(t=>{const o="all"===this.selectedCategory||t.category===this.selectedCategory,n=t.name.toLowerCase().includes(this.searchTerm.toLowerCase());return o&&n})}onCategoryChange(){this.filterDocuments()}onSearchChange(){this.filterDocuments()}getStatusClass(t){switch(t){case"approved":return"badge bg-success";case"reviewed":return"badge bg-info";case"pending":return"badge bg-warning";default:return"badge bg-secondary"}}downloadDocument(t){console.log("Downloading document:",t.name)}uploadDocument(){console.log("Upload document functionality")}static{this.\u0275fac=function(o){return new(o||s)}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-documents"]],decls:58,vars:4,consts:[[1,"card"],[1,"card-body"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"card-title","mb-0"],["type","button",1,"btn","btn-primary",3,"click"],[1,"ri-upload-cloud-line","me-1"],[1,"row","mb-4"],[1,"col-md-6"],["for","categoryFilter",1,"form-label"],["id","categoryFilter",1,"form-select",3,"ngModelChange","change","ngModel"],["value","all"],["value","tax-documents"],["value","financial-statements"],["value","receipts"],["value","other"],["for","searchInput",1,"form-label"],["type","text","id","searchInput","placeholder","Search by document name...",1,"form-control",3,"ngModelChange","input","ngModel"],[1,"table-responsive"],[1,"table","table-nowrap","table-hover"],[1,"table-light"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"alert","alert-info","mt-4"],[1,"alert-heading"],[1,"mb-0"],[1,"d-flex","align-items-center"],[1,"ri-file-text-line","me-2","text-muted"],["type","button",1,"btn","btn-sm","btn-outline-primary",3,"click"],[1,"ri-download-line"],["colspan","6",1,"text-center","text-muted","py-4"]],template:function(o,n){1&o&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4",3),e.EFF(4,"Documents"),e.k0s(),e.j41(5,"button",4),e.bIt("click",function(){return n.uploadDocument()}),e.nrm(6,"i",5),e.EFF(7,"Upload Document "),e.k0s()(),e.j41(8,"div",6)(9,"div",7)(10,"label",8),e.EFF(11,"Filter by Category"),e.k0s(),e.j41(12,"select",9),e.mxI("ngModelChange",function(d){return e.DH7(n.selectedCategory,d)||(n.selectedCategory=d),d}),e.bIt("change",function(){return n.onCategoryChange()}),e.j41(13,"option",10),e.EFF(14,"All Categories"),e.k0s(),e.j41(15,"option",11),e.EFF(16,"Tax Documents"),e.k0s(),e.j41(17,"option",12),e.EFF(18,"Financial Statements"),e.k0s(),e.j41(19,"option",13),e.EFF(20,"Receipts"),e.k0s(),e.j41(21,"option",14),e.EFF(22,"Other"),e.k0s()()(),e.j41(23,"div",7)(24,"label",15),e.EFF(25,"Search Documents"),e.k0s(),e.j41(26,"input",16),e.mxI("ngModelChange",function(d){return e.DH7(n.searchTerm,d)||(n.searchTerm=d),d}),e.bIt("input",function(){return n.onSearchChange()}),e.k0s()()(),e.j41(27,"div",17)(28,"table",18)(29,"thead",19)(30,"tr")(31,"th"),e.EFF(32,"Document Name"),e.k0s(),e.j41(33,"th"),e.EFF(34,"Type"),e.k0s(),e.j41(35,"th"),e.EFF(36,"Size"),e.k0s(),e.j41(37,"th"),e.EFF(38,"Upload Date"),e.k0s(),e.j41(39,"th"),e.EFF(40,"Status"),e.k0s(),e.j41(41,"th"),e.EFF(42,"Actions"),e.k0s()()(),e.j41(43,"tbody"),e.DNE(44,h,19,12,"tr",20)(45,g,3,0,"tr",21),e.k0s()()(),e.j41(46,"div",22)(47,"h6",23),e.EFF(48,"Upload Guidelines:"),e.k0s(),e.j41(49,"ul",24)(50,"li"),e.EFF(51,"Accepted formats: PDF, JPG, PNG, DOC, DOCX"),e.k0s(),e.j41(52,"li"),e.EFF(53,"Maximum file size: 10MB"),e.k0s(),e.j41(54,"li"),e.EFF(55,"Please organize documents by category for easier processing"),e.k0s(),e.j41(56,"li"),e.EFF(57,"Uploaded documents will be reviewed within 1-2 business days"),e.k0s()()()()()),2&o&&(e.R7$(12),e.R50("ngModel",n.selectedCategory),e.R7$(14),e.R50("ngModel",n.searchTerm),e.R7$(18),e.Y8G("ngForOf",n.filteredDocuments),e.R7$(),e.Y8G("ngIf",0===n.filteredDocuments.length))},dependencies:[c.Sq,c.bT,r.xH,r.y7,r.me,r.wz,r.BC,r.vS,c.PV,c.vh],styles:[".table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:600;border-top:none}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}.btn-sm[_ngcontent-%COMP%]{padding:.25rem .5rem}.alert-info[_ngcontent-%COMP%]{border-left:4px solid #17a2b8}.card-title[_ngcontent-%COMP%]{font-weight:600}"]})}}return s})();function b(s,i){1&s&&(e.j41(0,"span"),e.nrm(1,"i",20),e.EFF(2,"Completed "),e.k0s())}function F(s,i){1&s&&(e.j41(0,"span"),e.nrm(1,"i",21),e.EFF(2,"Continue "),e.k0s())}function C(s,i){1&s&&(e.j41(0,"span"),e.nrm(1,"i",22),e.EFF(2,"Start Form "),e.k0s())}function y(s,i){if(1&s){const t=e.RV6();e.j41(0,"div",8)(1,"div",9)(2,"div",1)(3,"div",10),e.nrm(4,"i",11),e.j41(5,"span"),e.EFF(6),e.nI1(7,"titlecase"),e.nI1(8,"replace"),e.k0s()(),e.j41(9,"h5",12),e.EFF(10),e.k0s(),e.j41(11,"p",13),e.EFF(12),e.k0s(),e.j41(13,"div",14)(14,"small",15),e.nrm(15,"i",16),e.EFF(16),e.nI1(17,"date"),e.k0s(),e.nrm(18,"br"),e.j41(19,"small",15),e.nrm(20,"i",17),e.EFF(21),e.k0s()(),e.j41(22,"button",18),e.bIt("click",function(){const n=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.openForm(n))}),e.DNE(23,b,3,0,"span",19)(24,F,3,0,"span",19)(25,C,3,0,"span",19),e.k0s()()()()}if(2&s){const t=i.$implicit,o=e.XpG();e.R7$(),e.AVh("border-success","completed"===t.status)("border-warning","in-progress"===t.status),e.R7$(3),e.HbH(o.getStatusIcon(t.status)),e.R7$(),e.HbH(o.getStatusClass(t.status)),e.R7$(),e.JRh(e.brH(8,19,e.bMT(7,17,t.status),"-"," ")),e.R7$(4),e.JRh(t.title),e.R7$(2),e.JRh(t.description),e.R7$(4),e.SpI(" Due: ",e.i5U(17,23,t.dueDate,"shortDate")," "),e.R7$(5),e.SpI(" ",t.category," "),e.R7$(),e.Y8G("disabled","completed"===t.status),e.R7$(),e.Y8G("ngIf","completed"===t.status),e.R7$(),e.Y8G("ngIf","in-progress"===t.status),e.R7$(),e.Y8G("ngIf","not-started"===t.status)}}function k(s,i){if(1&s){const t=e.RV6();e.j41(0,"div",23)(1,"div",24)(2,"div",25)(3,"div",26)(4,"h5",27),e.EFF(5),e.k0s(),e.j41(6,"button",28),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.closeForm())}),e.k0s()(),e.j41(7,"div",29)(8,"form",30)(9,"div",4)(10,"div",31)(11,"label",32),e.EFF(12,"Business Name *"),e.k0s(),e.nrm(13,"input",33),e.k0s(),e.j41(14,"div",31)(15,"label",34),e.EFF(16,"Business Type *"),e.k0s(),e.j41(17,"select",35)(18,"option",36),e.EFF(19,"Select Business Type"),e.k0s(),e.j41(20,"option",37),e.EFF(21,"LLC"),e.k0s(),e.j41(22,"option",38),e.EFF(23,"Corporation"),e.k0s(),e.j41(24,"option",39),e.EFF(25,"Partnership"),e.k0s(),e.j41(26,"option",40),e.EFF(27,"Sole Proprietorship"),e.k0s()()()(),e.j41(28,"div",4)(29,"div",31)(30,"label",41),e.EFF(31,"Tax ID (EIN) *"),e.k0s(),e.nrm(32,"input",42),e.k0s(),e.j41(33,"div",31)(34,"label",43),e.EFF(35,"Phone Number *"),e.k0s(),e.nrm(36,"input",44),e.k0s()(),e.j41(37,"div",14)(38,"label",45),e.EFF(39,"Business Address *"),e.k0s(),e.nrm(40,"textarea",46),e.k0s(),e.j41(41,"div",4)(42,"div",31)(43,"label",47),e.EFF(44,"Email Address *"),e.k0s(),e.nrm(45,"input",48),e.k0s(),e.j41(46,"div",31)(47,"label",49),e.EFF(48,"Annual Revenue"),e.k0s(),e.nrm(49,"input",50),e.k0s()(),e.j41(50,"div",4)(51,"div",31)(52,"label",51),e.EFF(53,"Number of Employees"),e.k0s(),e.nrm(54,"input",52),e.k0s()(),e.j41(55,"div",14)(56,"label",53),e.EFF(57,"Business Description"),e.k0s(),e.nrm(58,"textarea",54),e.k0s()()(),e.j41(59,"div",55)(60,"button",56),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.closeForm())}),e.EFF(61,"Cancel"),e.k0s(),e.j41(62,"button",57),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.saveForm())}),e.EFF(63,"Save Draft"),e.k0s(),e.j41(64,"button",58),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.submitForm())}),e.EFF(65,"Submit Form"),e.k0s()()()()()}if(2&s){const t=e.XpG();e.xc7("display",t.showFormModal?"block":"none"),e.AVh("show",t.showFormModal),e.R7$(5),e.JRh(null==t.selectedForm?null:t.selectedForm.title),e.R7$(3),e.Y8G("formGroup",t.currentForm),e.R7$(54),e.Y8G("disabled",!t.currentForm.valid),e.R7$(2),e.Y8G("disabled",!t.currentForm.valid)}}function v(s,i){if(1&s&&e.nrm(0,"div",59),2&s){const t=e.XpG();e.AVh("show",t.showFormModal)}}let _=(()=>{class s{constructor(t){this.fb=t,this.intakeForms=[],this.selectedForm=null,this.showFormModal=!1,this.currentForm=this.fb.group({businessName:["",r.k0.required],businessType:["",r.k0.required],taxId:["",r.k0.required],address:["",r.k0.required],phone:["",r.k0.required],email:["",[r.k0.required,r.k0.email]],annualRevenue:[""],numberOfEmployees:[""],businessDescription:[""]})}ngOnInit(){this.loadIntakeForms()}loadIntakeForms(){this.intakeForms=[{id:1,title:"Business Information Form",description:"Basic business details and contact information",status:"completed",dueDate:"2024-01-15",category:"Business Setup"},{id:2,title:"Tax Preparation Questionnaire",description:"Annual tax preparation information and documentation requirements",status:"in-progress",dueDate:"2024-03-15",category:"Tax Preparation"},{id:3,title:"Bookkeeping Services Setup",description:"Monthly bookkeeping service preferences and requirements",status:"not-started",dueDate:"2024-02-28",category:"Bookkeeping"}]}getStatusClass(t){switch(t){case"completed":return"badge bg-success";case"in-progress":return"badge bg-warning";default:return"badge bg-secondary"}}getStatusIcon(t){switch(t){case"completed":return"ri-check-line";case"in-progress":return"ri-time-line";default:return"ri-file-list-line"}}openForm(t){this.selectedForm=t,this.showFormModal=!0,1===t.id&&this.currentForm.patchValue({businessName:"Sample Business LLC",businessType:"LLC",taxId:"12-3456789",address:"123 Main St, City, State 12345",phone:"(555) 123-4567",email:"business@example.com",annualRevenue:"500000",numberOfEmployees:"5",businessDescription:"Professional services company"})}closeForm(){this.showFormModal=!1,this.selectedForm=null}saveForm(){this.currentForm.valid&&this.selectedForm&&(console.log("Saving form data:",this.currentForm.value),this.selectedForm.status="in-progress",this.closeForm())}submitForm(){this.currentForm.valid&&this.selectedForm&&(console.log("Submitting form data:",this.currentForm.value),this.selectedForm.status="completed",this.closeForm())}static{this.\u0275fac=function(o){return new(o||s)(e.rXU(r.ok))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-intake"]],decls:10,vars:3,consts:[[1,"card"],[1,"card-body"],[1,"card-title","mb-4"],[1,"text-muted","mb-4"],[1,"row"],["class","col-lg-4 col-md-6 mb-4",4,"ngFor","ngForOf"],["class","modal fade","tabindex","-1",3,"show","display",4,"ngIf"],["class","modal-backdrop fade",3,"show",4,"ngIf"],[1,"col-lg-4","col-md-6","mb-4"],[1,"card","border","h-100"],[1,"d-flex","justify-content-between","align-items-start","mb-3"],[1,"font-size-24","text-primary"],[1,"card-title"],[1,"card-text","text-muted"],[1,"mb-3"],[1,"text-muted"],[1,"ri-calendar-line","me-1"],[1,"ri-folder-line","me-1"],["type","button",1,"btn","btn-primary","btn-sm",3,"click","disabled"],[4,"ngIf"],[1,"ri-check-line","me-1"],[1,"ri-edit-line","me-1"],[1,"ri-play-line","me-1"],["tabindex","-1",1,"modal","fade"],[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[3,"formGroup"],[1,"col-md-6","mb-3"],["for","businessName",1,"form-label"],["type","text","id","businessName","formControlName","businessName",1,"form-control"],["for","businessType",1,"form-label"],["id","businessType","formControlName","businessType",1,"form-select"],["value",""],["value","LLC"],["value","Corporation"],["value","Partnership"],["value","Sole Proprietorship"],["for","taxId",1,"form-label"],["type","text","id","taxId","formControlName","taxId",1,"form-control"],["for","phone",1,"form-label"],["type","tel","id","phone","formControlName","phone",1,"form-control"],["for","address",1,"form-label"],["id","address","rows","2","formControlName","address",1,"form-control"],["for","email",1,"form-label"],["type","email","id","email","formControlName","email",1,"form-control"],["for","annualRevenue",1,"form-label"],["type","number","id","annualRevenue","formControlName","annualRevenue",1,"form-control"],["for","numberOfEmployees",1,"form-label"],["type","number","id","numberOfEmployees","formControlName","numberOfEmployees",1,"form-control"],["for","businessDescription",1,"form-label"],["id","businessDescription","rows","3","formControlName","businessDescription",1,"form-control"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-outline-primary",3,"click","disabled"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"modal-backdrop","fade"]],template:function(o,n){1&o&&(e.j41(0,"div",0)(1,"div",1)(2,"h4",2),e.EFF(3,"Intake Forms"),e.k0s(),e.j41(4,"p",3),e.EFF(5,"Complete the required forms below to help us serve you better. Click on any form to get started."),e.k0s(),e.j41(6,"div",4),e.DNE(7,y,26,26,"div",5),e.k0s()()(),e.DNE(8,k,66,8,"div",6)(9,v,1,2,"div",7)),2&o&&(e.R7$(7),e.Y8G("ngForOf",n.intakeForms),e.R7$(),e.Y8G("ngIf",n.showFormModal),e.R7$(),e.Y8G("ngIf",n.showFormModal))},dependencies:[c.Sq,c.bT,r.qT,r.xH,r.y7,r.me,r.Q0,r.wz,r.BC,r.cb,r.j4,r.JD,c.PV,c.vh],styles:[".card.border-success[_ngcontent-%COMP%]{border-color:#28a745!important}.card.border-warning[_ngcontent-%COMP%]{border-color:#ffc107!important}.card-title[_ngcontent-%COMP%]{font-weight:600}.modal.show[_ngcontent-%COMP%]{background-color:#00000080}.modal-backdrop.show[_ngcontent-%COMP%]{opacity:.5}.btn-sm[_ngcontent-%COMP%]{padding:.375rem .75rem}.form-label[_ngcontent-%COMP%]{font-weight:500}"]})}}return s})();var I=l(5538);const M=["messagesContainer"];function T(s,i){if(1&s&&(e.j41(0,"div",36)(1,"small",37),e.EFF(2),e.k0s()()),2&s){const t=e.XpG().$implicit,o=e.XpG();e.R7$(2),e.JRh(o.formatDate(t.timestamp))}}function x(s,i){1&s&&e.nrm(0,"i",42)}function j(s,i){1&s&&e.nrm(0,"i",43)}function E(s,i){if(1&s&&(e.j41(0,"div",38)(1,"div",39),e.DNE(2,x,1,0,"i",40)(3,j,1,0,"i",41),e.k0s()()),2&s){const t=e.XpG().$implicit,o=e.XpG();e.R7$(),e.AVh("bg-primary","ACCOUNTANT"===t.senderType)("bg-info",o.isAIMessage(t)),e.R7$(),e.Y8G("ngIf","ACCOUNTANT"===t.senderType),e.R7$(),e.Y8G("ngIf",o.isAIMessage(t))}}function D(s,i){1&s&&(e.j41(0,"div",44)(1,"div",45),e.nrm(2,"i",42),e.k0s()())}function w(s,i){if(1&s&&(e.j41(0,"div"),e.DNE(1,T,3,1,"div",26),e.j41(2,"div",27)(3,"div",28),e.DNE(4,E,4,6,"div",29),e.j41(5,"div",30)(6,"div",31)(7,"small",32),e.EFF(8),e.k0s(),e.j41(9,"small",33),e.EFF(10),e.k0s()(),e.j41(11,"div",34),e.EFF(12),e.k0s()(),e.DNE(13,D,3,0,"div",35),e.k0s()()()),2&s){const t=i.$implicit,o=i.index,n=e.XpG();e.R7$(),e.Y8G("ngIf",n.shouldShowDateSeparator(o)),e.R7$(),e.AVh("justify-content-end",n.isMyMessage(t)),e.R7$(),e.AVh("client-message",n.isMyMessage(t))("accountant-message","ACCOUNTANT"===t.senderType)("ai-message",n.isAIMessage(t)),e.R7$(),e.Y8G("ngIf",!n.isMyMessage(t)),e.R7$(),e.AVh("client-content",n.isMyMessage(t))("accountant-content","ACCOUNTANT"===t.senderType)("ai-content",n.isAIMessage(t)),e.R7$(3),e.JRh(t.senderName),e.R7$(2),e.JRh(n.formatTime(t.timestamp)),e.R7$(2),e.SpI(" ",t.content," "),e.R7$(),e.Y8G("ngIf",n.isMyMessage(t))}}function R(s,i){1&s&&(e.j41(0,"div",46)(1,"div",47)(2,"span",48),e.EFF(3,"Loading..."),e.k0s()(),e.j41(4,"small",33),e.EFF(5,"Loading messages..."),e.k0s()())}const N=[{path:"",redirectTo:"dashboard",pathMatch:"full"},{path:"dashboard",loadComponent:()=>l.e(796).then(l.bind(l,8796)).then(s=>s.ClientDashboardComponent)},{path:"documents",component:f},{path:"intake",component:_},{path:"chat",component:(()=>{class s{constructor(t){this.chatService=t,this.messages=[],this.newMessage="",this.currentThread=null,this.isLoading=!1,this.subscriptions=[],this.currentUser=this.chatService.getCurrentUser()}ngOnInit(){this.loadMessages()}ngAfterViewChecked(){this.scrollToBottom()}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe())}loadMessages(){this.isLoading=!0;const o=this.chatService.getThread(this.currentUser?.id||1).subscribe({next:n=>{this.currentThread=n.thread,this.messages=n.messages,this.isLoading=!1},error:n=>{console.error("Error loading messages:",n),this.isLoading=!1,this.loadMockMessages()}});this.subscriptions.push(o)}loadMockMessages(){this.messages=[{content:"Hello! Welcome to our chat system. How can I help you today?",senderId:1,senderName:"Sarah Johnson, CPA",senderType:"ACCOUNTANT",timestamp:new Date("2024-02-10T09:00:00"),threadId:1},{content:"Hi Sarah! I have a question about my quarterly tax payments.",senderId:this.currentUser?.id||2,senderName:"You",senderType:"CLIENT",timestamp:new Date("2024-02-10T09:15:00"),threadId:1},{content:"Of course! I'd be happy to help with your quarterly payments. What specific question do you have?",senderId:1,senderName:"Sarah Johnson, CPA",senderType:"ACCOUNTANT",timestamp:new Date("2024-02-10T09:16:00"),threadId:1}]}sendMessage(){if(this.newMessage.trim()&&this.currentThread){const t={content:this.newMessage.trim(),senderType:"CLIENT"},n=this.chatService.sendMessage(this.currentUser?.id||1,t).subscribe({next:a=>{this.messages.push(a),this.newMessage="",this.scrollToBottom(),t.content.toLowerCase().includes("@ai")&&this.triggerAIResponse(t.content)},error:a=>{console.error("Error sending message:",a),this.addLocalMessage()}});this.subscriptions.push(n)}}addLocalMessage(){const t={content:this.newMessage.trim(),senderId:this.currentUser?.id||2,senderName:"You",senderType:"CLIENT",timestamp:new Date,threadId:this.currentThread?.id||1};this.messages.push(t),this.newMessage="",setTimeout(()=>{this.simulateAccountantResponse()},2e3)}simulateAccountantResponse(){const t=["Thank you for your message. I'll review this and get back to you shortly.","I understand your concern. Let me look into this for you.","That's a great question. I'll need to check a few things and respond within the hour.","I've received your message and will provide a detailed response soon."],n={content:t[Math.floor(Math.random()*t.length)],senderId:1,senderName:"Sarah Johnson, CPA",senderType:"ACCOUNTANT",timestamp:new Date,threadId:this.currentThread?.id||1};this.messages.push(n)}triggerAIResponse(t){const o=this.chatService.getAIResponse(t).subscribe({next:n=>{this.messages.push({content:n.message,senderId:0,senderName:"Tax AI Agent",senderType:"AI_AGENT",timestamp:new Date,threadId:this.currentThread?.id||1}),this.scrollToBottom()},error:n=>{console.error("Error getting AI response:",n)}});this.subscriptions.push(o)}onKeyPress(t){"Enter"===t.key&&!t.shiftKey&&(t.preventDefault(),this.sendMessage())}scrollToBottom(){try{this.messagesContainer&&(this.messagesContainer.nativeElement.scrollTop=this.messagesContainer.nativeElement.scrollHeight)}catch(t){console.error("Error scrolling to bottom:",t)}}formatTime(t){return new Intl.DateTimeFormat("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}).format(t)}formatDate(t){const o=new Date,n=new Date(t);if(n.toDateString()===o.toDateString())return"Today";const a=new Date(o);return a.setDate(a.getDate()-1),n.toDateString()===a.toDateString()?"Yesterday":n.toLocaleDateString()}shouldShowDateSeparator(t){if(0===t)return!0;const n=this.messages[t-1];return this.messages[t].timestamp.toDateString()!==n.timestamp.toDateString()}isMyMessage(t){return"CLIENT"===t.senderType&&t.senderId===this.currentUser?.id}isAIMessage(t){return"AI_AGENT"===t.senderType}static{this.\u0275fac=function(o){return new(o||s)(e.rXU(I.m))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-chat"]],viewQuery:function(o,n){if(1&o&&e.GBs(M,5),2&o){let a;e.mGM(a=e.lsd())&&(n.messagesContainer=a.first)}},standalone:!0,features:[e.aNF],decls:37,vars:5,consts:[["messagesContainer",""],[1,"card","h-100"],[1,"card-header"],[1,"card-title","mb-0"],[1,"text-muted","mb-0"],[1,"card-body","d-flex","flex-column","p-0",2,"height","600px"],[1,"flex-grow-1","overflow-auto","p-3"],[4,"ngFor","ngForOf"],["class","text-center p-3",4,"ngIf"],[1,"border-top","p-3"],[1,"row","g-2"],[1,"col"],["rows","2","placeholder","Type your message... (Use @ai to get help from Tax AI Agent)",1,"form-control",3,"ngModelChange","keypress","ngModel","disabled"],[1,"col-auto","align-self-end"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"ri-send-plane-line"],[1,"text-muted","mt-1","d-block"],[1,"card","mt-3"],[1,"card-body"],[1,"card-title"],[1,"list-unstyled","mb-0"],[1,"mb-2"],[1,"ri-time-line","text-primary","me-2"],[1,"ri-calendar-line","text-primary","me-2"],[1,"ri-file-line","text-primary","me-2"],[1,"ri-phone-line","text-primary","me-2"],["class","text-center my-3",4,"ngIf"],[1,"d-flex","mb-3"],[1,"message-wrapper"],["class","avatar-sm me-2 flex-shrink-0",4,"ngIf"],[1,"message-content"],[1,"message-header","mb-1"],[1,"text-muted"],[1,"text-muted","ms-2"],[1,"message-body"],["class","avatar-sm ms-2 flex-shrink-0",4,"ngIf"],[1,"text-center","my-3"],[1,"text-muted","bg-light","px-2","py-1","rounded"],[1,"avatar-sm","me-2","flex-shrink-0"],[1,"avatar-title","text-white","rounded-circle"],["class","ri-user-line",4,"ngIf"],["class","ri-robot-line",4,"ngIf"],[1,"ri-user-line"],[1,"ri-robot-line"],[1,"avatar-sm","ms-2","flex-shrink-0"],[1,"avatar-title","bg-success","text-white","rounded-circle"],[1,"text-center","p-3"],["role","status",1,"spinner-border","spinner-border-sm","text-primary"],[1,"visually-hidden"]],template:function(o,n){if(1&o){const a=e.RV6();e.j41(0,"div",1)(1,"div",2)(2,"h4",3),e.EFF(3,"Chat with Your Accountant"),e.k0s(),e.j41(4,"p",4),e.EFF(5,"Get real-time support from your dedicated accounting team"),e.k0s()(),e.j41(6,"div",5)(7,"div",6,0),e.DNE(9,w,14,20,"div",7),e.k0s(),e.DNE(10,R,6,0,"div",8),e.j41(11,"div",9)(12,"div",10)(13,"div",11)(14,"textarea",12),e.mxI("ngModelChange",function(m){return e.eBV(a),e.DH7(n.newMessage,m)||(n.newMessage=m),e.Njj(m)}),e.bIt("keypress",function(m){return e.eBV(a),e.Njj(n.onKeyPress(m))}),e.k0s()(),e.j41(15,"div",13)(16,"button",14),e.bIt("click",function(){return e.eBV(a),e.Njj(n.sendMessage())}),e.nrm(17,"i",15),e.k0s()()(),e.j41(18,"small",16),e.EFF(19,"Press Enter to send, Shift+Enter for new line. Type @ai to get AI assistance."),e.k0s()()()(),e.j41(20,"div",17)(21,"div",18)(22,"h6",19),e.EFF(23,"Chat Guidelines"),e.k0s(),e.j41(24,"ul",20)(25,"li",21),e.nrm(26,"i",22),e.EFF(27,"Response time: Usually within 2-4 hours during business hours"),e.k0s(),e.j41(28,"li",21),e.nrm(29,"i",23),e.EFF(30,"Business hours: Monday-Friday, 9 AM - 6 PM EST"),e.k0s(),e.j41(31,"li",21),e.nrm(32,"i",24),e.EFF(33,"For document sharing, please use the Documents section"),e.k0s(),e.j41(34,"li"),e.nrm(35,"i",25),e.EFF(36,"For urgent matters, please call: (555) 123-4567"),e.k0s()()()()}2&o&&(e.R7$(9),e.Y8G("ngForOf",n.messages),e.R7$(),e.Y8G("ngIf",n.isLoading),e.R7$(4),e.R50("ngModel",n.newMessage),e.Y8G("disabled",n.isLoading),e.R7$(2),e.Y8G("disabled",!n.newMessage.trim()||n.isLoading))},dependencies:[c.MD,c.Sq,c.bT,r.YN,r.me,r.BC,r.vS],styles:['@charset "UTF-8";.message-wrapper[_ngcontent-%COMP%]{display:flex;align-items:flex-start;max-width:80%}.message-content[_ngcontent-%COMP%]{flex:1}.client-content[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;padding:12px 16px;border-radius:18px 18px 4px;margin-left:8px}.accountant-content[_ngcontent-%COMP%]{background-color:#f8f9fa;color:#495057;padding:12px 16px;border-radius:18px 18px 18px 4px;border:1px solid #e9ecef;margin-right:8px}.ai-content[_ngcontent-%COMP%]{background-color:#e3f2fd;color:#1565c0;padding:12px 16px;border-radius:18px 18px 18px 4px;border:1px solid #bbdefb;margin-right:8px;position:relative}.ai-content[_ngcontent-%COMP%]:before{content:"\\1f916";position:absolute;top:-8px;left:8px;background:#e3f2fd;padding:0 4px;font-size:12px}.client-message[_ngcontent-%COMP%]{margin-left:auto}.accountant-message[_ngcontent-%COMP%], .ai-message[_ngcontent-%COMP%]{margin-right:auto}.message-header[_ngcontent-%COMP%]{font-size:.75rem}.client-content[_ngcontent-%COMP%]   .message-header[_ngcontent-%COMP%]{color:#fffc}.message-body[_ngcontent-%COMP%]{line-height:1.4;word-wrap:break-word}.avatar-title[_ngcontent-%COMP%]{width:2rem;height:2rem;display:flex;align-items:center;justify-content:center;font-size:.875rem}.card-header[_ngcontent-%COMP%]{border-bottom:1px solid #e9ecef}.card-title[_ngcontent-%COMP%]{font-weight:600}textarea.form-control[_ngcontent-%COMP%]{resize:none;border:1px solid #ced4da}textarea.form-control[_ngcontent-%COMP%]:focus{border-color:#556ee6;box-shadow:0 0 0 .2rem #556ee640}.btn-primary[_ngcontent-%COMP%]{background-color:#556ee6;border-color:#556ee6}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#4c63d2;border-color:#4c63d2}']})}}return s})()}];let S=(()=>{class s{static{this.\u0275fac=function(o){return new(o||s)}}static{this.\u0275mod=e.$C({type:s})}static{this.\u0275inj=e.G2t({imports:[p.iI.forChild(N),p.iI]})}}return s})();var O=l(6551),P=l(1745),A=l(8580),G=l(779),$=l(3816);let B=(()=>{class s{static{this.\u0275fac=function(o){return new(o||s)}}static{this.\u0275mod=e.$C({type:s})}static{this.\u0275inj=e.G2t({imports:[c.MD,r.YN,r.X1,S,O.T,P.V,A.zE,G.Q_,$.jr]})}}return s})()}}]);