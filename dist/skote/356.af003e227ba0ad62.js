"use strict";(self.webpackChunkskote=self.webpackChunkskote||[]).push([[356],{6356:(bt,F,l)=>{l.r(F),l.d(F,{ClientPortalModule:()=>_t});var m=l(177),a=l(9417),_=l(803),M=l(8032),u=l.n(M),v=l(1413),y=l(152),j=l(3294);let b=(()=>{class i{static{this.FORM_TAGS={"W-2":{pattern:/\bW-?2\b/i,confidence:.8,category:"tax-documents"},"1099-INT":{pattern:/\b1099-?INT\b/i,confidence:.8,category:"tax-documents"},"1099-DIV":{pattern:/\b1099-?DIV\b/i,confidence:.8,category:"tax-documents"},"1099-NEC":{pattern:/\b1099-?NEC\b/i,confidence:.8,category:"tax-documents"},"1099-MISC":{pattern:/\b1099-?MISC\b/i,confidence:.8,category:"tax-documents"},"1099-R":{pattern:/\b1099-?R\b/i,confidence:.8,category:"tax-documents"},"1099-K":{pattern:/\b1099-?K\b/i,confidence:.8,category:"tax-documents"},1099:{pattern:/\b1099(?!-[A-Z])\b/i,confidence:.6,category:"tax-documents"},1098:{pattern:/\b1098(?!-[A-Z])\b/i,confidence:.7,category:"tax-documents"},"1098-E":{pattern:/\b1098-?E\b/i,confidence:.8,category:"tax-documents"},"1098-T":{pattern:/\b1098-?T\b/i,confidence:.8,category:"tax-documents"},"SSA-1099":{pattern:/\bSSA-?1099\b/i,confidence:.8,category:"tax-documents"},"K-1":{pattern:/\bK-?1\b/i,confidence:.7,category:"tax-documents"},"IRS Notice":{pattern:/\bCP\d{3,4}\b/i,confidence:.7,category:"tax-documents"},Receipt:{pattern:/\b(receipt|invoice|bill)\b/i,confidence:.6,category:"receipts"},"Bank Statement":{pattern:/\b(bank\s+statement|statement)\b/i,confidence:.6,category:"financial-statements"},"Financial Statement":{pattern:/\b(financial\s+statement|balance\s+sheet|income\s+statement)\b/i,confidence:.7,category:"financial-statements"}}}static{this.YEAR_PATTERN=/20(1[6-9]|2[0-9])/g}static{this.GENERIC_TITLES=["scan_01","document","file","untitled","img_","photo"]}static parseTitleForSuggestions(t,n={FILENAME_SUGGESTION:!0,YEAR_PARSE:!0}){if(!n.FILENAME_SUGGESTION||!t||this.isGenericTitle(t))return{confidence:0,source:"title"};const o=t.trim();let s=null,c=null;const d=Object.entries(this.FORM_TAGS).sort((g,f)=>f[0].length+f[1].confidence-(g[0].length+g[1].confidence));for(const[g,f]of d)if(f.pattern.test(o)){s={tag:g,confidence:f.confidence,category:f.category};break}if(n.YEAR_PARSE){const g=o.match(this.YEAR_PATTERN);if(g&&g.length>0){const f=g.map(x=>parseInt(x,10));c=Math.max(...f)}}const p={confidence:s?s.confidence:0,source:"title"};return s&&(p.tag=s.tag,p.category=s.category),c&&(p.year=c),p}static isGenericTitle(t){const n=t.toLowerCase();return this.GENERIC_TITLES.some(o=>n.includes(o))}static formatSuggestionText(t){if(!t.tag&&!t.year)return"";const n=[];t.tag&&n.push(t.tag),t.year&&n.push(`(${t.year})`);const o=Math.round(100*t.confidence);return`${n.join(" ")} \u2022 ${o}%`}static suggestionMatchesForm(t,n,o){return t.category===n&&(!t.year||t.year===o)}static mapSuggestionToFormCategory(t){return t.category?{"tax-documents":"tax-documents","financial-statements":"financial-statements",receipts:"receipts"}[t.category]||"other":""}}return i})();var S=l(5312),e=l(4438);let T=(()=>{class i{constructor(){this.events=[]}track(t,n={}){const o={event:t,payload:n,timestamp:new Date};this.events.push(o),console.log("\u{1f4ca} Analytics Event:",o)}trackDocumentSuggestionShown(t,n,o){this.track("doc_suggestion_shown",{tag:t,year:n,confidence:o})}trackDocumentSuggestionSwitch(t,n,o,s){this.track("doc_suggestion_switch",{fromTag:t,toTag:n,fromYear:o,toYear:s})}trackDocumentSuggestionKept(t,n){this.track("doc_suggestion_kept",{tag:t,year:n})}getEvents(){return[...this.events]}clearEvents(){this.events=[]}sendToAnalyticsProvider(t){}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var C=l(6344),I=l(9386);const P=["uploadModal"];function E(i,r){if(1&i){const t=e.RV6();e.j41(0,"tr")(1,"td")(2,"div",26),e.nrm(3,"i",27),e.EFF(4),e.k0s()(),e.j41(5,"td"),e.EFF(6),e.k0s(),e.j41(7,"td"),e.EFF(8),e.k0s(),e.j41(9,"td"),e.EFF(10),e.nI1(11,"date"),e.k0s(),e.j41(12,"td")(13,"span"),e.EFF(14),e.nI1(15,"titlecase"),e.k0s()(),e.j41(16,"td")(17,"button",28),e.bIt("click",function(){const o=e.eBV(t).$implicit,s=e.XpG();return e.Njj(s.downloadDocument(o))}),e.nrm(18,"i",29),e.k0s()()()}if(2&i){const t=r.$implicit,n=e.XpG();e.R7$(4),e.SpI(" ",t.name," "),e.R7$(2),e.JRh(t.type),e.R7$(2),e.JRh(t.size),e.R7$(2),e.JRh(e.i5U(11,7,t.uploadDate,"shortDate")),e.R7$(3),e.HbH(n.getStatusClass(t.status)),e.R7$(),e.SpI(" ",e.bMT(15,10,t.status)," ")}}function O(i,r){1&i&&(e.j41(0,"tr")(1,"td",30),e.EFF(2," No documents found matching your criteria. "),e.k0s()())}function N(i,r){if(1&i){const t=e.RV6();e.j41(0,"div",59),e.nrm(1,"i",60),e.j41(2,"div",61)(3,"strong"),e.EFF(4,"\u{1f50e} Suggested:"),e.k0s(),e.EFF(5),e.k0s(),e.j41(6,"div",62)(7,"button",63),e.bIt("click",function(){e.eBV(t);const o=e.XpG(3);return e.Njj(o.keepCurrentValues())}),e.EFF(8," Keep "),e.k0s(),e.j41(9,"button",64),e.bIt("click",function(){e.eBV(t);const o=e.XpG(3);return e.Njj(o.applySuggestion())}),e.EFF(10," Switch "),e.k0s()()()}if(2&i){const t=e.XpG(3);e.R7$(5),e.SpI(" ",t.getSuggestionText()," ")}}function D(i,r){if(1&i&&(e.j41(0,"div",65),e.nrm(1,"i",66),e.j41(2,"span")(3,"strong"),e.EFF(4,"\u2713 Confirmed by title:"),e.k0s(),e.EFF(5),e.k0s()()),2&i){const t=e.XpG(3);e.R7$(5),e.SpI(" ",t.getSuggestionText(),"")}}function w(i,r){if(1&i&&(e.j41(0,"div",35)(1,"div",42),e.DNE(2,N,11,1,"div",57)(3,D,6,1,"div",58),e.k0s()()),2&i){const t=e.XpG(2);e.R7$(2),e.Y8G("ngIf",t.showSuggestion),e.R7$(),e.Y8G("ngIf",t.isConfirmedBySuggestion()&&!t.showSuggestion)}}function R(i,r){if(1&i){const t=e.RV6();e.j41(0,"li",70)(1,"div",71)(2,"div",72)(3,"div",73)(4,"div",74),e.nrm(5,"i",75),e.k0s()(),e.j41(6,"div",61)(7,"div",76)(8,"h6",77),e.EFF(9),e.k0s(),e.j41(10,"p",78),e.EFF(11),e.k0s()()(),e.j41(12,"div",79)(13,"button",80),e.bIt("click",function(){const o=e.eBV(t).index,s=e.XpG(3);return e.Njj(s.removeUploadedFile(o))}),e.nrm(14,"i",81),e.k0s()()()()()}if(2&i){const t=r.$implicit,n=e.XpG(3);e.R7$(9),e.JRh(t.name),e.R7$(2),e.JRh(n.formatFileSize(t.size))}}function G(i,r){if(1&i&&(e.j41(0,"div")(1,"h6",67),e.EFF(2,"Selected Files:"),e.k0s(),e.j41(3,"ul",68),e.DNE(4,R,15,2,"li",69),e.k0s()()),2&i){const t=e.XpG(2);e.R7$(4),e.Y8G("ngForOf",t.uploadedFiles)}}function $(i,r){1&i&&e.nrm(0,"span",82)}function A(i,r){if(1&i){const t=e.RV6();e.j41(0,"div",6)(1,"div",31)(2,"div",0)(3,"div",32)(4,"div",33)(5,"h5",3),e.EFF(6,"Upload Document"),e.k0s(),e.j41(7,"button",34),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.closeUploadModal())}),e.k0s()()(),e.j41(8,"div",1)(9,"form")(10,"div",35)(11,"div",36)(12,"label",37),e.EFF(13,"Document Category *"),e.k0s(),e.j41(14,"select",38),e.mxI("ngModelChange",function(o){e.eBV(t);const s=e.XpG();return e.DH7(s.uploadForm.category,o)||(s.uploadForm.category=o),e.Njj(o)}),e.j41(15,"option",39),e.EFF(16,"Select Category"),e.k0s(),e.j41(17,"option",11),e.EFF(18,"Tax Documents"),e.k0s(),e.j41(19,"option",12),e.EFF(20,"Financial Statements"),e.k0s(),e.j41(21,"option",13),e.EFF(22,"Receipts"),e.k0s(),e.j41(23,"option",14),e.EFF(24,"Other"),e.k0s()()(),e.j41(25,"div",36)(26,"label",40),e.EFF(27,"Year (Optional)"),e.k0s(),e.j41(28,"input",41),e.mxI("ngModelChange",function(o){e.eBV(t);const s=e.XpG();return e.DH7(s.uploadForm.year,o)||(s.uploadForm.year=o),e.Njj(o)}),e.k0s()()(),e.j41(29,"div",35)(30,"div",42)(31,"label",43),e.EFF(32,"Document Title *"),e.k0s(),e.j41(33,"input",44),e.mxI("ngModelChange",function(o){e.eBV(t);const s=e.XpG();return e.DH7(s.uploadForm.title,o)||(s.uploadForm.title=o),e.Njj(o)}),e.bIt("input",function(o){e.eBV(t);const s=e.XpG();return e.Njj(s.onTitleChange(o.target.value))}),e.k0s(),e.j41(34,"div",45)(35,"small",46),e.EFF(36,"Enter a descriptive title separate from the filename. This helps with organization and suggestions."),e.k0s()()()(),e.DNE(37,w,4,2,"div",47),e.j41(38,"div",35)(39,"div",42)(40,"label",48),e.EFF(41,"Description (Optional)"),e.k0s(),e.j41(42,"textarea",49),e.mxI("ngModelChange",function(o){e.eBV(t);const s=e.XpG();return e.DH7(s.uploadForm.description,o)||(s.uploadForm.description=o),e.Njj(o)}),e.k0s()()(),e.j41(43,"div",50)(44,"label",51),e.EFF(45,"Upload Files"),e.k0s(),e.j41(46,"dropzone",52),e.bIt("success",function(o){e.eBV(t);const s=e.XpG();return e.Njj(s.onUploadSuccess(o))}),e.k0s(),e.DNE(47,G,5,1,"div",21),e.k0s()(),e.j41(48,"div",53)(49,"button",54),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.closeUploadModal())}),e.EFF(50,"Cancel"),e.k0s(),e.j41(51,"button",55),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.submitUpload())}),e.DNE(52,$,1,0,"span",56),e.EFF(53),e.k0s()()()()()()}if(2&i){const t=e.XpG();e.R7$(14),e.R50("ngModel",t.uploadForm.category),e.R7$(14),e.R50("ngModel",t.uploadForm.year),e.R7$(5),e.R50("ngModel",t.uploadForm.title),e.R7$(4),e.Y8G("ngIf",t.showSuggestion||t.isConfirmedBySuggestion()),e.R7$(5),e.R50("ngModel",t.uploadForm.description),e.R7$(4),e.Y8G("config",t.dropzoneConfig)("message","Drop files here or click to upload."),e.R7$(),e.Y8G("ngIf",t.uploadedFiles.length>0),e.R7$(4),e.Y8G("disabled",0===t.uploadedFiles.length||!t.uploadForm.category||!t.uploadForm.title||t.isUploading),e.R7$(),e.Y8G("ngIf",t.isUploading),e.R7$(),e.SpI(" ",t.isUploading?"Uploading...":"Upload "+t.uploadedFiles.length+" File(s)"," ")}}let Y=(()=>{class i{constructor(t,n){this.analyticsService=t,this.apiService=n,this.documents=[],this.filteredDocuments=[],this.selectedCategory="all",this.searchTerm="",this.clientId=0,this.selectedFile=null,this.isUploading=!1,this.showUploadModal=!1,this.uploadedFiles=[],this.uploadForm={category:"",description:"",title:"",year:null},this.currentSuggestion=null,this.showSuggestion=!1,this.titleSubject=new v.B,this.suggestionConfig=S.c.documentSuggestions,this.dropzoneConfig={url:"/upload",clickable:!0,addRemoveLinks:!1,previewsContainer:!1,acceptedFiles:".pdf,.jpg,.jpeg,.png,.doc,.docx",maxFilesize:10,maxFiles:10,autoProcessQueue:!1},this.titleSubject.pipe((0,y.B)(200),(0,j.F)()).subscribe(o=>{this.parseTitleForSuggestions(o)})}ngOnInit(){this.initializeClientData(),this.loadDocuments()}initializeClientData(){this.currentUser=this.getCurrentUser(),this.clientId=this.getCurrentUserClientId(),console.log("\u{1f4c4} Documents Component initialized with client ID:",this.clientId)}getCurrentUser(){const t=localStorage.getItem("currentUser");return t?JSON.parse(t):null}getCurrentUserClientId(){try{const t=localStorage.getItem("authToken");if(t){const n=JSON.parse(atob(t.split(".")[1]));return n.userId||n.id||this.currentUser?.id||0}}catch(t){console.error("Error extracting user ID from JWT:",t)}return this.currentUser?.id||0}showErrorMessage(t){u().fire({title:"Error",text:t,icon:"error",confirmButtonText:"OK"})}loadDocuments(){if(!this.clientId)return console.error("\u274c No client ID available for loading documents"),this.documents=[],void this.filterDocuments();console.log("\u{1f4cb} Loading documents for client ID:",this.clientId),this.apiService.getClientDocuments(this.clientId).subscribe({next:t=>{t.success?(this.documents=t.documents.map(n=>({id:n.id,name:n.filename,type:this.getFileTypeFromMimeType(n.mimeType),size:this.formatFileSize(n.sizeBytes),uploadDate:new Date(n.uploadedAt).toLocaleDateString(),status:n.required?"approved":"pending",category:n.tag})),console.log("\u2705 Documents loaded:",this.documents.length),this.filterDocuments()):(console.error("\u274c Failed to load documents:",t),this.showErrorMessage("Failed to load documents"),this.documents=[],this.filterDocuments())},error:t=>{console.error("\u274c Error loading documents:",t),this.showErrorMessage("Error loading documents. Please try again."),this.documents=[],this.filterDocuments()}})}getFileTypeFromMimeType(t){return t.includes("pdf")?"PDF":t.includes("image")?"Image":t.includes("word")||t.includes("document")?"Document":"File"}filterDocuments(){this.filteredDocuments=this.documents.filter(t=>{const n="all"===this.selectedCategory||t.category===this.selectedCategory,o=t.name.toLowerCase().includes(this.searchTerm.toLowerCase());return n&&o})}onCategoryChange(){this.filterDocuments()}onSearchChange(){this.filterDocuments()}getStatusClass(t){switch(t){case"approved":return"badge bg-success";case"reviewed":return"badge bg-info";case"pending":return"badge bg-warning";default:return"badge bg-secondary"}}downloadDocument(t){console.log("\u{1f4e5} Downloading document:",t.name),this.apiService.downloadDocument(t.id).subscribe({next:n=>{const o=window.URL.createObjectURL(n),s=document.createElement("a");s.href=o,s.download=t.name,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(o),console.log("\u2705 Document downloaded successfully")},error:n=>{console.error("\u274c Download error:",n),this.showErrorMessage("Failed to download document. Please try again.")}})}uploadDocument(){this.selectedFile=null,this.uploadForm={category:"",description:"",title:"",year:null},this.currentSuggestion=null,this.showSuggestion=!1,this.showUploadModal=!0}closeUploadModal(){this.showUploadModal=!1}onUploadSuccess(t){setTimeout(()=>{this.uploadedFiles.push(t[0])},0)}removeUploadedFile(t){this.uploadedFiles.splice(t,1)}formatFileSize(t){if(0===t)return"0 Bytes";const s=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]}submitUpload(){if(0===this.uploadedFiles.length||!this.uploadForm.category||!this.uploadForm.title)return;if(!this.clientId)return void this.showErrorMessage("Client ID not available. Please refresh and try again.");this.isUploading=!0;const t=this.currentSuggestion?{tag:this.currentSuggestion.tag,year:this.currentSuggestion.year,confidence:this.currentSuggestion.confidence,source:this.currentSuggestion.source}:null;console.log("\u{1f4e4} Uploading documents for client ID:",this.clientId),console.log("\u{1f4cb} Upload form data:",this.uploadForm),console.log("\u{1f4a1} UI suggestion:",t);const n=this.uploadedFiles.map(o=>this.apiService.uploadClientDocument(this.clientId,o,this.uploadForm.title,this.uploadForm.category,this.uploadForm.year,this.uploadForm.description,t).toPromise());Promise.all(n).then(o=>{if(console.log("\u2705 All uploads completed:",o),o.every(c=>c?.success))this.loadDocuments(),this.uploadedFiles=[],this.uploadForm={category:"",description:"",title:"",year:null},this.currentSuggestion=null,this.showSuggestion=!1,this.showUploadModal=!1,u().fire({title:"Upload Successful!",text:`${o.length} document(s) uploaded successfully and are pending review.`,icon:"success",timer:3e3,showConfirmButton:!1});else{const c=o.filter(d=>!d?.success).length;this.showErrorMessage(`${c} out of ${o.length} uploads failed. Please try again.`)}this.isUploading=!1}).catch(o=>{console.error("\u274c Upload error:",o),this.showErrorMessage("Upload failed. Please check your connection and try again."),this.isUploading=!1})}getFileTypeDisplay(t){switch(t){case"application/pdf":return"PDF";case"image/jpeg":case"image/jpg":case"image/png":return"Image";case"application/msword":case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":return"Document";default:return"File"}}onTitleChange(t){this.uploadForm.title=t,this.titleSubject.next(t)}parseTitleForSuggestions(t){const n=b.parseTitleForSuggestions(t,this.suggestionConfig);n.confidence>0?(this.currentSuggestion=n,this.showSuggestion=!this.suggestionMatchesCurrentForm(n),this.analyticsService.trackDocumentSuggestionShown(n.tag,n.year,n.confidence)):(this.currentSuggestion=null,this.showSuggestion=!1)}suggestionMatchesCurrentForm(t){return b.suggestionMatchesForm(t,this.uploadForm.category,this.uploadForm.year)}applySuggestion(){if(!this.currentSuggestion)return;const t=this.uploadForm.category,n=this.uploadForm.year;this.currentSuggestion.category&&(this.uploadForm.category=b.mapSuggestionToFormCategory(this.currentSuggestion)),this.currentSuggestion.year&&(this.uploadForm.year=this.currentSuggestion.year),this.analyticsService.trackDocumentSuggestionSwitch(t,this.uploadForm.category,n,this.uploadForm.year),this.showSuggestion=!1}keepCurrentValues(){this.currentSuggestion&&(this.analyticsService.trackDocumentSuggestionKept(this.currentSuggestion.tag,this.currentSuggestion.year),this.showSuggestion=!1)}getSuggestionText(){return this.currentSuggestion?b.formatSuggestionText(this.currentSuggestion):""}isConfirmedBySuggestion(){return!!this.currentSuggestion&&this.suggestionMatchesCurrentForm(this.currentSuggestion)}static{this.\u0275fac=function(n){return new(n||i)(e.rXU(T),e.rXU(C.G))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-documents"]],viewQuery:function(n,o){if(1&n&&e.GBs(P,5),2&n){let s;e.mGM(s=e.lsd())&&(o.uploadModal=s.first)}},decls:59,vars:5,consts:[[1,"card"],[1,"card-body"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"card-title","mb-0"],["type","button",1,"btn","btn-primary",3,"click"],[1,"ri-upload-cloud-line","me-1"],[1,"row","mb-4"],[1,"col-md-6"],["for","categoryFilter",1,"form-label"],["id","categoryFilter",1,"form-select",3,"ngModelChange","change","ngModel"],["value","all"],["value","tax-documents"],["value","financial-statements"],["value","receipts"],["value","other"],["for","searchInput",1,"form-label"],["type","text","id","searchInput","placeholder","Search by document name...",1,"form-control",3,"ngModelChange","input","ngModel"],[1,"table-responsive"],[1,"table","table-nowrap","table-hover"],[1,"table-light"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","row mb-4",4,"ngIf"],[1,"alert","alert-info","mt-4"],[1,"alert-heading"],[1,"mb-0"],[1,"d-flex","align-items-center"],[1,"ri-file-text-line","me-2","text-muted"],["type","button",1,"btn","btn-sm","btn-outline-primary",3,"click"],[1,"ri-download-line"],["colspan","6",1,"text-center","text-muted","py-4"],[1,"col-12"],[1,"card-header"],[1,"d-flex","justify-content-between","align-items-center"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"row"],[1,"col-md-6","mb-3"],["for","documentCategory",1,"form-label"],["id","documentCategory","name","category","required","",1,"form-select",3,"ngModelChange","ngModel"],["value",""],["for","documentYear",1,"form-label"],["type","number","id","documentYear","name","year","placeholder","e.g., 2024","min","2016","max","2030",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-12","mb-3"],["for","documentTitle",1,"form-label"],["type","text","id","documentTitle","name","title","placeholder","Enter a descriptive title for your document...","required","",1,"form-control",3,"ngModelChange","input","ngModel"],[1,"form-text"],[1,"text-muted"],["class","row",4,"ngIf"],["for","documentDescription",1,"form-label"],["id","documentDescription","rows","2","name","description","placeholder","Add any additional notes about this document...",1,"form-control",3,"ngModelChange","ngModel"],[1,"mb-3"],[1,"form-label"],[1,"dropzone",3,"success","config","message"],[1,"d-flex","justify-content-end","gap-2"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["class","spinner-border spinner-border-sm me-2","role","status",4,"ngIf"],["class","alert alert-info d-flex align-items-center","role","alert",4,"ngIf"],["class","alert alert-success d-flex align-items-center","role","alert",4,"ngIf"],["role","alert",1,"alert","alert-info","d-flex","align-items-center"],[1,"ri-search-line","me-2"],[1,"flex-grow-1"],["role","group","aria-label","Suggestion actions",1,"btn-group","btn-group-sm","ms-3"],["type","button","aria-label","Keep current values",1,"btn","btn-outline-secondary",3,"click"],["type","button","aria-label","Apply suggestion",1,"btn","btn-primary",3,"click"],["role","alert",1,"alert","alert-success","d-flex","align-items-center"],[1,"ri-check-line","me-2"],[1,"mt-3"],[1,"list-unstyled","mb-0"],["class","mt-2",4,"ngFor","ngForOf"],[1,"mt-2"],[1,"border","rounded"],[1,"d-flex","p-2"],[1,"flex-shrink-0","me-3"],[1,"avatar-sm","bg-light","rounded","d-flex","align-items-center","justify-content-center"],[1,"ri-file-text-line","text-muted"],[1,"pt-1"],[1,"fs-md","mb-1"],[1,"fs-sm","text-muted","mb-0"],[1,"flex-shrink-0","ms-3"],[1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"ri-delete-bin-line"],["role","status",1,"spinner-border","spinner-border-sm","me-2"]],template:function(n,o){1&n&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4",3),e.EFF(4,"Documents"),e.k0s(),e.j41(5,"button",4),e.bIt("click",function(){return o.uploadDocument()}),e.nrm(6,"i",5),e.EFF(7,"Upload Document "),e.k0s()(),e.j41(8,"div",6)(9,"div",7)(10,"label",8),e.EFF(11,"Filter by Category"),e.k0s(),e.j41(12,"select",9),e.mxI("ngModelChange",function(c){return e.DH7(o.selectedCategory,c)||(o.selectedCategory=c),c}),e.bIt("change",function(){return o.onCategoryChange()}),e.j41(13,"option",10),e.EFF(14,"All Categories"),e.k0s(),e.j41(15,"option",11),e.EFF(16,"Tax Documents"),e.k0s(),e.j41(17,"option",12),e.EFF(18,"Financial Statements"),e.k0s(),e.j41(19,"option",13),e.EFF(20,"Receipts"),e.k0s(),e.j41(21,"option",14),e.EFF(22,"Other"),e.k0s()()(),e.j41(23,"div",7)(24,"label",15),e.EFF(25,"Search Documents"),e.k0s(),e.j41(26,"input",16),e.mxI("ngModelChange",function(c){return e.DH7(o.searchTerm,c)||(o.searchTerm=c),c}),e.bIt("input",function(){return o.onSearchChange()}),e.k0s()()(),e.j41(27,"div",17)(28,"table",18)(29,"thead",19)(30,"tr")(31,"th"),e.EFF(32,"Document Name"),e.k0s(),e.j41(33,"th"),e.EFF(34,"Type"),e.k0s(),e.j41(35,"th"),e.EFF(36,"Size"),e.k0s(),e.j41(37,"th"),e.EFF(38,"Upload Date"),e.k0s(),e.j41(39,"th"),e.EFF(40,"Status"),e.k0s(),e.j41(41,"th"),e.EFF(42,"Actions"),e.k0s()()(),e.j41(43,"tbody"),e.DNE(44,E,19,12,"tr",20)(45,O,3,0,"tr",21),e.k0s()()(),e.DNE(46,A,54,11,"div",22),e.j41(47,"div",23)(48,"h6",24),e.EFF(49,"Upload Guidelines:"),e.k0s(),e.j41(50,"ul",25)(51,"li"),e.EFF(52,"Accepted formats: PDF, JPG, PNG, DOC, DOCX"),e.k0s(),e.j41(53,"li"),e.EFF(54,"Maximum file size: 10MB"),e.k0s(),e.j41(55,"li"),e.EFF(56,"Please organize documents by category for easier processing"),e.k0s(),e.j41(57,"li"),e.EFF(58,"Uploaded documents will be reviewed within 1-2 business days"),e.k0s()()()()()),2&n&&(e.R7$(12),e.R50("ngModel",o.selectedCategory),e.R7$(14),e.R50("ngModel",o.searchTerm),e.R7$(18),e.Y8G("ngForOf",o.filteredDocuments),e.R7$(),e.Y8G("ngIf",0===o.filteredDocuments.length),e.R7$(),e.Y8G("ngIf",o.showUploadModal))},dependencies:[m.Sq,m.bT,a.qT,a.xH,a.y7,a.me,a.Q0,a.wz,a.BC,a.cb,a.YS,a.VZ,a.zX,a.vS,a.cV,I.HF,m.PV,m.vh],styles:[".table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:600;border-top:none}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}.btn-sm[_ngcontent-%COMP%]{padding:.25rem .5rem}.alert-info[_ngcontent-%COMP%]{border-left:4px solid #17a2b8}.card-title[_ngcontent-%COMP%]{font-weight:600}"]})}}return i})();function B(i,r){1&i&&(e.j41(0,"span"),e.nrm(1,"i",20),e.EFF(2,"Completed "),e.k0s())}function U(i,r){1&i&&(e.j41(0,"span"),e.nrm(1,"i",21),e.EFF(2,"Continue "),e.k0s())}function V(i,r){1&i&&(e.j41(0,"span"),e.nrm(1,"i",22),e.EFF(2,"Start Form "),e.k0s())}function z(i,r){if(1&i){const t=e.RV6();e.j41(0,"div",8)(1,"div",9)(2,"div",1)(3,"div",10),e.nrm(4,"i",11),e.j41(5,"span"),e.EFF(6),e.nI1(7,"titlecase"),e.nI1(8,"replace"),e.k0s()(),e.j41(9,"h5",12),e.EFF(10),e.k0s(),e.j41(11,"p",13),e.EFF(12),e.k0s(),e.j41(13,"div",14)(14,"small",15),e.nrm(15,"i",16),e.EFF(16),e.nI1(17,"date"),e.k0s(),e.nrm(18,"br"),e.j41(19,"small",15),e.nrm(20,"i",17),e.EFF(21),e.k0s()(),e.j41(22,"button",18),e.bIt("click",function(){const o=e.eBV(t).$implicit,s=e.XpG();return e.Njj(s.openForm(o))}),e.DNE(23,B,3,0,"span",19)(24,U,3,0,"span",19)(25,V,3,0,"span",19),e.k0s()()()()}if(2&i){const t=r.$implicit,n=e.XpG();e.R7$(),e.AVh("border-success","completed"===t.status)("border-warning","in-progress"===t.status),e.R7$(3),e.HbH(n.getStatusIcon(t.status)),e.R7$(),e.HbH(n.getStatusClass(t.status)),e.R7$(),e.JRh(e.brH(8,19,e.bMT(7,17,t.status),"-"," ")),e.R7$(4),e.JRh(t.title),e.R7$(2),e.JRh(t.description),e.R7$(4),e.SpI(" Due: ",e.i5U(17,23,t.dueDate,"shortDate")," "),e.R7$(5),e.SpI(" ",t.category," "),e.R7$(),e.Y8G("disabled","completed"===t.status),e.R7$(),e.Y8G("ngIf","completed"===t.status),e.R7$(),e.Y8G("ngIf","in-progress"===t.status),e.R7$(),e.Y8G("ngIf","not-started"===t.status)}}function L(i,r){if(1&i){const t=e.RV6();e.j41(0,"div",23)(1,"div",24)(2,"div",25)(3,"div",26)(4,"h5",27),e.EFF(5),e.k0s(),e.j41(6,"button",28),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.closeForm())}),e.k0s()(),e.j41(7,"div",29)(8,"form",30)(9,"div",4)(10,"div",31)(11,"label",32),e.EFF(12,"Business Name *"),e.k0s(),e.nrm(13,"input",33),e.k0s(),e.j41(14,"div",31)(15,"label",34),e.EFF(16,"Business Type *"),e.k0s(),e.j41(17,"select",35)(18,"option",36),e.EFF(19,"Select Business Type"),e.k0s(),e.j41(20,"option",37),e.EFF(21,"LLC"),e.k0s(),e.j41(22,"option",38),e.EFF(23,"Corporation"),e.k0s(),e.j41(24,"option",39),e.EFF(25,"Partnership"),e.k0s(),e.j41(26,"option",40),e.EFF(27,"Sole Proprietorship"),e.k0s()()()(),e.j41(28,"div",4)(29,"div",31)(30,"label",41),e.EFF(31,"Tax ID (EIN) *"),e.k0s(),e.nrm(32,"input",42),e.k0s(),e.j41(33,"div",31)(34,"label",43),e.EFF(35,"Phone Number *"),e.k0s(),e.nrm(36,"input",44),e.k0s()(),e.j41(37,"div",14)(38,"label",45),e.EFF(39,"Business Address *"),e.k0s(),e.nrm(40,"textarea",46),e.k0s(),e.j41(41,"div",4)(42,"div",31)(43,"label",47),e.EFF(44,"Email Address *"),e.k0s(),e.nrm(45,"input",48),e.k0s(),e.j41(46,"div",31)(47,"label",49),e.EFF(48,"Annual Revenue"),e.k0s(),e.nrm(49,"input",50),e.k0s()(),e.j41(50,"div",4)(51,"div",31)(52,"label",51),e.EFF(53,"Number of Employees"),e.k0s(),e.nrm(54,"input",52),e.k0s()(),e.j41(55,"div",14)(56,"label",53),e.EFF(57,"Business Description"),e.k0s(),e.nrm(58,"textarea",54),e.k0s()()(),e.j41(59,"div",55)(60,"button",56),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.closeForm())}),e.EFF(61,"Cancel"),e.k0s(),e.j41(62,"button",57),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.saveForm())}),e.EFF(63,"Save Draft"),e.k0s(),e.j41(64,"button",58),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.submitForm())}),e.EFF(65,"Submit Form"),e.k0s()()()()()}if(2&i){const t=e.XpG();e.xc7("display",t.showFormModal?"block":"none"),e.AVh("show",t.showFormModal),e.R7$(5),e.JRh(null==t.selectedForm?null:t.selectedForm.title),e.R7$(3),e.Y8G("formGroup",t.currentForm),e.R7$(54),e.Y8G("disabled",!t.currentForm.valid),e.R7$(2),e.Y8G("disabled",!t.currentForm.valid)}}function X(i,r){if(1&i&&e.nrm(0,"div",59),2&i){const t=e.XpG();e.AVh("show",t.showFormModal)}}let J=(()=>{class i{constructor(t){this.fb=t,this.intakeForms=[],this.selectedForm=null,this.showFormModal=!1,this.currentForm=this.fb.group({businessName:["",a.k0.required],businessType:["",a.k0.required],taxId:["",a.k0.required],address:["",a.k0.required],phone:["",a.k0.required],email:["",[a.k0.required,a.k0.email]],annualRevenue:[""],numberOfEmployees:[""],businessDescription:[""]})}ngOnInit(){this.loadIntakeForms()}loadIntakeForms(){this.intakeForms=[{id:1,title:"Business Information Form",description:"Basic business details and contact information",status:"completed",dueDate:"2024-01-15",category:"Business Setup"},{id:2,title:"Tax Preparation Questionnaire",description:"Annual tax preparation information and documentation requirements",status:"in-progress",dueDate:"2024-03-15",category:"Tax Preparation"},{id:3,title:"Bookkeeping Services Setup",description:"Monthly bookkeeping service preferences and requirements",status:"not-started",dueDate:"2024-02-28",category:"Bookkeeping"}]}getStatusClass(t){switch(t){case"completed":return"badge bg-success";case"in-progress":return"badge bg-warning";default:return"badge bg-secondary"}}getStatusIcon(t){switch(t){case"completed":return"ri-check-line";case"in-progress":return"ri-time-line";default:return"ri-file-list-line"}}openForm(t){this.selectedForm=t,this.showFormModal=!0,1===t.id&&this.currentForm.patchValue({businessName:"Sample Business LLC",businessType:"LLC",taxId:"12-3456789",address:"123 Main St, City, State 12345",phone:"(555) 123-4567",email:"business@example.com",annualRevenue:"500000",numberOfEmployees:"5",businessDescription:"Professional services company"})}closeForm(){this.showFormModal=!1,this.selectedForm=null}saveForm(){this.currentForm.valid&&this.selectedForm&&(console.log("Saving form data:",this.currentForm.value),this.selectedForm.status="in-progress",this.closeForm())}submitForm(){this.currentForm.valid&&this.selectedForm&&(console.log("Submitting form data:",this.currentForm.value),this.selectedForm.status="completed",this.closeForm())}static{this.\u0275fac=function(n){return new(n||i)(e.rXU(a.ok))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-intake"]],decls:10,vars:3,consts:[[1,"card"],[1,"card-body"],[1,"card-title","mb-4"],[1,"text-muted","mb-4"],[1,"row"],["class","col-lg-4 col-md-6 mb-4",4,"ngFor","ngForOf"],["class","modal fade","tabindex","-1",3,"show","display",4,"ngIf"],["class","modal-backdrop fade",3,"show",4,"ngIf"],[1,"col-lg-4","col-md-6","mb-4"],[1,"card","border","h-100"],[1,"d-flex","justify-content-between","align-items-start","mb-3"],[1,"font-size-24","text-primary"],[1,"card-title"],[1,"card-text","text-muted"],[1,"mb-3"],[1,"text-muted"],[1,"ri-calendar-line","me-1"],[1,"ri-folder-line","me-1"],["type","button",1,"btn","btn-primary","btn-sm",3,"click","disabled"],[4,"ngIf"],[1,"ri-check-line","me-1"],[1,"ri-edit-line","me-1"],[1,"ri-play-line","me-1"],["tabindex","-1",1,"modal","fade"],[1,"modal-dialog","modal-lg"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[3,"formGroup"],[1,"col-md-6","mb-3"],["for","businessName",1,"form-label"],["type","text","id","businessName","formControlName","businessName",1,"form-control"],["for","businessType",1,"form-label"],["id","businessType","formControlName","businessType",1,"form-select"],["value",""],["value","LLC"],["value","Corporation"],["value","Partnership"],["value","Sole Proprietorship"],["for","taxId",1,"form-label"],["type","text","id","taxId","formControlName","taxId",1,"form-control"],["for","phone",1,"form-label"],["type","tel","id","phone","formControlName","phone",1,"form-control"],["for","address",1,"form-label"],["id","address","rows","2","formControlName","address",1,"form-control"],["for","email",1,"form-label"],["type","email","id","email","formControlName","email",1,"form-control"],["for","annualRevenue",1,"form-label"],["type","number","id","annualRevenue","formControlName","annualRevenue",1,"form-control"],["for","numberOfEmployees",1,"form-label"],["type","number","id","numberOfEmployees","formControlName","numberOfEmployees",1,"form-control"],["for","businessDescription",1,"form-label"],["id","businessDescription","rows","3","formControlName","businessDescription",1,"form-control"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-outline-primary",3,"click","disabled"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"modal-backdrop","fade"]],template:function(n,o){1&n&&(e.j41(0,"div",0)(1,"div",1)(2,"h4",2),e.EFF(3,"Intake Forms"),e.k0s(),e.j41(4,"p",3),e.EFF(5,"Complete the required forms below to help us serve you better. Click on any form to get started."),e.k0s(),e.j41(6,"div",4),e.DNE(7,z,26,26,"div",5),e.k0s()()(),e.DNE(8,L,66,8,"div",6)(9,X,1,2,"div",7)),2&n&&(e.R7$(7),e.Y8G("ngForOf",o.intakeForms),e.R7$(),e.Y8G("ngIf",o.showFormModal),e.R7$(),e.Y8G("ngIf",o.showFormModal))},dependencies:[m.Sq,m.bT,a.qT,a.xH,a.y7,a.me,a.Q0,a.wz,a.BC,a.cb,a.j4,a.JD,m.PV,m.vh],styles:[".card.border-success[_ngcontent-%COMP%]{border-color:#28a745!important}.card.border-warning[_ngcontent-%COMP%]{border-color:#ffc107!important}.card-title[_ngcontent-%COMP%]{font-weight:600}.modal.show[_ngcontent-%COMP%]{background-color:#00000080}.modal-backdrop.show[_ngcontent-%COMP%]{opacity:.5}.btn-sm[_ngcontent-%COMP%]{padding:.375rem .75rem}.form-label[_ngcontent-%COMP%]{font-weight:500}"]})}}return i})();var h=l(6977);function H(i,r){1&i&&(e.j41(0,"span",16),e.EFF(1,"Saving..."),e.k0s())}function q(i,r){1&i&&e.nrm(0,"i",20)}function Q(i,r){if(1&i){const t=e.RV6();e.j41(0,"button",17),e.bIt("click",function(){const o=e.eBV(t).index,s=e.XpG();return e.Njj(s.goToSection(o))}),e.nrm(1,"i",18),e.EFF(2),e.DNE(3,q,1,0,"i",19),e.k0s()}if(2&i){const t=r.$implicit;e.R7$(),e.HbH(t.icon),e.R7$(),e.SpI(" ",t.title," "),e.R7$(),e.Y8G("ngIf",t.completed)}}function W(i,r){1&i&&e.nrm(0,"i",64)}function K(i,r){1&i&&e.nrm(0,"i",65)}function Z(i,r){1&i&&e.nrm(0,"i",64)}function ee(i,r){1&i&&e.nrm(0,"i",65)}function te(i,r){if(1&i){const t=e.RV6();e.j41(0,"div")(1,"div",1)(2,"div",35)(3,"label",36),e.EFF(4,"Spouse's Name"),e.k0s(),e.nrm(5,"input",66),e.k0s(),e.j41(6,"div",35)(7,"label",36),e.EFF(8,"Spouse's SSN"),e.k0s(),e.j41(9,"div",39)(10,"input",40),e.bIt("input",function(o){e.eBV(t);const s=e.XpG(3);return e.Njj(s.formatSSNInput(o,"personalInformation.spouseSsn"))}),e.k0s(),e.j41(11,"button",41),e.bIt("click",function(){e.eBV(t);const o=e.XpG(3);return e.Njj(o.toggleSSNMask("spouse-ssn"))}),e.DNE(12,Z,1,0,"i",42)(13,ee,1,0,"i",43),e.k0s()()()()()}if(2&i){let t;const n=e.XpG(3);e.R7$(10),e.Y8G("value",n.getDisplaySSN(null==(t=n.intakeForm.get("personalInformation.spouseSsn"))?null:t.value,"spouse-ssn")),e.R7$(2),e.Y8G("ngIf",n.isSSNMasked("spouse-ssn")),e.R7$(),e.Y8G("ngIf",!n.isSSNMasked("spouse-ssn"))}}function ne(i,r){if(1&i){const t=e.RV6();e.j41(0,"div")(1,"div",30)(2,"h5",31),e.EFF(3,"\u{1f510} Section A. Personal Information"),e.k0s(),e.j41(4,"button",32),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.clearSection(0))}),e.nrm(5,"i",33),e.EFF(6,"Clear Section "),e.k0s()(),e.j41(7,"div",34)(8,"div",1)(9,"div",35)(10,"label",36),e.EFF(11,"Full Name *"),e.k0s(),e.nrm(12,"input",37),e.k0s(),e.j41(13,"div",35)(14,"label",36),e.EFF(15,"Date of Birth *"),e.k0s(),e.nrm(16,"input",38),e.k0s()(),e.j41(17,"div",1)(18,"div",35)(19,"label",36),e.EFF(20,"SSN/ITIN *"),e.k0s(),e.j41(21,"div",39)(22,"input",40),e.bIt("input",function(o){e.eBV(t);const s=e.XpG(2);return e.Njj(s.formatSSNInput(o,"personalInformation.ssn"))}),e.k0s(),e.j41(23,"button",41),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.toggleSSNMask("personal-ssn"))}),e.DNE(24,W,1,0,"i",42)(25,K,1,0,"i",43),e.k0s()()(),e.j41(26,"div",35)(27,"label",36),e.EFF(28,"Marital Status *"),e.k0s(),e.j41(29,"select",44)(30,"option",45),e.EFF(31,"Select Status"),e.k0s(),e.j41(32,"option",46),e.EFF(33,"Single"),e.k0s(),e.j41(34,"option",47),e.EFF(35,"Married Filing Jointly"),e.k0s(),e.j41(36,"option",48),e.EFF(37,"Married Filing Separately"),e.k0s(),e.j41(38,"option",49),e.EFF(39,"Head of Household"),e.k0s(),e.j41(40,"option",50),e.EFF(41,"Qualifying Widower"),e.k0s()()()(),e.DNE(42,te,14,3,"div",22),e.j41(43,"div",51)(44,"div",1)(45,"div",52)(46,"label",36),e.EFF(47,"Street Address *"),e.k0s(),e.nrm(48,"input",53),e.k0s()(),e.j41(49,"div",1)(50,"div",54)(51,"label",36),e.EFF(52,"City *"),e.k0s(),e.nrm(53,"input",55),e.k0s(),e.j41(54,"div",54)(55,"label",36),e.EFF(56,"State *"),e.k0s(),e.nrm(57,"input",56),e.k0s(),e.j41(58,"div",54)(59,"label",36),e.EFF(60,"ZIP Code *"),e.k0s(),e.nrm(61,"input",57),e.k0s()()(),e.j41(62,"div",1)(63,"div",35)(64,"label",36),e.EFF(65,"Phone *"),e.k0s(),e.j41(66,"input",58),e.bIt("input",function(o){e.eBV(t);const s=e.XpG(2);return e.Njj(s.formatPhoneInput(o,"personalInformation.phone"))}),e.k0s()(),e.j41(67,"div",35)(68,"label",36),e.EFF(69,"Email *"),e.k0s(),e.nrm(70,"input",59),e.k0s()(),e.j41(71,"div",60)(72,"h6",61),e.EFF(73,"Driver's License / State ID"),e.k0s(),e.j41(74,"div",1)(75,"div",54)(76,"label",36),e.EFF(77,"License Number"),e.k0s(),e.nrm(78,"input",62),e.k0s(),e.j41(79,"div",54)(80,"label",36),e.EFF(81,"State"),e.k0s(),e.nrm(82,"input",56),e.k0s(),e.j41(83,"div",54)(84,"label",36),e.EFF(85,"Expiration Date"),e.k0s(),e.nrm(86,"input",63),e.k0s()()()()()}if(2&i){let t,n;const o=e.XpG(2);e.R7$(22),e.Y8G("value",o.getDisplaySSN(null==(t=o.intakeForm.get("personalInformation.ssn"))?null:t.value,"personal-ssn")),e.R7$(2),e.Y8G("ngIf",o.isSSNMasked("personal-ssn")),e.R7$(),e.Y8G("ngIf",!o.isSSNMasked("personal-ssn")),e.R7$(17),e.Y8G("ngIf","married-jointly"===(null==(n=o.intakeForm.get("personalInformation.maritalStatus"))?null:n.value)||"married-separately"===(null==(n=o.intakeForm.get("personalInformation.maritalStatus"))?null:n.value))}}function oe(i,r){1&i&&(e.j41(0,"div",72),e.nrm(1,"i",73),e.j41(2,"p"),e.EFF(3,'No dependents added yet. Click "Add Dependent" to get started.'),e.k0s()())}function ie(i,r){1&i&&e.nrm(0,"i",64)}function se(i,r){1&i&&e.nrm(0,"i",65)}function re(i,r){1&i&&(e.j41(0,"div",1)(1,"div",35)(2,"label",36),e.EFF(3,"Child Care Amount"),e.k0s(),e.nrm(4,"input",90),e.k0s()())}function ae(i,r){if(1&i){const t=e.RV6();e.j41(0,"div",74)(1,"div",75)(2,"h6",31),e.EFF(3),e.k0s(),e.j41(4,"button",32),e.bIt("click",function(){const o=e.eBV(t).index,s=e.XpG(3);return e.Njj(s.removeDependent(o))}),e.nrm(5,"i",76),e.k0s()(),e.j41(6,"div",77)(7,"div",1)(8,"div",35)(9,"label",36),e.EFF(10,"Name *"),e.k0s(),e.nrm(11,"input",78),e.k0s(),e.j41(12,"div",35)(13,"label",36),e.EFF(14,"SSN/ITIN *"),e.k0s(),e.j41(15,"div",39)(16,"input",40),e.bIt("input",function(o){const s=e.eBV(t).index,c=e.XpG(3);return e.Njj(c.formatSSNInput(o,"dependents."+s+".ssn"))}),e.k0s(),e.j41(17,"button",41),e.bIt("click",function(){const o=e.eBV(t).index,s=e.XpG(3);return e.Njj(s.toggleSSNMask("dependent-ssn-"+o))}),e.DNE(18,ie,1,0,"i",42)(19,se,1,0,"i",43),e.k0s()()()(),e.j41(20,"div",1)(21,"div",54)(22,"label",36),e.EFF(23,"Date of Birth *"),e.k0s(),e.nrm(24,"input",38),e.k0s(),e.j41(25,"div",54)(26,"label",36),e.EFF(27,"Relationship *"),e.k0s(),e.j41(28,"select",79)(29,"option",45),e.EFF(30,"Select Relationship"),e.k0s(),e.j41(31,"option",80),e.EFF(32,"Son"),e.k0s(),e.j41(33,"option",81),e.EFF(34,"Daughter"),e.k0s(),e.j41(35,"option",82),e.EFF(36,"Stepchild"),e.k0s(),e.j41(37,"option",83),e.EFF(38,"Grandchild"),e.k0s(),e.j41(39,"option",84),e.EFF(40,"Other"),e.k0s()()(),e.j41(41,"div",54)(42,"label",36),e.EFF(43,"Months Lived With You"),e.k0s(),e.nrm(44,"input",85),e.k0s()(),e.j41(45,"div",1)(46,"div",35)(47,"div",86),e.nrm(48,"input",87),e.j41(49,"label",88),e.EFF(50,"Lived with you full year"),e.k0s()()(),e.j41(51,"div",35)(52,"div",86),e.nrm(53,"input",89),e.j41(54,"label",88),e.EFF(55,"Child care expenses paid"),e.k0s()()()(),e.DNE(56,re,5,0,"div",15),e.k0s()()}if(2&i){let t,n;const o=r.$implicit,s=r.index,c=e.XpG(3);e.R7$(3),e.SpI("Dependent ",s+1,""),e.R7$(3),e.Y8G("formGroup",o),e.R7$(10),e.Y8G("value",c.getDisplaySSN(null==(t=o.get("ssn"))?null:t.value,"dependent-ssn-"+s)),e.R7$(2),e.Y8G("ngIf",c.isSSNMasked("dependent-ssn-"+s)),e.R7$(),e.Y8G("ngIf",!c.isSSNMasked("dependent-ssn-"+s)),e.R7$(29),e.Mz_("id","fullYear_",s,""),e.R7$(),e.Mz_("for","fullYear_",s,""),e.R7$(4),e.Mz_("id","childCare_",s,""),e.R7$(),e.Mz_("for","childCare_",s,""),e.R7$(2),e.Y8G("ngIf",null==(n=o.get("childCareExpenses"))?null:n.value)}}function ce(i,r){if(1&i){const t=e.RV6();e.j41(0,"div")(1,"div",30)(2,"h5",31),e.EFF(3,"\u{1f468}\u200d\u{1f469}\u200d\u{1f467} Section B. Dependents"),e.k0s(),e.j41(4,"div",67)(5,"button",32),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.clearSection(1))}),e.nrm(6,"i",33),e.EFF(7,"Clear Section "),e.k0s(),e.j41(8,"button",68),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.addDependent())}),e.nrm(9,"i",69),e.EFF(10,"Add Dependent "),e.k0s()()(),e.DNE(11,oe,4,0,"div",70)(12,ae,57,14,"div",71),e.k0s()}if(2&i){const t=e.XpG(2);e.R7$(11),e.Y8G("ngIf",0===t.dependentsArray.length),e.R7$(),e.Y8G("ngForOf",t.dependentsArray.controls)}}function le(i,r){1&i&&(e.j41(0,"div",72),e.nrm(1,"i",91),e.j41(2,"p"),e.EFF(3,'No income sources added yet. Click "Add Income Source" to get started.'),e.k0s()())}function de(i,r){1&i&&(e.j41(0,"div",1)(1,"div",35)(2,"label",36),e.EFF(3,"Employer Name"),e.k0s(),e.nrm(4,"input",105),e.k0s()())}function me(i,r){if(1&i){const t=e.RV6();e.j41(0,"div",74)(1,"div",75)(2,"h6",31),e.EFF(3),e.k0s(),e.j41(4,"button",32),e.bIt("click",function(){const o=e.eBV(t).index,s=e.XpG(3);return e.Njj(s.removeIncomeSource(o))}),e.nrm(5,"i",76),e.k0s()(),e.j41(6,"div",77)(7,"div",1)(8,"div",54)(9,"label",36),e.EFF(10,"Income Type *"),e.k0s(),e.j41(11,"select",92)(12,"option",45),e.EFF(13,"Select Type"),e.k0s(),e.j41(14,"option",93),e.EFF(15,"W-2 Employment Income"),e.k0s(),e.j41(16,"option",94),e.EFF(17,"1099-NEC (Freelance/Contractor)"),e.k0s(),e.j41(18,"option",95),e.EFF(19,"1099-MISC"),e.k0s(),e.j41(20,"option",96),e.EFF(21,"1099-INT (Interest)"),e.k0s(),e.j41(22,"option",97),e.EFF(23,"1099-DIV (Dividends)"),e.k0s(),e.j41(24,"option",98),e.EFF(25,"1099-B (Stock Sales)"),e.k0s(),e.j41(26,"option",99),e.EFF(27,"1099-R (Retirement)"),e.k0s(),e.j41(28,"option",100),e.EFF(29,"SSA-1099 (Social Security)"),e.k0s(),e.j41(30,"option",101),e.EFF(31,"Rental Income"),e.k0s(),e.j41(32,"option",102),e.EFF(33,"Business/Self-Employment"),e.k0s(),e.j41(34,"option",84),e.EFF(35,"Other Income"),e.k0s()()(),e.j41(36,"div",54)(37,"label",36),e.EFF(38,"Description *"),e.k0s(),e.nrm(39,"input",103),e.k0s(),e.j41(40,"div",54)(41,"label",36),e.EFF(42,"Amount *"),e.k0s(),e.nrm(43,"input",104),e.k0s()(),e.DNE(44,de,5,0,"div",15),e.k0s()()}if(2&i){let t;const n=r.$implicit,o=r.index;e.R7$(3),e.SpI("Income Source ",o+1,""),e.R7$(3),e.Y8G("formGroup",n),e.R7$(38),e.Y8G("ngIf","w2"===(null==(t=n.get("type"))?null:t.value))}}function ue(i,r){if(1&i){const t=e.RV6();e.j41(0,"div")(1,"div",30)(2,"h5",31),e.EFF(3,"\u{1f4bc} Section C. Income"),e.k0s(),e.j41(4,"div",67)(5,"button",32),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.clearSection(2))}),e.nrm(6,"i",33),e.EFF(7,"Clear Section "),e.k0s(),e.j41(8,"button",68),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.addIncomeSource())}),e.nrm(9,"i",69),e.EFF(10,"Add Income Source "),e.k0s()()(),e.DNE(11,le,4,0,"div",70)(12,me,45,3,"div",71),e.k0s()}if(2&i){const t=e.XpG(2);e.R7$(11),e.Y8G("ngIf",0===t.incomeArray.length),e.R7$(),e.Y8G("ngForOf",t.incomeArray.controls)}}function pe(i,r){1&i&&(e.j41(0,"div",124),e.nrm(1,"input",125),e.k0s())}function ge(i,r){1&i&&(e.j41(0,"div",124),e.nrm(1,"input",126),e.k0s())}function fe(i,r){1&i&&(e.j41(0,"div",124),e.nrm(1,"input",127),e.k0s())}function he(i,r){if(1&i){const t=e.RV6();e.j41(0,"div")(1,"div",30)(2,"h5",31),e.EFF(3,"\u{1f4b8} Section D. Deductions & Adjustments"),e.k0s(),e.j41(4,"button",32),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.clearSection(3))}),e.nrm(5,"i",33),e.EFF(6,"Clear Section "),e.k0s()(),e.j41(7,"div",106)(8,"div",1)(9,"div",35)(10,"div",86),e.nrm(11,"input",107),e.j41(12,"label",108),e.EFF(13,"Mortgage Interest Paid"),e.k0s()(),e.DNE(14,pe,2,0,"div",109),e.k0s(),e.j41(15,"div",35)(16,"div",86),e.nrm(17,"input",110),e.j41(18,"label",111),e.EFF(19,"Property Taxes Paid"),e.k0s()(),e.DNE(20,ge,2,0,"div",109),e.k0s()(),e.j41(21,"div",1)(22,"div",35)(23,"label",36),e.EFF(24,"Charitable Contributions (Cash)"),e.k0s(),e.nrm(25,"input",112),e.k0s(),e.j41(26,"div",35)(27,"label",36),e.EFF(28,"Charitable Contributions (Non-Cash)"),e.k0s(),e.nrm(29,"input",113),e.k0s()(),e.j41(30,"div",1)(31,"div",35)(32,"div",86),e.nrm(33,"input",114),e.j41(34,"label",115),e.EFF(35,"Student Loan Interest Paid"),e.k0s()(),e.DNE(36,fe,2,0,"div",109),e.k0s(),e.j41(37,"div",35)(38,"label",36),e.EFF(39,"IRA/401(k) Contributions"),e.k0s(),e.nrm(40,"input",116),e.k0s()(),e.j41(41,"div",1)(42,"div",35)(43,"label",36),e.EFF(44,"IRA Type"),e.k0s(),e.j41(45,"select",117)(46,"option",45),e.EFF(47,"Select Type"),e.k0s(),e.j41(48,"option",118),e.EFF(49,"Traditional IRA"),e.k0s(),e.j41(50,"option",119),e.EFF(51,"Roth IRA"),e.k0s(),e.j41(52,"option",120),e.EFF(53,"401(k)"),e.k0s(),e.j41(54,"option",121),e.EFF(55,"403(b)"),e.k0s()()(),e.j41(56,"div",35)(57,"label",36),e.EFF(58,"Medical Expenses (Out-of-Pocket)"),e.k0s(),e.nrm(59,"input",122),e.k0s()(),e.j41(60,"div",61)(61,"label",36),e.EFF(62,"Other Adjustments"),e.k0s(),e.nrm(63,"textarea",123),e.k0s()()()}if(2&i){let t,n,o;const s=e.XpG(2);e.R7$(14),e.Y8G("ngIf",null==(t=s.intakeForm.get("deductionsAdjustments.mortgageInterest"))?null:t.value),e.R7$(6),e.Y8G("ngIf",null==(n=s.intakeForm.get("deductionsAdjustments.propertyTaxes"))?null:n.value),e.R7$(16),e.Y8G("ngIf",null==(o=s.intakeForm.get("deductionsAdjustments.studentLoanInterest"))?null:o.value)}}function _e(i,r){if(1&i){const t=e.RV6();e.j41(0,"div")(1,"div",30)(2,"h5",31),e.EFF(3,"\u{1f3e5} Section E. Health Coverage"),e.k0s(),e.j41(4,"button",32),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.clearSection(4))}),e.nrm(5,"i",33),e.EFF(6,"Clear Section "),e.k0s()(),e.j41(7,"div",128)(8,"div",129)(9,"label",36),e.EFF(10,"Did you have health insurance all year? *"),e.k0s(),e.j41(11,"div",86),e.nrm(12,"input",130),e.j41(13,"label",131),e.EFF(14,"Yes"),e.k0s()(),e.j41(15,"div",86),e.nrm(16,"input",132),e.j41(17,"label",133),e.EFF(18,"No"),e.k0s()()(),e.j41(19,"div",1)(20,"div",54)(21,"div",86),e.nrm(22,"input",134),e.j41(23,"label",135),e.EFF(24,"Marketplace Coverage"),e.k0s()()(),e.j41(25,"div",54)(26,"div",86),e.nrm(27,"input",136),e.j41(28,"label",137),e.EFF(29,"Employer Coverage"),e.k0s()()()(),e.j41(30,"div",1)(31,"div",54)(32,"div",86),e.nrm(33,"input",138),e.j41(34,"label",139),e.EFF(35,"Form 1095-A (Marketplace)"),e.k0s()()(),e.j41(36,"div",54)(37,"div",86),e.nrm(38,"input",140),e.j41(39,"label",141),e.EFF(40,"Form 1095-B"),e.k0s()()(),e.j41(41,"div",54)(42,"div",86),e.nrm(43,"input",142),e.j41(44,"label",143),e.EFF(45,"Form 1095-C"),e.k0s()()()()()()}2&i&&(e.R7$(12),e.Y8G("value",!0),e.R7$(4),e.Y8G("value",!1))}function be(i,r){1&i&&(e.j41(0,"div",1)(1,"div",35)(2,"label",36),e.EFF(3,"Care Provider Name"),e.k0s(),e.nrm(4,"input",152),e.k0s(),e.j41(5,"div",35)(6,"label",36),e.EFF(7,"Care Provider EIN/SSN"),e.k0s(),e.nrm(8,"input",153),e.k0s()())}function ve(i,r){if(1&i){const t=e.RV6();e.j41(0,"div")(1,"div",30)(2,"h5",31),e.EFF(3,"\u{1f393} Section F. Credits"),e.k0s(),e.j41(4,"button",32),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.clearSection(5))}),e.nrm(5,"i",33),e.EFF(6,"Clear Section "),e.k0s()(),e.j41(7,"div",144)(8,"div",1)(9,"div",35)(10,"label",36),e.EFF(11,"Education Expenses"),e.k0s(),e.nrm(12,"input",145),e.k0s(),e.j41(13,"div",35)(14,"div",146),e.nrm(15,"input",147),e.j41(16,"label",148),e.EFF(17,"Have Form 1098-T (Tuition Statement)"),e.k0s()()()(),e.j41(18,"div",1)(19,"div",35)(20,"label",36),e.EFF(21,"Child & Dependent Care Expenses"),e.k0s(),e.nrm(22,"input",149),e.k0s()(),e.DNE(23,be,9,0,"div",15),e.j41(24,"div",1)(25,"div",35)(26,"label",36),e.EFF(27,"Adoption Expenses"),e.k0s(),e.nrm(28,"input",150),e.k0s(),e.j41(29,"div",35)(30,"label",36),e.EFF(31,"Energy-Efficient Home Upgrades"),e.k0s(),e.nrm(32,"input",151),e.k0s()()()()}if(2&i){let t;const n=e.XpG(2);e.R7$(23),e.Y8G("ngIf",(null==(t=n.intakeForm.get("credits.childCareExpenses"))?null:t.value)>0)}}function Ce(i,r){if(1&i){const t=e.RV6();e.j41(0,"div")(1,"div",30)(2,"h5",31),e.EFF(3,"\u{1f4c2} Section G. Prior Year & IRS Notices"),e.k0s(),e.j41(4,"button",32),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.clearSection(6))}),e.nrm(5,"i",33),e.EFF(6,"Clear Section "),e.k0s()(),e.j41(7,"div",154)(8,"div",129)(9,"label",36),e.EFF(10,"Did you file taxes last year?"),e.k0s(),e.j41(11,"div",86),e.nrm(12,"input",155),e.j41(13,"label",156),e.EFF(14,"Yes"),e.k0s()(),e.j41(15,"div",86),e.nrm(16,"input",157),e.j41(17,"label",158),e.EFF(18,"No"),e.k0s()()(),e.j41(19,"div",129)(20,"div",86),e.nrm(21,"input",159),e.j41(22,"label",160),e.EFF(23,"Received IRS or State Notices"),e.k0s()()(),e.j41(24,"div",61)(25,"label",36),e.EFF(26,"Other Notes or Questions"),e.k0s(),e.nrm(27,"textarea",161),e.k0s()()()}2&i&&(e.R7$(12),e.Y8G("value",!0),e.R7$(4),e.Y8G("value",!1))}function ke(i,r){if(1&i){const t=e.RV6();e.j41(0,"button",162),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.submitForm())}),e.nrm(1,"i",163),e.EFF(2,"Submit Form "),e.k0s()}if(2&i){const t=e.XpG(2);e.Y8G("disabled",!t.intakeForm.valid||t.isLoading)}}function xe(i,r){if(1&i){const t=e.RV6();e.j41(0,"button",164),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.nextSection())}),e.EFF(1," Next"),e.nrm(2,"i",165),e.k0s()}}function Fe(i,r){if(1&i){const t=e.RV6();e.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"form",21),e.DNE(5,ne,87,4,"div",22)(6,ce,13,2,"div",22)(7,ue,13,2,"div",22)(8,he,64,3,"div",22)(9,_e,46,2,"div",22)(10,ve,33,1,"div",22)(11,Ce,28,2,"div",22),e.j41(12,"div",23)(13,"button",24),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.previousSection())}),e.nrm(14,"i",25),e.EFF(15,"Previous "),e.k0s(),e.j41(16,"div")(17,"button",26),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.autoSave())}),e.nrm(18,"i",27),e.EFF(19,"Save Draft "),e.k0s(),e.DNE(20,ke,3,1,"button",28)(21,xe,3,0,"button",29),e.k0s()()()()()()()}if(2&i){const t=e.XpG();e.R7$(4),e.Y8G("formGroup",t.intakeForm),e.R7$(),e.Y8G("ngIf",0===t.currentSection),e.R7$(),e.Y8G("ngIf",1===t.currentSection),e.R7$(),e.Y8G("ngIf",2===t.currentSection),e.R7$(),e.Y8G("ngIf",3===t.currentSection),e.R7$(),e.Y8G("ngIf",4===t.currentSection),e.R7$(),e.Y8G("ngIf",5===t.currentSection),e.R7$(),e.Y8G("ngIf",6===t.currentSection),e.R7$(2),e.Y8G("disabled",0===t.currentSection),e.R7$(4),e.Y8G("disabled",t.isSaving),e.R7$(3),e.Y8G("ngIf",t.currentSection===t.sections.length-1),e.R7$(),e.Y8G("ngIf",t.currentSection<t.sections.length-1)}}function ye(i,r){1&i&&(e.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",166)(4,"div",167)(5,"span",12),e.EFF(6,"Loading..."),e.k0s()(),e.j41(7,"p",168),e.EFF(8,"Loading your intake form..."),e.k0s()()()()())}let je=(()=>{class i{constructor(t,n,o){this.fb=t,this.apiService=n,this.route=o,this.destroy$=new v.B,this.currentSection=0,this.progress=0,this.isLoading=!1,this.isSaving=!1,this.formId=1,this.projectId=null,this.clientId=null,this.ssnMasked={},this.sections=[{id:0,title:"Personal Information",description:"Basic personal and contact information",icon:"ri-user-line",completed:!1,required:!0},{id:1,title:"Dependents",description:"Information about dependents and children",icon:"ri-group-line",completed:!1,required:!1},{id:2,title:"Income",description:"All sources of income for the tax year",icon:"ri-money-dollar-circle-line",completed:!1,required:!0},{id:3,title:"Deductions & Adjustments",description:"Itemized deductions and income adjustments",icon:"ri-calculator-line",completed:!1,required:!1},{id:4,title:"Health Coverage",description:"Health insurance coverage information",icon:"ri-heart-pulse-line",completed:!1,required:!0},{id:5,title:"Credits",description:"Tax credits and education expenses",icon:"ri-award-line",completed:!1,required:!1},{id:6,title:"Prior Year & IRS Notices",description:"Previous year information and IRS correspondence",icon:"ri-file-text-line",completed:!1,required:!1}],this.initializeForm();const s=localStorage.getItem("currentUser");s&&(this.currentUser=JSON.parse(s))}ngOnInit(){this.route.queryParams.subscribe(t=>{this.projectId=t.projectId?+t.projectId:null,this.clientId=t.clientId?+t.clientId:null}),this.loadExistingData(),this.setupAutoSave(),this.progress=0}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}initializeForm(){this.intakeForm=this.fb.group({personalInformation:this.fb.group({fullName:["",a.k0.required],dateOfBirth:["",a.k0.required],ssn:["",[a.k0.required,a.k0.pattern(/^\d{3}-\d{2}-\d{4}$/)]],maritalStatus:["",a.k0.required],spouseName:[""],spouseSsn:[""],address:this.fb.group({street:["",a.k0.required],city:["",a.k0.required],state:["",a.k0.required],zipCode:["",[a.k0.required,a.k0.pattern(/^\d{5}(-\d{4})?$/)]]}),phone:["",[a.k0.required,a.k0.pattern(/^\(\d{3}\) \d{3}-\d{4}$/)]],email:["",[a.k0.required,a.k0.email]],driverLicense:this.fb.group({number:[""],state:[""],expiration:[""]})}),dependents:this.fb.array([]),incomeSource:this.fb.array([]),deductionsAdjustments:this.fb.group({mortgageInterest:[!1],mortgageAmount:[0],propertyTaxes:[!1],propertyTaxAmount:[0],charitableCash:[0],charitableNonCash:[0],studentLoanInterest:[!1],studentLoanAmount:[0],iraContributions:[0],iraType:[""],medicalExpenses:[0],otherAdjustments:[""]}),healthCoverage:this.fb.group({hadInsuranceAllYear:[null,a.k0.required],marketplaceCoverage:[!1],employerCoverage:[!1],form1095A:[!1],form1095B:[!1],form1095C:[!1]}),credits:this.fb.group({educationExpenses:[0],tuition1098T:[!1],childCareExpenses:[0],childCareProviderName:[""],childCareProviderEin:[""],adoptionExpenses:[0],energyEfficiencyUpgrades:[0]}),priorYearInfo:this.fb.group({filedLastYear:[null],estimatedTaxPayments:this.fb.array([]),irsNotices:[!1],otherNotes:[""]})})}loadExistingData(){this.isLoading=!0,console.log("\u{1f504} Loading existing intake data"),console.log("Form ID:",this.formId),console.log("Auth token exists:",!!localStorage.getItem("authToken")),this.apiService.getMyIntakeResponse(this.formId).pipe((0,h.Q)(this.destroy$)).subscribe({next:t=>{console.log("\u2705 Load response received:",t),t.success&&t.response?(console.log("\u{1f4cb} Populating form with existing data"),console.log("Raw response data:",t.response),this.populateFormFromAPI(t.response)):console.log("\u2139\ufe0f No existing data found or response not successful"),this.isLoading=!1},error:t=>{console.error("\u274c Error loading intake form:",t),console.error("Error details:",{status:t.status,statusText:t.statusText,message:t.message,error:t.error}),404!==t.status?401===t.status||400===t.status?(console.error("\u{1f6a8} Authentication issue while loading data"),u().fire({title:"Authentication Error",text:"Your session may have expired. Please log in again.",icon:"warning",confirmButtonText:"Login",showCancelButton:!0}).then(n=>{n.isConfirmed&&(window.location.href="/account/login")})):u().fire({title:"Error",text:"Failed to load existing form data.",icon:"error"}):console.log("\u2139\ufe0f No existing data found (404)"),this.isLoading=!1}})}populateFormFromAPI(t){try{let n;if(console.log("\u{1f50d} Parsing form data:",t),t.answersJson?(n="string"==typeof t.answersJson?JSON.parse(t.answersJson):t.answersJson,console.log("\u{1f4ca} Parsed answersJson:",n)):t.responseJson&&"string"==typeof t.responseJson?(n=JSON.parse(t.responseJson),console.log("\u{1f4ca} Parsed responseJson (fallback):",n)):t.responseJson&&"object"==typeof t.responseJson?(n=t.responseJson,console.log("\u{1f4ca} Using responseJson object (fallback):",n)):(n=t,console.log("\u{1f4ca} Using data directly:",n)),n.personalInfo){const o={...n.personalInfo};o.firstName&&o.lastName&&!o.fullName&&(o.fullName=`${o.firstName} ${o.lastName}`),this.intakeForm.get("personalInformation")?.patchValue(o)}if(n.incomeInfo){if(n.incomeInfo.sources&&n.incomeInfo.sources.length>0){const o=this.intakeForm.get("incomeSource");n.incomeInfo.sources.forEach(s=>{o.push(this.createIncomeGroup(s))})}if(n.incomeInfo.dependents&&n.incomeInfo.dependents.length>0){const o=this.intakeForm.get("dependents");n.incomeInfo.dependents.forEach(s=>{o.push(this.createDependentGroup(s))})}}if(n.deductionsInfo){const o={...n.deductionsInfo};o.healthCoverage&&(this.intakeForm.get("healthCoverage")?.patchValue(o.healthCoverage),delete o.healthCoverage),o.credits&&(this.intakeForm.get("credits")?.patchValue(o.credits),delete o.credits),o.priorYearInfo&&(this.intakeForm.get("priorYearInfo")?.patchValue(o.priorYearInfo),delete o.priorYearInfo),this.intakeForm.get("deductionsAdjustments")?.patchValue(o)}this.updateProgress()}catch(n){console.error("Error parsing intake form data:",n),this.updateProgress()}}setupAutoSave(){this.intakeForm.valueChanges.pipe((0,y.B)(2e3),(0,j.F)(),(0,h.Q)(this.destroy$)).subscribe(()=>{this.autoSave()})}autoSave(){if(!this.isSaving){this.isSaving=!0;const t=this.prepareAPIFormData();console.log("\u{1f504} Auto-save triggered"),console.log("\u{1f4cb} Form data structure:",Object.keys(JSON.parse(t.responseJson))),console.log("\u{1f511} Auth token check:",!!localStorage.getItem("authToken"));const n={...t,projectId:this.projectId,clientId:this.clientId};this.apiService.saveMyIntakeDraft(this.formId,n).pipe((0,h.Q)(this.destroy$)).subscribe({next:o=>{if(this.isSaving=!1,this.updateProgress(),console.log("\u2705 Auto-save successful:",o),o.success){const s=document.createElement("div");s.className="toast-container position-fixed top-0 end-0 p-3",s.innerHTML='\n                <div class="toast show" role="alert">\n                  <div class="toast-body bg-success text-white">\n                    <i class="ri-check-line me-1"></i>Draft saved successfully\n                  </div>\n                </div>\n              ',document.body.appendChild(s),setTimeout(()=>document.body.removeChild(s),3e3)}},error:o=>{this.isSaving=!1,console.error("\u274c Auto-save failed:",o),console.error("Error details:",{status:o.status,statusText:o.statusText,message:o.message,error:o.error}),401===o.status||400===o.status?(console.error("\u{1f6a8} Authentication issue detected"),console.error("Current token:",localStorage.getItem("authToken")?"exists":"missing"),u().fire({title:"Authentication Error",text:"Your session may have expired. Please log in again.",icon:"warning",confirmButtonText:"Login",showCancelButton:!0}).then(s=>{s.isConfirmed&&(window.location.href="/account/login")})):u().fire({title:"Save Failed",text:"Unable to save draft. Please try again.",icon:"error",timer:3e3,showConfirmButton:!1})}})}}prepareAPIFormData(){const t=this.intakeForm.value,n={personalInfo:{firstName:t.personalInformation?.fullName?.split(" ")[0]||"",lastName:t.personalInformation?.fullName?.split(" ").slice(1).join(" ")||"",email:t.personalInformation?.email||"",phone:t.personalInformation?.phone||"",dateOfBirth:t.personalInformation?.dateOfBirth||"",ssn:t.personalInformation?.ssn||"",maritalStatus:t.personalInformation?.maritalStatus||"",address:t.personalInformation?.address||{}},incomeInfo:{sources:t.incomeSource||[],dependents:t.dependents||[],estimatedIncome:this.calculateTotalIncome(t.incomeSource||[])},deductionsInfo:{...t.deductionsAdjustments,healthCoverage:t.healthCoverage,credits:t.credits,priorYearInfo:t.priorYearInfo},documentsInfo:{currentSection:this.currentSection,progress:this.progress,lastSaved:(new Date).toISOString(),completedSections:this.sections.filter(o=>o.completed).length},additionalInfo:{formVersion:"1.0",submissionSource:"client-portal"}};return{responseJson:JSON.stringify(n)}}prepareLegacyAPIFormData(){const t=this.prepareAPIFormData();return{formId:1,responseJson:JSON.stringify(t)}}calculateTotalIncome(t){return t.reduce((n,o)=>n+(o.amount||0),0)}updateProgress(){this.progress=this.calculateProgress()}calculateProgress(){this.sections.forEach((o,s)=>{o.completed=this.isSectionCompleted(s)});const t=this.sections.length,n=this.sections.filter(o=>o.completed).length;return Math.round(n/t*100)}isSectionCompleted(t){const n=this.intakeForm.value;switch(t){case 0:const o=n.personalInformation;return!!(o?.fullName&&o?.ssn&&o?.address?.street);case 1:case 3:case 5:return!0;case 2:return n.incomeSource&&n.incomeSource.length>0;case 4:return null!==n.healthCoverage?.hadInsuranceAllYear;case 6:return null!==n.priorYearInfo?.filedLastYear;default:return!1}}goToSection(t){this.currentSection=t}nextSection(){this.currentSection<this.sections.length-1&&this.currentSection++}previousSection(){this.currentSection>0&&this.currentSection--}get dependentsArray(){return this.intakeForm.get("dependents")}get incomeArray(){return this.intakeForm.get("incomeSource")}createDependentGroup(t){return this.fb.group({id:[t?.id||this.generateId()],name:[t?.name||"",a.k0.required],ssn:[t?.ssn||"",[a.k0.required,a.k0.pattern(/^\d{3}-\d{2}-\d{4}$/)]],dateOfBirth:[t?.dateOfBirth||"",a.k0.required],relationship:[t?.relationship||"",a.k0.required],monthsLivedWithYou:[t?.monthsLivedWithYou||12,[a.k0.min(1),a.k0.max(12)]],fullYear:[void 0===t?.fullYear||t.fullYear],childCareExpenses:[t?.childCareExpenses||!1],childCareAmount:[t?.childCareAmount||0]})}createIncomeGroup(t){return this.fb.group({id:[t?.id||this.generateId()],type:[t?.type||"",a.k0.required],description:[t?.description||"",a.k0.required],amount:[t?.amount||0,[a.k0.required,a.k0.min(0)]],employerName:[t?.employerName||""],details:[t?.details||{}]})}addDependent(){this.dependentsArray.push(this.createDependentGroup())}removeDependent(t){this.dependentsArray.removeAt(t)}addIncomeSource(){this.incomeArray.push(this.createIncomeGroup())}removeIncomeSource(t){this.incomeArray.removeAt(t)}toggleSSNMask(t){this.ssnMasked[t]=!this.ssnMasked[t]}isSSNMasked(t){return!1!==this.ssnMasked[t]}getDisplaySSN(t,n){return this.isSSNMasked(n)?this.maskSSN(t):t}maskSSN(t){if(!t)return"";const n=t.replace(/\D/g,"");return n.length>=9?`***-**-${n.slice(-4)}`:t}formatSSNInput(t,n){const s=this.formatSSN(t.target.value);this.intakeForm.get(n)?.setValue(s)}formatSSN(t){const n=t.replace(/\D/g,"");return n.length>=9?`${n.slice(0,3)}-${n.slice(3,5)}-${n.slice(5,9)}`:n.length>=5?`${n.slice(0,3)}-${n.slice(3,5)}-${n.slice(5)}`:n.length>=3?`${n.slice(0,3)}-${n.slice(3)}`:n}generateId(){return Math.random().toString(36).substr(2,9)}formatPhoneInput(t,n){const o=t.target.value.replace(/\D/g,"");let s="";s=o.length>=10?`(${o.slice(0,3)}) ${o.slice(3,6)}-${o.slice(6,10)}`:o.length>=6?`(${o.slice(0,3)}) ${o.slice(3,6)}-${o.slice(6)}`:o.length>=3?`(${o.slice(0,3)}) ${o.slice(3)}`:o,this.intakeForm.get(n)?.setValue(s)}clearSection(t){u().fire({title:"Clear Section",text:`Are you sure you want to clear all data in the "${this.sections[t].title}" section?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, Clear Section",cancelButtonText:"Cancel"}).then(n=>{n.isConfirmed&&this.performClearSection(t)})}performClearSection(t){switch(t){case 0:this.intakeForm.get("personalInformation")?.reset();break;case 1:const n=this.intakeForm.get("dependents");for(;0!==n.length;)n.removeAt(0);break;case 2:const o=this.intakeForm.get("incomeSource");for(;0!==o.length;)o.removeAt(0);break;case 3:this.intakeForm.get("deductionsAdjustments")?.reset();break;case 4:this.intakeForm.get("healthCoverage")?.reset();break;case 5:this.intakeForm.get("credits")?.reset();break;case 6:this.intakeForm.get("priorYearInfo")?.reset();const s=this.intakeForm.get("priorYearInfo.estimatedTaxPayments");if(s)for(;0!==s.length;)s.removeAt(0)}this.updateProgress(),u().fire({title:"Section Cleared",text:`The "${this.sections[t].title}" section has been cleared.`,icon:"success",timer:2e3,showConfirmButton:!1})}submitForm(){this.intakeForm.valid?u().fire({title:"Submit Intake Form",text:"Are you sure you want to submit your tax intake form? You won't be able to make changes after submission.",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, Submit"}).then(t=>{t.isConfirmed&&this.performSubmit()}):u().fire({title:"Form Incomplete",text:"Please complete all required sections before submitting.",icon:"warning"})}performSubmit(){this.isLoading=!0;const t=this.prepareAPIFormData(),n=JSON.parse(t.responseJson);n.documentsInfo={...n.documentsInfo,status:"submitted",submittedAt:(new Date).toISOString()};const s={responseJson:JSON.stringify(n),projectId:this.projectId,clientId:this.clientId};this.apiService.submitMyIntakeResponse(this.formId,s).pipe((0,h.Q)(this.destroy$)).subscribe({next:c=>{this.isLoading=!1,c.success?u().fire({title:"Success!",text:"Your tax intake form has been submitted successfully.",icon:"success"}):u().fire({title:"Error",text:c.message||"There was an error submitting your form.",icon:"error"})},error:c=>{this.isLoading=!1,u().fire({title:"Error",text:"There was an error submitting your form. Please try again.",icon:"error"}),console.error("Submit error:",c)}})}static{this.\u0275fac=function(n){return new(n||i)(e.rXU(a.ok),e.rXU(C.G),e.rXU(_.nX))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-tax-intake"]],decls:20,vars:10,consts:[[1,"container-fluid"],[1,"row"],[1,"col-12"],[1,"card"],[1,"card-body"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"card-title","mb-0"],[1,"d-flex","align-items-center"],["class","badge bg-info me-2",4,"ngIf"],[1,"text-muted"],[1,"progress","mb-3",2,"height","12px"],["role","progressbar","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","bg-info"],[1,"visually-hidden"],[1,"d-flex","flex-wrap","gap-2"],["type","button","class","btn btn-sm btn-info",3,"click",4,"ngFor","ngForOf"],["class","row",4,"ngIf"],[1,"badge","bg-info","me-2"],["type","button",1,"btn","btn-sm","btn-info",3,"click"],[1,"me-1"],["class","ri-check-line ms-1",4,"ngIf"],[1,"ri-check-line","ms-1"],[3,"formGroup"],[4,"ngIf"],[1,"d-flex","justify-content-between","mt-4"],["type","button",1,"btn","btn-outline-secondary",3,"click","disabled"],[1,"ri-arrow-left-line","me-1"],["type","button",1,"btn","btn-info","me-2",3,"click","disabled"],[1,"ri-save-line","me-1"],["type","button","class","btn btn-info",3,"disabled","click",4,"ngIf"],["type","button","class","btn btn-info",3,"click",4,"ngIf"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"mb-0"],["type","button",1,"btn","btn-outline-danger","btn-sm",3,"click"],[1,"ri-delete-bin-line","me-1"],["formGroupName","personalInformation"],[1,"col-md-6","mb-3"],[1,"form-label"],["type","text","formControlName","fullName",1,"form-control"],["type","date","formControlName","dateOfBirth",1,"form-control"],[1,"input-group"],["type","text","placeholder","***-**-****",1,"form-control",3,"input","value"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["class","ri-eye-line",4,"ngIf"],["class","ri-eye-off-line",4,"ngIf"],["formControlName","maritalStatus",1,"form-select"],["value",""],["value","single"],["value","married-jointly"],["value","married-separately"],["value","head-of-household"],["value","qualifying-widower"],["formGroupName","address"],[1,"col-12","mb-3"],["type","text","formControlName","street",1,"form-control"],[1,"col-md-4","mb-3"],["type","text","formControlName","city",1,"form-control"],["type","text","formControlName","state",1,"form-control"],["type","text","formControlName","zipCode",1,"form-control"],["type","tel","formControlName","phone","placeholder","(555) 123-4567",1,"form-control",3,"input"],["type","email","formControlName","email",1,"form-control"],["formGroupName","driverLicense"],[1,"mb-3"],["type","text","formControlName","number",1,"form-control"],["type","date","formControlName","expiration",1,"form-control"],[1,"ri-eye-line"],[1,"ri-eye-off-line"],["type","text","formControlName","spouseName",1,"form-control"],[1,"d-flex","gap-2"],["type","button",1,"btn","btn-info","btn-sm",3,"click"],[1,"ri-add-line","me-1"],["class","text-center text-muted py-4",4,"ngIf"],["class","card mb-3",4,"ngFor","ngForOf"],[1,"text-center","text-muted","py-4"],[1,"ri-group-line","font-size-48","mb-3","d-block"],[1,"card","mb-3"],[1,"card-header","d-flex","justify-content-between","align-items-center"],[1,"ri-delete-bin-line"],[1,"card-body",3,"formGroup"],["type","text","formControlName","name",1,"form-control"],["formControlName","relationship",1,"form-select"],["value","son"],["value","daughter"],["value","stepchild"],["value","grandchild"],["value","other"],["type","number","formControlName","monthsLivedWithYou","min","1","max","12",1,"form-control"],[1,"form-check"],["type","checkbox","formControlName","fullYear",1,"form-check-input",3,"id"],[1,"form-check-label",3,"for"],["type","checkbox","formControlName","childCareExpenses",1,"form-check-input",3,"id"],["type","number","formControlName","childCareAmount","min","0",1,"form-control"],[1,"ri-money-dollar-circle-line","font-size-48","mb-3","d-block"],["formControlName","type",1,"form-select"],["value","w2"],["value","1099-nec"],["value","1099-misc"],["value","1099-int"],["value","1099-div"],["value","1099-b"],["value","1099-r"],["value","ssa-1099"],["value","rental"],["value","business"],["type","text","formControlName","description","placeholder","e.g., ABC Company, Rental Property",1,"form-control"],["type","number","formControlName","amount","min","0","step","0.01",1,"form-control"],["type","text","formControlName","employerName",1,"form-control"],["formGroupName","deductionsAdjustments"],["type","checkbox","formControlName","mortgageInterest","id","mortgageInterest",1,"form-check-input"],["for","mortgageInterest",1,"form-check-label"],["class","mt-2",4,"ngIf"],["type","checkbox","formControlName","propertyTaxes","id","propertyTaxes",1,"form-check-input"],["for","propertyTaxes",1,"form-check-label"],["type","number","formControlName","charitableCash","min","0",1,"form-control"],["type","number","formControlName","charitableNonCash","min","0",1,"form-control"],["type","checkbox","formControlName","studentLoanInterest","id","studentLoanInterest",1,"form-check-input"],["for","studentLoanInterest",1,"form-check-label"],["type","number","formControlName","iraContributions","min","0",1,"form-control"],["formControlName","iraType",1,"form-select"],["value","traditional"],["value","roth"],["value","401k"],["value","403b"],["type","number","formControlName","medicalExpenses","min","0",1,"form-control"],["formControlName","otherAdjustments","rows","3","placeholder","Describe any other deductions or adjustments",1,"form-control"],[1,"mt-2"],["type","number","formControlName","mortgageAmount","placeholder","Amount","min","0",1,"form-control"],["type","number","formControlName","propertyTaxAmount","placeholder","Amount","min","0",1,"form-control"],["type","number","formControlName","studentLoanAmount","placeholder","Amount","min","0",1,"form-control"],["formGroupName","healthCoverage"],[1,"mb-4"],["type","radio","formControlName","hadInsuranceAllYear","id","insurance_yes",1,"form-check-input",3,"value"],["for","insurance_yes",1,"form-check-label"],["type","radio","formControlName","hadInsuranceAllYear","id","insurance_no",1,"form-check-input",3,"value"],["for","insurance_no",1,"form-check-label"],["type","checkbox","formControlName","marketplaceCoverage","id","marketplace",1,"form-check-input"],["for","marketplace",1,"form-check-label"],["type","checkbox","formControlName","employerCoverage","id","employer",1,"form-check-input"],["for","employer",1,"form-check-label"],["type","checkbox","formControlName","form1095A","id","form1095A",1,"form-check-input"],["for","form1095A",1,"form-check-label"],["type","checkbox","formControlName","form1095B","id","form1095B",1,"form-check-input"],["for","form1095B",1,"form-check-label"],["type","checkbox","formControlName","form1095C","id","form1095C",1,"form-check-input"],["for","form1095C",1,"form-check-label"],["formGroupName","credits"],["type","number","formControlName","educationExpenses","min","0",1,"form-control"],[1,"form-check","mt-4"],["type","checkbox","formControlName","tuition1098T","id","tuition1098T",1,"form-check-input"],["for","tuition1098T",1,"form-check-label"],["type","number","formControlName","childCareExpenses","min","0",1,"form-control"],["type","number","formControlName","adoptionExpenses","min","0",1,"form-control"],["type","number","formControlName","energyEfficiencyUpgrades","min","0",1,"form-control"],["type","text","formControlName","childCareProviderName",1,"form-control"],["type","text","formControlName","childCareProviderEin",1,"form-control"],["formGroupName","priorYearInfo"],["type","radio","formControlName","filedLastYear","id","filed_yes",1,"form-check-input",3,"value"],["for","filed_yes",1,"form-check-label"],["type","radio","formControlName","filedLastYear","id","filed_no",1,"form-check-input",3,"value"],["for","filed_no",1,"form-check-label"],["type","checkbox","formControlName","irsNotices","id","irsNotices",1,"form-check-input"],["for","irsNotices",1,"form-check-label"],["formControlName","otherNotes","rows","4","placeholder","Any additional information, questions, or special circumstances you'd like your accountant to know about",1,"form-control"],["type","button",1,"btn","btn-info",3,"click","disabled"],[1,"ri-send-plane-line","me-1"],["type","button",1,"btn","btn-info",3,"click"],[1,"ri-arrow-right-line","ms-1"],[1,"card-body","text-center","py-5"],["role","status",1,"spinner-border","text-primary"],[1,"mt-3","text-muted"]],template:function(n,o){1&n&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"h4",6),e.EFF(7,"\u{1f4c4} Client Tax Intake Form"),e.k0s(),e.j41(8,"div",7),e.DNE(9,H,2,0,"span",8),e.j41(10,"span",9),e.EFF(11),e.k0s()()(),e.j41(12,"div",10)(13,"div",11)(14,"span",12),e.EFF(15),e.k0s()()(),e.j41(16,"div",13),e.DNE(17,Q,4,4,"button",14),e.k0s()()()()(),e.DNE(18,Fe,22,12,"div",15)(19,ye,9,0,"div",15),e.k0s()),2&n&&(e.R7$(9),e.Y8G("ngIf",o.isSaving),e.R7$(2),e.Lme("Step ",o.currentSection+1," of ",o.sections.length,""),e.R7$(2),e.xc7("width",o.progress,"%"),e.BMQ("aria-valuenow",o.progress),e.R7$(2),e.SpI("",o.progress,"% Complete"),e.R7$(2),e.Y8G("ngForOf",o.sections),e.R7$(),e.Y8G("ngIf",!o.isLoading),e.R7$(),e.Y8G("ngIf",o.isLoading))},dependencies:[m.Sq,m.bT,a.qT,a.xH,a.y7,a.me,a.Q0,a.Zm,a.wz,a.Fm,a.BC,a.cb,a.VZ,a.zX,a.j4,a.JD,a.$R],styles:['.progress[_ngcontent-%COMP%]{background-color:#e9ecef;border-radius:8px;height:12px!important}.progress-bar[_ngcontent-%COMP%]{background-color:#17a2b8!important;border-radius:8px;transition:width .6s ease}.progress-bar.bg-info[_ngcontent-%COMP%]{background-color:#17a2b8!important}.btn-sm[_ngcontent-%COMP%]{font-size:.875rem;padding:.375rem .75rem;border-radius:6px}.btn-sm.btn-success[_ngcontent-%COMP%]{background-color:#28a745;border-color:#28a745}.btn-sm.btn-success[_ngcontent-%COMP%]:hover{background-color:#218838;border-color:#1e7e34}.btn-sm.btn-primary[_ngcontent-%COMP%]{background-color:#405189;border-color:#405189}.btn-sm.btn-primary[_ngcontent-%COMP%]:hover{background-color:#364574;border-color:#2f3d66}.card[_ngcontent-%COMP%]{border:1px solid #e9ecef;border-radius:8px;box-shadow:0 .125rem .25rem #00000013}.card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{background-color:#f8f9fa;border-bottom:1px solid #e9ecef;padding:1rem 1.25rem}.card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{color:#495057;font-weight:600}.card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{padding:1.5rem}.form-label[_ngcontent-%COMP%]{font-weight:500;color:#495057;margin-bottom:.5rem}.form-control[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{border:1px solid #ced4da;border-radius:6px;padding:.5rem .75rem;font-size:.875rem}.form-control[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{border-color:#405189;box-shadow:0 0 0 .2rem #40518940}.form-control.is-invalid[_ngcontent-%COMP%], .form-select.is-invalid[_ngcontent-%COMP%]{border-color:#dc3545}.form-control.is-invalid[_ngcontent-%COMP%]:focus, .form-select.is-invalid[_ngcontent-%COMP%]:focus{border-color:#dc3545;box-shadow:0 0 0 .2rem #dc354540}.input-group[_ngcontent-%COMP%]   .btn-outline-secondary[_ngcontent-%COMP%]{border-color:#ced4da;color:#6c757d}.input-group[_ngcontent-%COMP%]   .btn-outline-secondary[_ngcontent-%COMP%]:hover{background-color:#f8f9fa;border-color:#adb5bd;color:#495057}.input-group[_ngcontent-%COMP%]   .btn-outline-secondary[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 .2rem #6c757d40}.form-check[_ngcontent-%COMP%]   .form-check-input[_ngcontent-%COMP%]:checked{background-color:#405189;border-color:#405189}.form-check[_ngcontent-%COMP%]   .form-check-input[_ngcontent-%COMP%]:focus{border-color:#405189;box-shadow:0 0 0 .2rem #40518940}.form-check[_ngcontent-%COMP%]   .form-check-label[_ngcontent-%COMP%]{font-weight:500;color:#495057}.text-muted[_ngcontent-%COMP%]{color:#6c757d!important}.font-size-48[_ngcontent-%COMP%]{font-size:3rem!important}.badge.bg-info[_ngcontent-%COMP%]{background-color:#17a2b8!important}.btn-outline-danger[_ngcontent-%COMP%]{color:#dc3545;border-color:#dc3545}.btn-outline-danger[_ngcontent-%COMP%]:hover{background-color:#dc3545;border-color:#dc3545;color:#fff}.spinner-border[_ngcontent-%COMP%]{width:3rem;height:3rem}h5[_ngcontent-%COMP%]{color:#405189;font-weight:600;margin-bottom:1.5rem}h6[_ngcontent-%COMP%]{color:#495057;font-weight:600}@media (max-width: 768px){.d-flex.flex-wrap.gap-2[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-bottom:.5rem;font-size:.75rem}.d-flex.flex-wrap.gap-2[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.875rem}.card-body[_ngcontent-%COMP%]{padding:1rem}.container-fluid[_ngcontent-%COMP%]{padding-left:.75rem;padding-right:.75rem}}.card-body[_ngcontent-%COMP%]   form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease-in-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.form-label[_ngcontent-%COMP%]:after{content:""}.form-label[_ngcontent-%COMP%]:has( + input[required])[_ngcontent-%COMP%]:after, .form-label[_ngcontent-%COMP%]:has( + select[required])[_ngcontent-%COMP%]:after, .form-label[_ngcontent-%COMP%]:has( + textarea[required])[_ngcontent-%COMP%]:after{content:" *";color:#dc3545}.input-group[_ngcontent-%COMP%]   .form-control[placeholder*="***"][_ngcontent-%COMP%]{font-family:monospace;letter-spacing:1px}.progress[_ngcontent-%COMP%]{position:relative}.progress[_ngcontent-%COMP%]:after{content:attr(data-progress) "%";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:.75rem;font-weight:600;color:#495057}']})}}return i})();var k=l(467),Ie=l(5538),Me=l(8010);const Se=["messagesContainer"];function Te(i,r){1&i&&(e.j41(0,"div",50)(1,"div",51)(2,"span",52),e.EFF(3,"Initializing..."),e.k0s()(),e.j41(4,"small",53),e.EFF(5,"Loading chat..."),e.k0s()())}function Pe(i,r){if(1&i&&(e.j41(0,"div",54)(1,"span",55),e.EFF(2),e.k0s()()),2&i){const t=e.XpG(2).$implicit,n=e.XpG(2);e.R7$(2),e.JRh(null!=t&&t.timestamp?n.formatDate(t.timestamp):"Today")}}function Ee(i,r){1&i&&e.nrm(0,"i",71)}function Oe(i,r){1&i&&e.nrm(0,"i",72)}function Ne(i,r){if(1&i&&(e.j41(0,"div",67)(1,"div",68),e.DNE(2,Ee,1,0,"i",69)(3,Oe,1,0,"i",70),e.k0s()()),2&i){const t=e.XpG(2).$implicit,n=e.XpG(2);e.R7$(),e.AVh("bg-primary","accountant"===n.chatMode&&"ACCOUNTANT"===t.senderType)("bg-gradient-ai","ai"===n.chatMode||n.isAIMessage(t)),e.R7$(),e.Y8G("ngIf","accountant"===n.chatMode&&"ACCOUNTANT"===t.senderType),e.R7$(),e.Y8G("ngIf","ai"===n.chatMode||n.isAIMessage(t))}}function De(i,r){if(1&i&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&i){const t=e.XpG(3).$implicit;e.R7$(),e.JRh(t.senderName)}}function we(i,r){1&i&&(e.j41(0,"span"),e.EFF(1,"AI Tax Assistant"),e.k0s())}function Re(i,r){if(1&i&&(e.j41(0,"div",73),e.DNE(1,De,2,1,"span",23)(2,we,2,0,"span",23),e.k0s()),2&i){const t=e.XpG(2).$implicit,n=e.XpG(2);e.R7$(),e.Y8G("ngIf","accountant"===n.chatMode),e.R7$(),e.Y8G("ngIf","ai"===n.chatMode||n.isAIMessage(t))}}function Ge(i,r){1&i&&(e.j41(0,"div",78),e.nrm(1,"i",79),e.j41(2,"small",80),e.EFF(3,"Sending..."),e.k0s()())}function $e(i,r){if(1&i){const t=e.RV6();e.j41(0,"div",81),e.nrm(1,"i",82),e.j41(2,"small",83),e.EFF(3),e.k0s(),e.j41(4,"button",84),e.bIt("click",function(){e.eBV(t);const o=e.XpG(3).$implicit,s=e.XpG(2);return e.Njj(s.retryMessage(o))}),e.nrm(5,"i",85),e.EFF(6," Retry "),e.k0s()()}if(2&i){const t=e.XpG(3).$implicit;e.R7$(3),e.JRh(t.error||"Unable to send")}}function Ae(i,r){1&i&&(e.j41(0,"div",86),e.nrm(1,"i",87),e.k0s())}function Ye(i,r){if(1&i&&(e.j41(0,"div",74),e.DNE(1,Ge,4,0,"div",75)(2,$e,7,1,"div",76)(3,Ae,2,0,"div",77),e.k0s()),2&i){const t=e.XpG(2).$implicit;e.R7$(),e.Y8G("ngIf","sending"===t.status),e.R7$(),e.Y8G("ngIf","failed"===t.status),e.R7$(),e.Y8G("ngIf","sent"===t.status)}}function Be(i,r){1&i&&(e.j41(0,"div",88)(1,"button",89),e.nrm(2,"i",90),e.k0s()())}function Ue(i,r){1&i&&(e.j41(0,"div",67)(1,"div",91),e.nrm(2,"i",11),e.k0s()())}function Ve(i,r){if(1&i&&(e.j41(0,"div"),e.DNE(1,Pe,3,1,"div",58),e.j41(2,"div",59),e.DNE(3,Ne,4,6,"div",60),e.j41(4,"div",61),e.DNE(5,Re,3,2,"div",62),e.nrm(6,"div",63),e.j41(7,"div",64),e.EFF(8),e.k0s(),e.DNE(9,Ye,4,3,"div",65),e.k0s(),e.DNE(10,Be,3,0,"div",66)(11,Ue,3,0,"div",60),e.k0s()()),2&i){const t=e.XpG(),n=t.$implicit,o=t.index,s=e.XpG(2);e.R7$(),e.Y8G("ngIf",n&&s.shouldShowDateSeparator(o)),e.R7$(),e.AVh("message-sent",s.isUserMessage(n))("message-received",!s.isUserMessage(n)),e.R7$(),e.Y8G("ngIf",!s.isUserMessage(n)),e.R7$(),e.AVh("bubble-sent",s.isUserMessage(n))("bubble-received","accountant"===s.chatMode&&"ACCOUNTANT"===n.senderType)("bubble-ai","ai"===s.chatMode||s.isAIMessage(n))("message-failed","failed"===n.status)("message-sending","sending"===n.status),e.R7$(),e.Y8G("ngIf",!s.isUserMessage(n)),e.R7$(),e.Y8G("innerHTML",s.formatMessageContent(n),e.npT),e.R7$(2),e.JRh(null!=n&&n.timestamp?s.formatTime(n.timestamp):"Now"),e.R7$(),e.Y8G("ngIf",s.isUserMessage(n)),e.R7$(),e.Y8G("ngIf",!s.isUserMessage(n)),e.R7$(),e.Y8G("ngIf",s.isUserMessage(n))}}function ze(i,r){if(1&i&&(e.j41(0,"div",57),e.DNE(1,Ve,12,22,"div",23),e.k0s()),2&i){const t=r.$implicit;e.R7$(),e.Y8G("ngIf",t&&t.content)}}function Le(i,r){1&i&&(e.j41(0,"div",50)(1,"div",51)(2,"span",52),e.EFF(3,"Loading..."),e.k0s()(),e.j41(4,"small",53),e.EFF(5,"Loading messages..."),e.k0s()())}function Xe(i,r){if(1&i&&(e.j41(0,"div")(1,"div",54)(2,"span",55),e.EFF(3,"Today"),e.k0s()(),e.DNE(4,ze,2,1,"div",56)(5,Le,6,0,"div",22),e.k0s()),2&i){const t=e.XpG();e.R7$(4),e.Y8G("ngForOf",t.getMessagesForCurrentMode())("ngForTrackBy",t.trackByMessage),e.R7$(),e.Y8G("ngIf",t.isLoading)}}function Je(i,r){1&i&&(e.j41(0,"span",92),e.EFF(1,"Send"),e.k0s())}function He(i,r){1&i&&e.nrm(0,"span",93)}function qe(i,r){if(1&i){const t=e.RV6();e.j41(0,"div",94),e.bIt("click",function(){const o=e.eBV(t).$implicit,s=e.XpG();return e.Njj(s.selectAIConversation(o))}),e.j41(1,"div",95),e.EFF(2),e.k0s(),e.j41(3,"div",96)(4,"small",14),e.EFF(5),e.k0s()()()}if(2&i){const t=r.$implicit,n=e.XpG();e.AVh("active",(null==n.currentAIConversation?null:n.currentAIConversation.id)===t.id),e.R7$(2),e.JRh(t.title),e.R7$(3),e.Lme("",n.formatDate(t.updatedAt)," \u2022 ",t.messageCount," messages")}}function Qe(i,r){1&i&&(e.j41(0,"div",97),e.nrm(1,"i",98),e.j41(2,"p",99),e.EFF(3,"No conversations yet"),e.k0s()())}let We=(()=>{class i{constructor(t,n,o){this.chatService=t,this.authService=n,this.cdr=o,this.messages=[],this.currentThread=null,this.currentUser=null,this.newMessage="",this.isLoading=!1,this.isInitialized=!1,this.subscriptions=[],this.userJWT="",this.clientId=0,this.showConversationsList=!1,this.chatMode="accountant",this.aiConversations=[],this.currentAIConversation=null,this.currentUser=this.authService.currentUser(),this.userJWT=localStorage.getItem("authToken")||"",this.clientId=this.getCurrentUserClientId(),console.log("\u{1f527} Chat Component initialized with client ID:",this.clientId)}ngOnInit(){console.log("\u{1f504} Client Chat Manager initializing..."),this.initializeChatWithPolling()}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe())}initializeChat(){var t=this;return(0,k.A)(function*(){t.isLoading=!0;try{console.log("\u{1f4cb} Loading chat for client ID:",t.clientId);const n=t.chatService.getThread(t.clientId).subscribe({next:o=>{console.log("\u2705 Chat initialization response:",o),o.success?(t.currentThread={id:o.thread.id,clientId:t.clientId,clientName:t.getClientDisplayName(),clientEmail:t.currentUser?.email||"",lastActivity:new Date,unreadCount:0,messages:[]},o.messages&&o.messages.length>0?(t.messages=o.messages.map(s=>({id:s.id,content:s.body,senderId:s.senderId,senderName:t.isMyMessage(s.senderId)?"You":"Tax Consultant",senderType:t.isMyMessage(s.senderId)?"CLIENT":"ACCOUNTANT",timestamp:new Date(s.createdAt),threadId:s.threadId})),t.currentThread.messages=[...t.messages],console.log("\u{1f4e8} Loaded existing messages:",t.messages.length)):(console.log("\u2139\ufe0f No existing messages - ready for new conversation"),t.messages=[])):(console.log("\u26a0\ufe0f Creating new thread structure"),t.createNewThread()),t.isLoading=!1,t.isInitialized=!0,t.cdr.detectChanges(),t.scrollToBottom()},error:o=>{console.error("\u274c Chat initialization error:",o),t.createNewThread(),t.isLoading=!1,t.isInitialized=!0}});t.subscriptions.push(n)}catch(n){console.error("\u274c Failed to initialize chat:",n),t.createNewThread(),t.isLoading=!1,t.isInitialized=!0}})()}sendMessage(){var t=this;return(0,k.A)(function*(){if(!t.newMessage.trim()||!t.currentThread)return;const n=t.newMessage.trim();console.log("\u{1f4e4} Sending message:",n);const o={id:Date.now(),content:n,senderId:t.getCurrentUserId(),senderName:"You",senderType:"CLIENT",timestamp:new Date,threadId:t.currentThread.id,status:"sending"};t.messages.push(o),t.newMessage="",t.cdr.detectChanges(),t.scrollToBottom(),t.currentThread&&(t.currentThread.lastMessage=o,t.currentThread.messages=[...t.messages]);try{const c=t.chatService.sendMessage(t.clientId,{content:n,senderType:"CLIENT"},t.currentThread.id).subscribe({next:d=>{console.log("\u2705 Message sent successfully:",d);const p=t.messages.findIndex(g=>g.id===o.id);-1!==p&&d.id&&(t.messages[p]={...t.messages[p],id:d.id,timestamp:d.timestamp||t.messages[p].timestamp,status:"sent"},t.currentThread&&(t.currentThread.lastMessage=t.messages[p],t.currentThread.messages=[...t.messages]),t.cdr.detectChanges())},error:d=>{console.error("\u274c Failed to send message:",d);const p=t.messages.findIndex(g=>g.id===o.id);-1!==p&&(t.messages[p]={...t.messages[p],status:"failed",error:"Unable to send message. Please try again."},t.cdr.detectChanges(),t.currentThread&&(t.currentThread.messages=[...t.messages],t.currentThread.lastMessage=t.messages[t.messages.length-1]))}});t.subscriptions.push(c)}catch(s){console.error("\u274c Send message error:",s);const c=t.messages.findIndex(d=>d.id===o.id);-1!==c&&(t.messages[c]={...t.messages[c],status:"failed",error:"Unable to send message. Please check your connection."},t.cdr.detectChanges(),t.currentThread&&(t.currentThread.messages=[...t.messages],t.currentThread.lastMessage=t.messages[t.messages.length-1]))}})()}createNewThread(){this.currentThread={id:0,clientId:this.clientId,clientName:this.getClientDisplayName(),clientEmail:this.currentUser?.email||"",lastActivity:new Date,unreadCount:0,messages:[]},this.messages=[]}isMyMessage(t){return t===this.getCurrentUserId()}getCurrentUserId(){try{if(this.userJWT){const t=JSON.parse(atob(this.userJWT.split(".")[1]));return t.userId||t.id||this.currentUser?.id||0}}catch(t){console.error("Error extracting user ID from JWT:",t)}return this.currentUser?.id||0}getCurrentUserClientId(){const t=this.chatService.getCurrentUserClientId()||this.currentUser?.id||0;return console.log("\u{1f194} Client ID determined:",t),t}getClientDisplayName(){return this.currentUser?.firstName||this.currentUser?.lastName?`${this.currentUser.firstName||""} ${this.currentUser.lastName||""}`.trim():this.currentUser?.email||"You"}scrollToBottom(){try{setTimeout(()=>{if(this.messagesContainer){const t=this.messagesContainer.nativeElement;t.scrollTop=t.scrollHeight}},100)}catch(t){console.error("Error scrolling to bottom:",t)}}onKeyPress(t){"Enter"===t.key&&!t.shiftKey&&(t.preventDefault(),this.sendMessage())}formatTime(t){try{return("string"==typeof t?new Date(t):t).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}catch{return"Now"}}formatDate(t){try{return("string"==typeof t?new Date(t):t).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}catch{return"Today"}}startMessagePolling(){const t=setInterval(()=>{this.currentThread&&this.isInitialized&&this.checkForNewMessages()},5e3);this.subscriptions.push({unsubscribe:()=>clearInterval(t)})}checkForNewMessages(){if(!this.currentThread)return;const t=this.chatService.getThread(this.clientId).subscribe({next:n=>{if(n.success&&n.messages){const o=n.messages.filter(s=>!this.messages.some(c=>c.id===s.id));if(o.length>0){console.log("\u{1f4e8} Received new messages:",o.length);const s=o.map(c=>({id:c.id,content:c.body,senderId:c.senderId,senderName:this.isMyMessage(c.senderId)?"You":"Tax Consultant",senderType:this.isMyMessage(c.senderId)?"CLIENT":"ACCOUNTANT",timestamp:new Date(c.createdAt),threadId:c.threadId}));this.messages.push(...s),this.currentThread&&(this.currentThread.messages=[...this.messages],this.currentThread.lastMessage=s[s.length-1]),this.cdr.detectChanges(),this.scrollToBottom()}}},error:n=>{console.error("\u274c Failed to check for new messages:",n)}});this.subscriptions.push(t)}initializeChatWithPolling(){var t=this;return(0,k.A)(function*(){yield t.initializeChat(),t.isInitialized&&(t.startMessagePolling(),console.log("\u{1f504} Message polling started"))})()}retryMessage(t){if("failed"!==t.status||!this.currentThread)return;console.log("\u{1f504} Retrying failed message:",t.content);const n=this.messages.findIndex(o=>o.id===t.id);if(-1!==n){this.messages[n]={...this.messages[n],status:"sending",error:void 0},this.cdr.detectChanges();const s=this.chatService.sendMessage(this.clientId,{content:t.content,senderType:"CLIENT"},this.currentThread.id).subscribe({next:c=>{console.log("\u2705 Message retry successful:",c),-1!==n&&c.id&&(this.messages[n]={...this.messages[n],id:c.id,timestamp:c.timestamp||this.messages[n].timestamp,status:"sent"},this.cdr.detectChanges())},error:c=>{console.error("\u274c Message retry failed:",c),-1!==n&&(this.messages[n]={...this.messages[n],status:"failed",error:"Unable to send message. Please try again."},this.cdr.detectChanges())}});this.subscriptions.push(s)}}hideConversations(){this.showConversationsList=!1}selectAIConversation(t){console.log("AI conversation selection not available in client portal")}static{this.\u0275fac=function(n){return new(n||i)(e.rXU(Ie.m),e.rXU(Me.k),e.rXU(e.gRc))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-chat"]],viewQuery:function(n,o){if(1&n&&e.GBs(Se,5),2&n){let s;e.mGM(s=e.lsd())&&(o.messagesContainer=s.first)}},decls:59,vars:11,consts:[["messagesContainer",""],[1,"chat-container"],[1,"chat-header-section"],[1,"chat-mode-toggle","mb-3"],["role","group",1,"btn-group","w-100"],["type","button",1,"btn","btn-primary","w-100"],[1,"ri-user-3-line","me-2"],[1,"chat-header"],[1,"d-flex","align-items-center"],[1,"avatar-container","me-3"],[1,"avatar-circle","bg-primary"],[1,"ri-user-line","text-white"],[1,"status-indicator","active"],[1,"mb-0","chat-title"],[1,"text-muted"],[1,"chat-actions"],[1,"btn","btn-light","btn-sm","me-2"],[1,"ri-search-line"],[1,"ri-settings-3-line"],[1,"btn","btn-light","btn-sm"],[1,"ri-more-2-line"],[1,"chat-messages"],["class","loading-container",4,"ngIf"],[4,"ngIf"],[1,"p-3","chat-input-section"],[1,"row"],[1,"col"],[1,"position-relative"],["type","text","placeholder","Enter Message...","name","message",1,"form-control","chat-input",3,"ngModelChange","keypress","ngModel","disabled"],[1,"chat-input-links"],[1,"list-inline","mb-0"],[1,"list-inline-item"],["href","javascript: void(0);",1,"emoji-btn"],[1,"mdi","mdi-emoticon-happy-outline"],["href","javascript: void(0);"],[1,"mdi","mdi-file-image-outline"],[1,"mdi","mdi-file-document-outline"],[1,"col-auto"],["type","button",1,"btn","btn-primary","btn-rounded","chat-send","w-md",3,"click","disabled"],["class","d-none d-sm-inline-block me-2",4,"ngIf"],["class","spinner-border spinner-border-sm me-2",4,"ngIf"],[1,"mdi","mdi-send"],[1,"ai-conversations-sidebar"],[1,"conversations-header"],[1,"mb-0"],[1,"btn","btn-sm","btn-light",3,"click"],[1,"ri-close-line"],[1,"conversations-list"],["class","conversation-item",3,"active","click",4,"ngFor","ngForOf"],["class","no-conversations",4,"ngIf"],[1,"loading-container"],["role","status",1,"spinner-border","spinner-border-sm","text-primary"],[1,"visually-hidden"],[1,"text-muted","ms-2"],[1,"date-separator"],[1,"date-label"],["class","message-container",4,"ngFor","ngForOf","ngForTrackBy"],[1,"message-container"],["class","date-separator",4,"ngIf"],[1,"message-row"],["class","message-avatar",4,"ngIf"],[1,"message-bubble"],["class","message-sender",4,"ngIf"],[1,"message-text",3,"innerHTML"],[1,"message-time"],["class","message-status",4,"ngIf"],["class","message-options",4,"ngIf"],[1,"message-avatar"],[1,"avatar-circle"],["class","ri-user-3-line text-white",4,"ngIf"],["class","ri-robot-2-line text-white",4,"ngIf"],[1,"ri-user-3-line","text-white"],[1,"ri-robot-2-line","text-white"],[1,"message-sender"],[1,"message-status"],["class","status-sending",4,"ngIf"],["class","status-failed",4,"ngIf"],["class","status-sent d-none",4,"ngIf"],[1,"status-sending"],[1,"ri-time-line","text-muted"],[1,"text-muted","ms-1"],[1,"status-failed"],[1,"ri-error-warning-line","text-danger"],[1,"text-danger","ms-1"],["title","Retry sending message",1,"btn","btn-sm","btn-link","text-primary","p-0","ms-2",3,"click"],[1,"ri-refresh-line"],[1,"status-sent","d-none"],[1,"ri-check-double-line","text-success"],[1,"message-options"],[1,"btn","btn-sm","btn-light"],[1,"ri-more-2-fill"],[1,"avatar-circle","bg-secondary"],[1,"d-none","d-sm-inline-block","me-2"],[1,"spinner-border","spinner-border-sm","me-2"],[1,"conversation-item",3,"click"],[1,"conversation-title"],[1,"conversation-meta"],[1,"no-conversations"],[1,"ri-chat-3-line","text-muted"],[1,"text-muted","mb-0"]],template:function(n,o){if(1&n){const s=e.RV6();e.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"button",5),e.nrm(5,"i",6),e.EFF(6,"Chat with Tax Consultant "),e.k0s()()(),e.j41(7,"div",7)(8,"div",8)(9,"div",9)(10,"div",10),e.nrm(11,"i",11),e.k0s(),e.nrm(12,"div",12),e.k0s(),e.j41(13,"div")(14,"h5",13),e.EFF(15,"Tax Consultant"),e.k0s(),e.j41(16,"small",14),e.EFF(17,"Available during business hours"),e.k0s()()(),e.j41(18,"div",15)(19,"button",16),e.nrm(20,"i",17),e.k0s(),e.j41(21,"button",16),e.nrm(22,"i",18),e.k0s(),e.j41(23,"button",19),e.nrm(24,"i",20),e.k0s()()()(),e.j41(25,"div",21,0),e.DNE(27,Te,6,0,"div",22)(28,Xe,6,3,"div",23),e.j41(29,"div",24)(30,"div",25)(31,"div",26)(32,"div",27)(33,"input",28),e.mxI("ngModelChange",function(d){return e.eBV(s),e.DH7(o.newMessage,d)||(o.newMessage=d),e.Njj(d)}),e.bIt("keypress",function(d){return e.eBV(s),e.Njj(o.onKeyPress(d))}),e.k0s(),e.j41(34,"div",29)(35,"ul",30)(36,"li",31)(37,"a",32),e.nrm(38,"i",33),e.k0s()(),e.j41(39,"li",31)(40,"a",34),e.nrm(41,"i",35),e.k0s()(),e.j41(42,"li",31)(43,"a",34),e.nrm(44,"i",36),e.k0s()()()()()(),e.j41(45,"div",37)(46,"button",38),e.bIt("click",function(){return e.eBV(s),e.Njj(o.sendMessage())}),e.DNE(47,Je,2,0,"span",39)(48,He,1,0,"span",40),e.nrm(49,"i",41),e.k0s()()()()(),e.j41(50,"div",42)(51,"div",43)(52,"h6",44),e.EFF(53,"AI Conversations"),e.k0s(),e.j41(54,"button",45),e.bIt("click",function(){return e.eBV(s),e.Njj(o.hideConversations())}),e.nrm(55,"i",46),e.k0s()(),e.j41(56,"div",47),e.DNE(57,qe,6,5,"div",48)(58,Qe,4,0,"div",49),e.k0s()()()}2&n&&(e.R7$(27),e.Y8G("ngIf",!o.isInitialized),e.R7$(),e.Y8G("ngIf",o.isInitialized),e.R7$(5),e.R50("ngModel",o.newMessage),e.Y8G("disabled",o.isLoading),e.R7$(13),e.Y8G("disabled",!o.newMessage.trim()||o.isLoading),e.R7$(),e.Y8G("ngIf",!o.isLoading),e.R7$(),e.Y8G("ngIf",o.isLoading),e.R7$(2),e.AVh("show",o.showConversationsList&&"ai"===o.chatMode),e.R7$(7),e.Y8G("ngForOf",o.aiConversations),e.R7$(),e.Y8G("ngIf",0===o.aiConversations.length))},dependencies:[m.Sq,m.bT,a.me,a.BC,a.vS],styles:['[_nghost-%COMP%]{display:block;height:100vh;overflow:hidden}.chat-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100vh;background:#fff;border-radius:12px;box-shadow:0 4px 20px #0000001a;overflow:hidden}.chat-header-section[_ngcontent-%COMP%]{position:sticky;top:0;z-index:10;background:#fff;padding:16px 20px;border-bottom:1px solid #f0f0f0;flex-shrink:0}.chat-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;background:#fff}.avatar-container[_ngcontent-%COMP%]{position:relative}.avatar-circle[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:16px}.bg-gradient-ai[_ngcontent-%COMP%]{background:linear-gradient(135deg,#28a745,#20c997)}.chat-mode-toggle[_ngcontent-%COMP%]   .btn-group[_ngcontent-%COMP%]{box-shadow:0 2px 4px #0000001a;border-radius:8px;overflow:hidden}.chat-mode-toggle[_ngcontent-%COMP%]   .btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{border:none;padding:12px 20px;font-weight:500;transition:all .3s ease}.chat-mode-toggle[_ngcontent-%COMP%]   .btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:focus{box-shadow:none}.chat-mode-toggle[_ngcontent-%COMP%]   .btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:16px}.ai-conversations-sidebar[_ngcontent-%COMP%]{position:fixed;top:0;right:-350px;width:350px;height:100vh;background:#fff;border-left:1px solid #e9ecef;z-index:1050;transition:right .3s ease;overflow-y:auto}.ai-conversations-sidebar.show[_ngcontent-%COMP%]{right:0}.ai-conversations-sidebar[_ngcontent-%COMP%]   .conversations-header[_ngcontent-%COMP%]{padding:20px;border-bottom:1px solid #e9ecef;display:flex;justify-content:space-between;align-items:center;background:#f8f9fa}.ai-conversations-sidebar[_ngcontent-%COMP%]   .conversations-header[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{margin:0;font-weight:600;color:#495057}.ai-conversations-sidebar[_ngcontent-%COMP%]   .conversations-list[_ngcontent-%COMP%]{padding:10px}.ai-conversations-sidebar[_ngcontent-%COMP%]   .conversations-list[_ngcontent-%COMP%]   .conversation-item[_ngcontent-%COMP%]{padding:15px;border-radius:8px;margin-bottom:8px;cursor:pointer;transition:all .2s ease;border:1px solid transparent}.ai-conversations-sidebar[_ngcontent-%COMP%]   .conversations-list[_ngcontent-%COMP%]   .conversation-item[_ngcontent-%COMP%]:hover{background:#f8f9fa;border-color:#e9ecef}.ai-conversations-sidebar[_ngcontent-%COMP%]   .conversations-list[_ngcontent-%COMP%]   .conversation-item.active[_ngcontent-%COMP%]{background:#e3f2fd;border-color:#2196f3}.ai-conversations-sidebar[_ngcontent-%COMP%]   .conversations-list[_ngcontent-%COMP%]   .conversation-item[_ngcontent-%COMP%]   .conversation-title[_ngcontent-%COMP%]{font-weight:500;color:#495057;margin-bottom:5px;font-size:14px}.ai-conversations-sidebar[_ngcontent-%COMP%]   .conversations-list[_ngcontent-%COMP%]   .conversation-item[_ngcontent-%COMP%]   .conversation-meta[_ngcontent-%COMP%]{font-size:12px;color:#6c757d}.ai-conversations-sidebar[_ngcontent-%COMP%]   .conversations-list[_ngcontent-%COMP%]   .no-conversations[_ngcontent-%COMP%]{text-align:center;padding:40px 20px;color:#6c757d}.ai-conversations-sidebar[_ngcontent-%COMP%]   .conversations-list[_ngcontent-%COMP%]   .no-conversations[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:48px;margin-bottom:15px;display:block}.status-indicator[_ngcontent-%COMP%]{position:absolute;bottom:2px;right:2px;width:12px;height:12px;background:#10b981;border:2px solid #ffffff;border-radius:50%}.chat-title[_ngcontent-%COMP%]{font-weight:600;color:#1f2937;font-size:16px}.chat-actions[_ngcontent-%COMP%]{display:flex;gap:4px}.chat-messages[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:20px;background:#f9fafb;scroll-behavior:smooth}.date-separator[_ngcontent-%COMP%]{text-align:center;margin:20px 0;position:relative}.date-separator[_ngcontent-%COMP%]:before{content:"";position:absolute;top:50%;left:0;right:0;height:1px;background:#e5e7eb;z-index:1}.date-label[_ngcontent-%COMP%]{background:#f9fafb;color:#6b7280;padding:4px 12px;font-size:12px;font-weight:500;position:relative;z-index:2}.message-text[_ngcontent-%COMP%]{margin-bottom:5px;word-wrap:break-word;white-space:normal;line-height:1.6}.message-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:12px 0}.message-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:first-child{margin-top:0}.message-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:last-child{margin-bottom:0}.message-text[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%], .message-text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .message-text[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .message-text[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .message-text[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%], .message-text[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{margin:15px 0 8px;font-weight:600}.message-text[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.2em}.message-text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.1em}.message-text[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.05em}.message-text[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%], .message-text[_ngcontent-%COMP%]   ol[_ngcontent-%COMP%]{margin:8px 0;padding-left:20px}.message-text[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin:3px 0}.message-text[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{background-color:#0000001a;padding:2px 4px;border-radius:3px;font-family:Courier New,monospace;font-size:.9em}.message-text[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{background-color:#0000000d;padding:10px;border-radius:5px;overflow-x:auto;margin:8px 0}.message-text[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{background:none;padding:0}.message-text[_ngcontent-%COMP%]   blockquote[_ngcontent-%COMP%]{border-left:3px solid #ddd;margin:8px 0;padding-left:10px;font-style:italic}.message-text[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:600}.message-text[_ngcontent-%COMP%]   em[_ngcontent-%COMP%]{font-style:italic}.message-text[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{border-collapse:collapse;width:100%;margin:8px 0}.message-text[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .message-text[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid #ddd;padding:6px 8px;text-align:left}.message-text[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#0000000d;font-weight:600}.message-row[_ngcontent-%COMP%]{display:flex;align-items:flex-end;gap:8px;margin-bottom:12px}.message-sent[_ngcontent-%COMP%]{justify-content:flex-end}.message-received[_ngcontent-%COMP%]{justify-content:flex-start}.message-avatar[_ngcontent-%COMP%]{width:32px;height:32px;flex-shrink:0}.message-avatar[_ngcontent-%COMP%]   .avatar-circle[_ngcontent-%COMP%]{width:32px;height:32px;font-size:14px;box-shadow:0 2px 8px #00000026}.message-avatar[_ngcontent-%COMP%]   .bg-primary[_ngcontent-%COMP%]{background:#6366f1!important}.message-avatar[_ngcontent-%COMP%]   .bg-gradient-ai[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2)!important}.message-bubble[_ngcontent-%COMP%]{max-width:320px;padding:12px 16px;border-radius:18px;position:relative;word-wrap:break-word}.bubble-sent[_ngcontent-%COMP%]{background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff;border-bottom-right-radius:6px;border-bottom-left-radius:18px;box-shadow:0 2px 8px #6366f14d;margin-left:auto}.bubble-received[_ngcontent-%COMP%]{background:#fff;color:#1f2937;border:1px solid #e5e7eb;border-bottom-left-radius:6px}.bubble-ai[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border-bottom-left-radius:6px;border-bottom-right-radius:18px;box-shadow:0 2px 12px #667eea4d}.message-sender[_ngcontent-%COMP%]{font-size:12px;font-weight:600;color:#6366f1;margin-bottom:4px}.bubble-sent[_ngcontent-%COMP%]   .message-sender[_ngcontent-%COMP%]{color:#fffc}.bubble-ai[_ngcontent-%COMP%]   .message-sender[_ngcontent-%COMP%]{color:#ffffffe6}.message-text[_ngcontent-%COMP%]{line-height:1.4;font-size:14px}.message-time[_ngcontent-%COMP%]{font-size:11px;opacity:.7;margin-top:4px;text-align:right}.bubble-received[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]{color:#6b7280}.message-options[_ngcontent-%COMP%]{opacity:0;transition:opacity .2s}.message-row[_ngcontent-%COMP%]:hover   .message-options[_ngcontent-%COMP%]{opacity:1}.loading-container[_ngcontent-%COMP%]{text-align:center;padding:20px;color:#6b7280}.chat-input-section[_ngcontent-%COMP%]{border-top:1px solid #dee2e6;background:#fff;position:sticky;bottom:0;z-index:2;flex-shrink:0}.chat-input[_ngcontent-%COMP%]{border-radius:30px;background-color:#f8f9fa!important;border-color:#f8f9fa!important;padding:12px 120px 12px 20px;font-size:14px}.chat-input[_ngcontent-%COMP%]:focus{background-color:#f8f9fa!important;border-color:#6366f1!important;box-shadow:0 0 0 .2rem #6366f140}.chat-input[_ngcontent-%COMP%]::placeholder{color:#6c757d}.chat-input-links[_ngcontent-%COMP%]{position:absolute;right:16px;top:50%;transform:translateY(-50%)}.chat-input-links[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{font-size:16px;line-height:36px;padding:0 4px;display:inline-block;color:#6c757d;text-decoration:none}.chat-input-links[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#495057}.chat-send[_ngcontent-%COMP%]{border-radius:30px;padding:12px 20px;font-weight:500}@media (max-width: 575.98px){.chat-send[_ngcontent-%COMP%]{min-width:auto}}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:3px}.chat-messages[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#a8a8a8}@media (max-width: 768px){.chat-container[_ngcontent-%COMP%]{height:100vh;border-radius:0}.message-bubble[_ngcontent-%COMP%]{max-width:280px}.chat-header[_ngcontent-%COMP%]{padding:12px 16px}.chat-messages[_ngcontent-%COMP%]{padding:16px}.chat-input[_ngcontent-%COMP%]{padding:12px 16px}}.message-status[_ngcontent-%COMP%]{margin-top:4px;font-size:11px}.message-status[_ngcontent-%COMP%]   .status-sending[_ngcontent-%COMP%]{display:flex;align-items:center;opacity:.7}.message-status[_ngcontent-%COMP%]   .status-sending[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:12px}.message-status[_ngcontent-%COMP%]   .status-failed[_ngcontent-%COMP%]{display:flex;align-items:center}.message-status[_ngcontent-%COMP%]   .status-failed[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:12px}.message-status[_ngcontent-%COMP%]   .status-failed[_ngcontent-%COMP%]   .btn-link[_ngcontent-%COMP%]{font-size:11px;text-decoration:none}.message-status[_ngcontent-%COMP%]   .status-failed[_ngcontent-%COMP%]   .btn-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.message-status[_ngcontent-%COMP%]   .status-failed[_ngcontent-%COMP%]   .btn-link[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:10px}.message-status[_ngcontent-%COMP%]   .status-sent[_ngcontent-%COMP%]{display:flex;align-items:center;opacity:.6}.message-status[_ngcontent-%COMP%]   .status-sent[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:12px}.message-bubble.message-failed[_ngcontent-%COMP%]{border-left:3px solid #dc3545;background-color:#fff5f5}.bubble-sent.message-sending[_ngcontent-%COMP%]{opacity:.7;background-color:#f8f9fa}']})}}return i})();function Ke(i,r){1&i&&(e.j41(0,"div",1)(1,"div",2)(2,"div",6)(3,"div",7)(4,"div",8)(5,"span",9),e.EFF(6,"Loading..."),e.k0s()(),e.j41(7,"p",10),e.EFF(8,"Loading your projects..."),e.k0s()()()()())}function Ze(i,r){if(1&i&&(e.j41(0,"div",1)(1,"div",11)(2,"div",6)(3,"div",12)(4,"div",13)(5,"div",14)(6,"div")(7,"h5",15),e.EFF(8,"Active Projects"),e.k0s(),e.j41(9,"p",16),e.EFF(10),e.k0s()()(),e.j41(11,"div",17)(12,"div",18)(13,"span",19),e.nrm(14,"i",20),e.k0s()()()()()()(),e.j41(15,"div",11)(16,"div",6)(17,"div",12)(18,"div",13)(19,"div",14)(20,"div")(21,"h5",15),e.EFF(22,"Completed"),e.k0s(),e.j41(23,"p",16),e.EFF(24),e.k0s()()(),e.j41(25,"div",17)(26,"div",21)(27,"span",22),e.nrm(28,"i",23),e.k0s()()()()()()(),e.j41(29,"div",11)(30,"div",6)(31,"div",12)(32,"div",13)(33,"div",14)(34,"div")(35,"h5",15),e.EFF(36,"Total Projects"),e.k0s(),e.j41(37,"p",16),e.EFF(38),e.k0s()()(),e.j41(39,"div",17)(40,"div",24)(41,"span",25),e.nrm(42,"i",26),e.k0s()()()()()()()()),2&i){const t=e.XpG();e.R7$(10),e.SpI("",t.getActiveProjects().length," projects in progress"),e.R7$(14),e.SpI("",t.getCompletedProjects().length," projects finished"),e.R7$(14),e.SpI("",t.projects.length," projects overall")}}function et(i,r){if(1&i&&(e.j41(0,"p",45),e.EFF(1),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(),e.JRh(t.description)}}function tt(i,r){if(1&i&&(e.j41(0,"div",38),e.nrm(1,"i",46),e.j41(2,"span",39),e.EFF(3),e.k0s()()),2&i){const t=e.XpG().$implicit;e.R7$(3),e.SpI("Tax Year: ",t.taxYear,"")}}function nt(i,r){1&i&&(e.j41(0,"span",49),e.EFF(1,"(Overdue)"),e.k0s())}function ot(i,r){1&i&&(e.j41(0,"span",49),e.EFF(1,"(Due Soon)"),e.k0s())}function it(i,r){if(1&i&&(e.j41(0,"div",38),e.nrm(1,"i",47),e.j41(2,"span"),e.EFF(3),e.DNE(4,nt,2,0,"span",48)(5,ot,2,0,"span",48),e.k0s()()),2&i){const t=e.XpG().$implicit,n=e.XpG(3);e.R7$(2),e.HbH(n.isOverdue(t.dueDate)?"text-danger":n.isDueSoon(t.dueDate)?"text-warning":"text-muted"),e.R7$(),e.SpI(" Due: ",n.formatDate(t.dueDate)," "),e.R7$(),e.Y8G("ngIf",n.isOverdue(t.dueDate)),e.R7$(),e.Y8G("ngIf",n.isDueSoon(t.dueDate)&&!n.isOverdue(t.dueDate))}}function st(i,r){if(1&i&&(e.j41(0,"div",50)(1,"div",51)(2,"span",52),e.EFF(3,"Progress"),e.k0s(),e.j41(4,"span",52),e.EFF(5),e.k0s()(),e.j41(6,"div",53),e.nrm(7,"div",54),e.k0s()()),2&i){const t=e.XpG().$implicit,n=e.XpG(3);e.R7$(5),e.SpI("",n.getProjectProgress(t),"%"),e.R7$(2),e.HbH("completed"===t.status?"bg-success":"bg-primary"),e.xc7("width",n.getProjectProgress(t),"%")}}function rt(i,r){if(1&i){const t=e.RV6();e.j41(0,"div",31)(1,"div",32)(2,"div",12)(3,"div",33)(4,"div",34)(5,"h5",35),e.EFF(6),e.k0s(),e.DNE(7,et,2,1,"p",36),e.k0s(),e.j41(8,"span"),e.EFF(9),e.k0s()(),e.j41(10,"div",37)(11,"div",38),e.nrm(12,"i"),e.j41(13,"span",39),e.EFF(14),e.k0s()(),e.DNE(15,tt,4,1,"div",40)(16,it,6,5,"div",40),e.k0s(),e.DNE(17,st,8,5,"div",41),e.j41(18,"div",42)(19,"small",39),e.EFF(20),e.k0s(),e.j41(21,"button",43),e.bIt("click",function(){const o=e.eBV(t).$implicit,s=e.XpG(3);return e.Njj(s.viewProjectDetails(o))}),e.nrm(22,"i",44),e.EFF(23," View Details "),e.k0s()()()()()}if(2&i){const t=r.$implicit,n=e.XpG(3);e.R7$(6),e.JRh(t.name),e.R7$(),e.Y8G("ngIf",t.description),e.R7$(),e.HbH(n.getStatusClass(t.status)),e.R7$(),e.SpI(" ",n.getStatusLabel(t.status)," "),e.R7$(3),e.ZvI("",n.getTypeInfo(t.projectType).icon," me-2 text-muted"),e.R7$(2),e.JRh(n.getTypeInfo(t.projectType).label),e.R7$(),e.Y8G("ngIf",t.taxYear),e.R7$(),e.Y8G("ngIf",t.dueDate),e.R7$(),e.Y8G("ngIf","cancelled"!==t.status),e.R7$(3),e.SpI(" Created: ",n.formatDate(t.createdAt)," ")}}function at(i,r){if(1&i&&(e.j41(0,"div")(1,"div",1),e.DNE(2,rt,24,14,"div",30),e.k0s()()),2&i){const t=e.XpG(2);e.R7$(2),e.Y8G("ngForOf",t.projects)}}function ct(i,r){1&i&&(e.j41(0,"div",55)(1,"div",56),e.nrm(2,"i",57),e.k0s(),e.j41(3,"h5"),e.EFF(4,"No Projects Found"),e.k0s(),e.j41(5,"p",39),e.EFF(6,"You don't have any projects yet. Your accountant will create projects for you as needed."),e.k0s()())}function lt(i,r){if(1&i&&(e.j41(0,"div",1)(1,"div",2)(2,"div",6)(3,"div",12)(4,"h4",27),e.EFF(5,"All Projects"),e.k0s(),e.DNE(6,at,3,1,"div",28)(7,ct,7,0,"div",29),e.k0s()()()()),2&i){const t=e.XpG();e.R7$(6),e.Y8G("ngIf",t.projects.length>0),e.R7$(),e.Y8G("ngIf",0===t.projects.length)}}const dt=[{path:"",redirectTo:"dashboard",pathMatch:"full"},{path:"dashboard",loadComponent:()=>l.e(796).then(l.bind(l,8796)).then(i=>i.ClientDashboardComponent)},{path:"documents",component:Y},{path:"projects",component:(()=>{class i{constructor(t,n){this.router=t,this.apiService=n,this.destroy$=new v.B,this.projects=[],this.isLoading=!1,this.projectTypes=[{value:"tax_return",label:"Tax Return",icon:"bx-receipt"},{value:"quarterly_filing",label:"Quarterly Filing",icon:"bx-calendar"},{value:"business_setup",label:"Business Setup",icon:"bx-buildings"},{value:"audit",label:"Audit",icon:"bx-search-alt"},{value:"consultation",label:"Consultation",icon:"bx-chat"},{value:"other",label:"Other",icon:"bx-folder"}],this.projectStatuses=[{value:"active",label:"Active",class:"badge bg-success"},{value:"in_progress",label:"In Progress",class:"badge bg-primary"},{value:"completed",label:"Completed",class:"badge bg-info"},{value:"on_hold",label:"On Hold",class:"badge bg-warning"},{value:"cancelled",label:"Cancelled",class:"badge bg-danger"}]}ngOnInit(){this.loadMyProjects()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadMyProjects(){this.isLoading=!0,this.apiService.getMyProjects().pipe((0,h.Q)(this.destroy$)).subscribe({next:t=>{t.success&&t.projects&&(this.projects=t.projects),this.isLoading=!1},error:t=>{console.error("Error loading projects:",t),this.isLoading=!1,u().fire({title:"Error",text:"Failed to load your projects.",icon:"error"})}})}getStatusClass(t){const n=this.projectStatuses.find(o=>o.value===t);return n?n.class:"badge bg-secondary"}getStatusLabel(t){const n=this.projectStatuses.find(o=>o.value===t);return n?n.label:t}getTypeInfo(t){const n=this.projectTypes.find(o=>o.value===t);return n?{label:n.label,icon:n.icon}:{label:t,icon:"bx-folder"}}viewProject(t){this.router.navigate(["/client-portal/project-detail",t.id])}formatDate(t){return t?new Date(t).toLocaleDateString():"Not set"}getDaysUntilDue(t){if(!t)return 0;const n=new Date(t),o=new Date,s=n.getTime()-o.getTime();return Math.ceil(s/864e5)}isDueSoon(t){const n=this.getDaysUntilDue(t);return n>0&&n<=7}isOverdue(t){return this.getDaysUntilDue(t)<0}getActiveProjects(){return this.projects.filter(t=>"active"===t.status||"in_progress"===t.status)}getCompletedProjects(){return this.projects.filter(t=>"completed"===t.status)}getProjectProgress(t){switch(t.status){case"active":return 25;case"in_progress":return 60;case"completed":return 100;case"on_hold":return 40;default:return 0}}static{this.\u0275fac=function(n){return new(n||i)(e.rXU(_.Ix),e.rXU(C.G))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-client-projects"]],decls:9,vars:3,consts:[[1,"container-fluid"],[1,"row"],[1,"col-12"],[1,"page-title-box","d-sm-flex","align-items-center","justify-content-between"],[1,"mb-sm-0","font-size-18"],["class","row",4,"ngIf"],[1,"card"],[1,"card-body","text-center"],["role","status",1,"spinner-border","text-primary"],[1,"sr-only"],[1,"mt-2"],[1,"col-xl-4"],[1,"card-body"],[1,"d-flex"],[1,"flex-1","ms-3"],[1,"font-size-16","mb-1"],[1,"text-muted","mb-2"],[1,"flex-shrink-0","align-self-center"],[1,"avatar-sm","rounded-circle","bg-primary-subtle"],[1,"avatar-title","rounded-circle","bg-primary-subtle","text-primary"],[1,"bx","bx-briefcase","font-size-24"],[1,"avatar-sm","rounded-circle","bg-success-subtle"],[1,"avatar-title","rounded-circle","bg-success-subtle","text-success"],[1,"bx","bx-check-circle","font-size-24"],[1,"avatar-sm","rounded-circle","bg-info-subtle"],[1,"avatar-title","rounded-circle","bg-info-subtle","text-info"],[1,"bx","bx-folder","font-size-24"],[1,"card-title","mb-4"],[4,"ngIf"],["class","text-center py-5",4,"ngIf"],["class","col-lg-6 col-xl-4 mb-4",4,"ngFor","ngForOf"],[1,"col-lg-6","col-xl-4","mb-4"],[1,"card","project-card","h-100"],[1,"d-flex","justify-content-between","align-items-start","mb-3"],[1,"flex-1"],[1,"font-size-15","mb-1"],["class","text-muted mb-0",4,"ngIf"],[1,"project-details","mb-3"],[1,"d-flex","align-items-center","mb-2"],[1,"text-muted"],["class","d-flex align-items-center mb-2",4,"ngIf"],["class","mb-3",4,"ngIf"],[1,"d-flex","justify-content-between","align-items-center"],["type","button",1,"btn","btn-sm","btn-primary",3,"click"],[1,"bx","bx-show","me-1"],[1,"text-muted","mb-0"],[1,"bx","bx-calendar","me-2","text-muted"],[1,"bx","bx-time","me-2","text-muted"],["class","ms-1",4,"ngIf"],[1,"ms-1"],[1,"mb-3"],[1,"d-flex","justify-content-between","mb-1"],[1,"text-muted","small"],[1,"progress",2,"height","6px"],[1,"progress-bar"],[1,"text-center","py-5"],[1,"mb-4"],[1,"bx","bx-folder-open","display-4","text-muted"]],template:function(n,o){1&n&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h4",4),e.EFF(5,"My Projects"),e.k0s()()()(),e.DNE(6,Ke,9,0,"div",5)(7,Ze,43,3,"div",5)(8,lt,8,2,"div",5),e.k0s()),2&n&&(e.R7$(6),e.Y8G("ngIf",o.isLoading),e.R7$(),e.Y8G("ngIf",!o.isLoading&&o.projects.length>0),e.R7$(),e.Y8G("ngIf",!o.isLoading))},dependencies:[m.Sq,m.bT],styles:[".project-card[_ngcontent-%COMP%]{transition:transform .2s ease-in-out,box-shadow .2s ease-in-out;border:1px solid #e9ecef}.project-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 8px #0000001a}.avatar-sm[_ngcontent-%COMP%]{height:2rem;width:2rem}.avatar-title[_ngcontent-%COMP%]{align-items:center;background-color:#556ee6;color:#fff;display:flex;font-weight:500;height:100%;justify-content:center;width:100%}.bg-primary-subtle[_ngcontent-%COMP%]{background-color:#556ee61a!important}.bg-success-subtle[_ngcontent-%COMP%]{background-color:#34c38f1a!important}.bg-info-subtle[_ngcontent-%COMP%]{background-color:#50a5f11a!important}.badge[_ngcontent-%COMP%]{font-size:.75rem;padding:.25rem .5rem}.progress[_ngcontent-%COMP%], .progress-bar[_ngcontent-%COMP%]{border-radius:.25rem}.project-details[_ngcontent-%COMP%]{font-size:.875rem}.text-danger[_ngcontent-%COMP%]{color:#dc3545!important}.text-warning[_ngcontent-%COMP%]{color:#ffc107!important}.spinner-border[_ngcontent-%COMP%]{width:3rem;height:3rem}.display-4[_ngcontent-%COMP%]{font-size:3.5rem}.card-title[_ngcontent-%COMP%]{color:#495057;font-weight:600}.btn-sm[_ngcontent-%COMP%]{padding:.25rem .75rem;font-size:.875rem}"]})}}return i})()},{path:"project-detail/:projectId",loadComponent:()=>l.e(548).then(l.bind(l,6548)).then(i=>i.ProjectDetailComponent)},{path:"intake",component:J},{path:"tax-intake",component:je},{path:"chat",component:We}];let mt=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=e.$C({type:i})}static{this.\u0275inj=e.G2t({imports:[_.iI.forChild(dt),_.iI]})}}return i})();var ut=l(6551),pt=l(1745),gt=l(8580),ft=l(779),ht=l(3816);let _t=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=e.$C({type:i})}static{this.\u0275inj=e.G2t({imports:[m.MD,a.YN,a.X1,mt,ut.T,pt.V,gt.zE,ft.Q_,ht.jr,I._L]})}}return i})()}}]);