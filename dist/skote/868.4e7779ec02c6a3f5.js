"use strict";(self.webpackChunkskote=self.webpackChunkskote||[]).push([[868],{7868:(V,p,d)=>{d.r(p),d.d(p,{InvitationsModule:()=>B});var m=d(177),r=d(9417),v=d(803),g=d(6551),u=d(779),t=d(4438),f=d(6344);const h=["resendInvitationModal"],_=(e,a)=>a.value,I=(e,a)=>a.id;function b(e,a){if(1&e&&(t.j41(0,"option",56),t.EFF(1),t.k0s()),2&e){const n=a.$implicit;t.Y8G("value",n.value),t.R7$(),t.JRh(n.label)}}function F(e,a){1&e&&(t.j41(0,"div",31)(1,"div",57)(2,"span",58),t.EFF(3,"Loading..."),t.k0s()(),t.j41(4,"p",59),t.EFF(5,"Loading invitations..."),t.k0s()())}function C(e,a){if(1&e&&(t.j41(0,"div",60),t.nrm(1,"i",61),t.EFF(2),t.k0s()),2&e){const n=t.XpG();t.R7$(2),t.SpI("",n.error," ")}}function M(e,a){if(1&e&&(t.EFF(0),t.nI1(1,"date")),2&e){const n=t.XpG().$implicit;t.SpI(" ",t.i5U(1,1,n.invitedAt,"medium")," ")}}function x(e,a){1&e&&(t.j41(0,"span",52),t.EFF(1,"-"),t.k0s())}function k(e,a){if(1&e&&(t.j41(0,"span",68),t.EFF(1),t.nI1(2,"date"),t.k0s()),2&e){const n=t.XpG().$implicit;t.Y8G("ngClass","expired"===n.status?"text-danger":"text-muted"),t.R7$(),t.SpI(" ",t.i5U(2,2,n.expiresAt,"medium")," ")}}function j(e,a){1&e&&(t.j41(0,"span",52),t.EFF(1,"-"),t.k0s())}function E(e,a){if(1&e&&(t.EFF(0),t.nI1(1,"date")),2&e){const n=t.XpG().$implicit;t.SpI(" ",t.i5U(1,1,n.acceptedAt,"medium")," ")}}function R(e,a){1&e&&(t.j41(0,"span",52),t.EFF(1,"-"),t.k0s())}function y(e,a){if(1&e){const n=t.RV6();t.j41(0,"button",69),t.bIt("click",function(){t.eBV(n);const i=t.XpG().$implicit,l=t.XpG(2);return t.Njj(l.openResendModal(i))}),t.nrm(1,"i",70),t.EFF(2,"Resend Invitation "),t.k0s()}}function T(e,a){if(1&e){const n=t.RV6();t.j41(0,"tr")(1,"td")(2,"a",65),t.bIt("click",function(){const i=t.eBV(n).$implicit,l=t.XpG(2);return t.Njj(l.viewClientDetail(i))}),t.EFF(3),t.k0s()(),t.j41(4,"td"),t.EFF(5),t.k0s(),t.j41(6,"td")(7,"span",47),t.EFF(8),t.k0s()(),t.j41(9,"td"),t.DNE(10,M,2,4)(11,x,2,0),t.k0s(),t.j41(12,"td"),t.DNE(13,k,3,5,"span")(14,j,2,0),t.k0s(),t.j41(15,"td"),t.DNE(16,E,2,4)(17,R,2,0),t.k0s(),t.j41(18,"td")(19,"div",66),t.DNE(20,y,3,0,"button",67),t.k0s()()()}if(2&e){const n=a.$implicit,o=t.XpG(2);t.R7$(3),t.SpI(" ",n.clientName," "),t.R7$(2),t.JRh(n.email),t.R7$(2),t.Y8G("ngClass",o.getInvitationStatusClass(n.status)),t.R7$(),t.SpI(" ",o.getInvitationStatusText(n.status)," "),t.R7$(2),t.vxM(10,n.invitedAt?10:11),t.R7$(3),t.vxM(13,n.expiresAt?13:14),t.R7$(3),t.vxM(16,n.acceptedAt?16:17),t.R7$(4),t.vxM(20,o.canResendInvitation(n)?20:-1)}}function S(e,a){1&e&&t.EFF(0," No invitations found. Start by inviting clients from the client list. ")}function $(e,a){if(1&e&&t.EFF(0),2&e){const n=t.XpG(3);t.SpI(" No ",n.statusFilter," invitations found. ")}}function N(e,a){if(1&e&&(t.j41(0,"tr")(1,"td",71)(2,"div",52),t.nrm(3,"i",72),t.DNE(4,S,1,0)(5,$,1,1),t.k0s()()()),2&e){const n=t.XpG(2);t.R7$(4),t.vxM(4,"all"===n.statusFilter?4:5)}}function w(e,a){if(1&e&&(t.j41(0,"div",62)(1,"table",63)(2,"thead",64)(3,"tr")(4,"th"),t.EFF(5,"Client Name"),t.k0s(),t.j41(6,"th"),t.EFF(7,"Email"),t.k0s(),t.j41(8,"th"),t.EFF(9,"Status"),t.k0s(),t.j41(10,"th"),t.EFF(11,"Sent Date"),t.k0s(),t.j41(12,"th"),t.EFF(13,"Expires Date"),t.k0s(),t.j41(14,"th"),t.EFF(15,"Accepted Date"),t.k0s(),t.j41(16,"th"),t.EFF(17,"Actions"),t.k0s()()(),t.j41(18,"tbody"),t.Z7z(19,T,21,8,"tr",null,I,!1,N,6,1,"tr"),t.k0s()()()),2&e){const n=t.XpG();t.R7$(19),t.Dyx(n.filteredInvitations)}}function P(e,a){if(1&e&&(t.j41(0,"p",46)(1,"strong"),t.EFF(2,"Last Sent:"),t.k0s(),t.EFF(3),t.nI1(4,"date"),t.k0s()),2&e){const n=t.XpG();t.R7$(3),t.SpI(" ",t.i5U(4,1,null==n.selectedInvitation?null:n.selectedInvitation.invitedAt,"medium"),"")}}function G(e,a){1&e&&(t.nrm(0,"span",73),t.EFF(1," Resending... "))}function O(e,a){1&e&&(t.nrm(0,"i",70),t.EFF(1,"Resend Invitation "))}let D=(()=>{class e{constructor(n,o,i){this.apiService=n,this.router=o,this.formBuilder=i,this.invitations=[],this.filteredInvitations=[],this.searchTerm="",this.loading=!1,this.error="",this.statusFilter="all",this.statusOptions=[{value:"all",label:"All Invitations"},{value:"pending",label:"Pending"},{value:"sent",label:"Sent"},{value:"accepted",label:"Accepted"},{value:"expired",label:"Expired"}],this.selectedInvitation=null,this.resendLoading=!1,this.resendInvitationForm=this.formBuilder.group({emailTemplate:["Dear {clientName},\n\nYou have been invited to access our client portal. Please click the link below to get started:\n\n{invitationLink}\n\nThis invitation will expire on {expiryDate}.\n\nBest regards,\n{firmName}",[r.k0.required]]})}ngOnInit(){this.breadCrumbItems=[{label:"Invitations"},{label:"Invitation Management",active:!0}],this.loadInvitations()}loadInvitations(){this.loading=!0,this.error="",this.apiService.getInvitations().subscribe({next:n=>{console.log("Invitations API Response:",n),console.log("Response type:",typeof n),console.log("Response keys:",Object.keys(n||{})),n&&n.success&&n.invitations?(console.log("Invitations array:",n.invitations),console.log("Invitations count:",n.invitations.length),this.invitations=n.invitations,this.applyFilters()):(console.warn("No invitations found in response or response format unexpected"),this.invitations=[],this.filteredInvitations=[]),this.loading=!1},error:n=>{console.error("Error loading invitations:",n),this.error="Failed to load invitations. Please try again.",this.loading=!1,(401===n.status||403===n.status)&&(this.error="Authentication failed. Please log in again.")}})}applyFilters(){let n=[...this.invitations];if("all"!==this.statusFilter&&(n=n.filter(o=>o.status===this.statusFilter)),this.searchTerm.trim()){const o=this.searchTerm.toLowerCase();n=n.filter(i=>i.clientName?.toLowerCase().includes(o)||i.email?.toLowerCase().includes(o))}this.filteredInvitations=n}onSearchChange(){this.applyFilters()}onStatusFilterChange(){this.applyFilters()}canResendInvitation(n){return"pending"===n.status||"expired"===n.status}resendInvitation(n){console.log("Sending invitation to:",n.clientName),n.id?confirm(`Send invitation email to ${n.clientName||n.email}?`)&&this.apiService.resendInvitation(n.id).subscribe({next:o=>{o.success&&(this.loadInvitations(),console.log("Invitation sent successfully!"),alert(`Invitation email sent successfully to ${n.clientName||n.email}!`))},error:o=>{console.error("Error sending invitation:",o),alert("Failed to send invitation email. Please try again.")}}):console.error("No invitation ID provided")}viewClientDetail(n){n.clientId&&this.router.navigate(["/clients/detail",n.clientId])}getInvitationStatusClass(n){switch(n){case"pending":return"bg-warning";case"sent":return"bg-info";case"accepted":return"bg-success";case"expired":return"bg-danger";default:return"bg-secondary"}}getInvitationStatusText(n){switch(n){case"pending":return"Pending";case"sent":return"Sent";case"accepted":return"Accepted";case"expired":return"Expired";default:return"Unknown"}}openResendModal(n){this.selectedInvitation=n,this.resendInvitationModal?.show()}sendInvitationFromModal(){this.selectedInvitation?.id?(this.resendLoading=!0,this.apiService.resendInvitation(this.selectedInvitation.id).subscribe({next:n=>{n.success&&(this.loadInvitations(),console.log("Invitation sent successfully!"),alert(`Invitation email sent successfully to ${this.selectedInvitation?.clientName||this.selectedInvitation?.email}!`),this.resendInvitationModal?.hide(),this.selectedInvitation=null),this.resendLoading=!1},error:n=>{console.error("Error sending invitation:",n),alert("Failed to send invitation email. Please try again."),this.resendLoading=!1}})):console.error("No invitation selected")}getInvitationStats(){return{total:this.invitations.length,pending:this.invitations.filter(s=>"pending"===s.status).length,sent:this.invitations.filter(s=>"sent"===s.status).length,accepted:this.invitations.filter(s=>"accepted"===s.status).length,expired:this.invitations.filter(s=>"expired"===s.status).length}}static{this.\u0275fac=function(o){return new(o||e)(t.rXU(f.G),t.rXU(v.Ix),t.rXU(r.ok))}}static{this.\u0275cmp=t.VBU({type:e,selectors:[["app-invitation-management"]],viewQuery:function(o,i){if(1&o&&t.GBs(h,5),2&o){let l;t.mGM(l=t.lsd())&&(i.resendInvitationModal=l.first)}},standalone:!0,features:[t.aNF],decls:120,vars:26,consts:[["resendInvitationModal","bs-modal"],[1,"container-fluid"],["title","Invitation Management",3,"breadcrumbItems"],[1,"row","mb-4"],[1,"col-xl-3","col-md-6"],[1,"card"],[1,"card-body"],[1,"d-flex"],[1,"flex-1","overflow-hidden"],[1,"text-truncate","font-size-14","mb-2"],[1,"mb-0"],[1,"text-primary"],[1,"bx","bx-mail-send","font-size-24"],[1,"text-warning"],[1,"bx","bx-time-five","font-size-24"],[1,"text-success"],[1,"bx","bx-check-circle","font-size-24"],[1,"text-danger"],[1,"bx","bx-x-circle","font-size-24"],[1,"row"],[1,"col-lg-12"],[1,"row","mb-2"],[1,"col-sm-4"],[1,"search-box","me-2","mb-2","d-inline-block"],[1,"position-relative"],["type","text","id","searchTableList","placeholder","Search invitations...",1,"form-control",3,"ngModelChange","ngModel"],[1,"bx","bx-search-alt","search-icon"],[1,"form-select",3,"ngModelChange","ngModel"],[1,"text-sm-end"],["type","button",1,"btn","btn-success","btn-rounded","waves-effect","waves-light","mb-2",3,"click","disabled"],[1,"mdi","mdi-refresh","me-1"],[1,"text-center","py-4"],["bsModal","","id","resendInvitationModal","tabindex","-1","aria-labelledby","resendInvitationModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-dialog-centered","modal-lg"],[1,"modal-content"],[1,"modal-header"],["id","resendInvitationModalLabel",1,"modal-title"],[1,"bx","bx-mail-send","me-2"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],["autocomplete","off","novalidate","",1,"needs-validation",3,"ngSubmit","formGroup"],[1,"col-12"],[1,"card","bg-light"],[1,"card-body","p-3"],[1,"card-title","mb-2"],[1,"col-md-6"],[1,"mb-1"],[1,"badge",3,"ngClass"],[1,"mb-3"],["for","resend-template-input",1,"form-label"],["id","resend-template-input","rows","8","formControlName","emailTemplate","placeholder","Customize the invitation email...",1,"form-control"],[1,"form-text"],[1,"text-muted"],[1,"text-end"],["type","button",1,"btn","btn-outline-secondary","me-2",3,"click","disabled"],["type","submit",1,"btn","btn-warning",3,"disabled"],[3,"value"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-2","text-muted"],["role","alert",1,"alert","alert-danger"],[1,"bx","bx-error-circle","me-2"],[1,"table-responsive"],[1,"table","table-nowrap","align-middle"],[1,"table-light"],["href","javascript:void(0)","title","View client details",1,"text-primary","fw-medium",3,"click"],[1,"d-flex","gap-2"],["type","button","title","Resend Invitation Email",1,"btn","btn-sm","btn-outline-warning"],[3,"ngClass"],["type","button","title","Resend Invitation Email",1,"btn","btn-sm","btn-outline-warning",3,"click"],[1,"bx","bx-refresh","me-1"],["colspan","7",1,"text-center","py-4"],[1,"bx","bx-mail-send","font-size-48","text-muted","d-block","mb-2"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-2"]],template:function(o,i){if(1&o){const l=t.RV6();t.j41(0,"div",1),t.nrm(1,"app-page-title",2),t.j41(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6)(6,"div",7)(7,"div",8)(8,"p",9),t.EFF(9,"Total Invitations"),t.k0s(),t.j41(10,"h4",10),t.EFF(11),t.k0s()(),t.j41(12,"div",11),t.nrm(13,"i",12),t.k0s()()()()(),t.j41(14,"div",4)(15,"div",5)(16,"div",6)(17,"div",7)(18,"div",8)(19,"p",9),t.EFF(20,"Pending"),t.k0s(),t.j41(21,"h4",10),t.EFF(22),t.k0s()(),t.j41(23,"div",13),t.nrm(24,"i",14),t.k0s()()()()(),t.j41(25,"div",4)(26,"div",5)(27,"div",6)(28,"div",7)(29,"div",8)(30,"p",9),t.EFF(31,"Accepted"),t.k0s(),t.j41(32,"h4",10),t.EFF(33),t.k0s()(),t.j41(34,"div",15),t.nrm(35,"i",16),t.k0s()()()()(),t.j41(36,"div",4)(37,"div",5)(38,"div",6)(39,"div",7)(40,"div",8)(41,"p",9),t.EFF(42,"Expired"),t.k0s(),t.j41(43,"h4",10),t.EFF(44),t.k0s()(),t.j41(45,"div",17),t.nrm(46,"i",18),t.k0s()()()()()(),t.j41(47,"div",19)(48,"div",20)(49,"div",5)(50,"div",6)(51,"div",21)(52,"div",22)(53,"div",23)(54,"div",24)(55,"input",25),t.mxI("ngModelChange",function(s){return t.eBV(l),t.DH7(i.searchTerm,s)||(i.searchTerm=s),t.Njj(s)}),t.bIt("ngModelChange",function(){return t.eBV(l),t.Njj(i.onSearchChange())}),t.k0s(),t.nrm(56,"i",26),t.k0s()()(),t.j41(57,"div",22)(58,"select",27),t.mxI("ngModelChange",function(s){return t.eBV(l),t.DH7(i.statusFilter,s)||(i.statusFilter=s),t.Njj(s)}),t.bIt("ngModelChange",function(){return t.eBV(l),t.Njj(i.onStatusFilterChange())}),t.Z7z(59,b,2,2,"option",null,_),t.k0s()(),t.j41(61,"div",22)(62,"div",28)(63,"button",29),t.bIt("click",function(){return t.eBV(l),t.Njj(i.loadInvitations())}),t.nrm(64,"i",30),t.EFF(65," Refresh "),t.k0s()()()(),t.DNE(66,F,6,0,"div",31)(67,C,3,1)(68,w,22,1),t.k0s()()()()(),t.j41(69,"div",32,0)(71,"div",33)(72,"div",34)(73,"div",35)(74,"h5",36),t.nrm(75,"i",37),t.EFF(76,"Send Client Invitation "),t.k0s(),t.j41(77,"button",38),t.bIt("click",function(){t.eBV(l);const s=t.sdS(70);return t.Njj(s.hide())}),t.k0s()(),t.j41(78,"div",39)(79,"form",40),t.bIt("ngSubmit",function(){return t.eBV(l),t.Njj(i.sendInvitationFromModal())}),t.j41(80,"div",3)(81,"div",41)(82,"div",42)(83,"div",43)(84,"h6",44),t.EFF(85,"Client Information"),t.k0s(),t.j41(86,"div",19)(87,"div",45)(88,"p",46)(89,"strong"),t.EFF(90,"Name:"),t.k0s(),t.EFF(91),t.k0s(),t.j41(92,"p",46)(93,"strong"),t.EFF(94,"Email:"),t.k0s(),t.EFF(95),t.k0s()(),t.j41(96,"div",45)(97,"p",46)(98,"strong"),t.EFF(99,"Status:"),t.k0s(),t.j41(100,"span",47),t.EFF(101),t.k0s()(),t.DNE(102,P,5,4,"p",46),t.k0s()()()()()(),t.j41(103,"div",19)(104,"div",41)(105,"div",48)(106,"label",49),t.EFF(107,"Email Template"),t.k0s(),t.nrm(108,"textarea",50),t.j41(109,"div",51)(110,"small",52),t.EFF(111),t.k0s()()()()(),t.j41(112,"div",19)(113,"div",41)(114,"div",53)(115,"button",54),t.bIt("click",function(){t.eBV(l);const s=t.sdS(70);return t.Njj(s.hide())}),t.EFF(116,"Cancel"),t.k0s(),t.j41(117,"button",55),t.DNE(118,G,2,0)(119,O,2,0),t.k0s()()()()()()()()()}2&o&&(t.R7$(),t.Y8G("breadcrumbItems",i.breadCrumbItems),t.R7$(10),t.JRh(i.getInvitationStats().total),t.R7$(11),t.JRh(i.getInvitationStats().pending),t.R7$(11),t.JRh(i.getInvitationStats().accepted),t.R7$(11),t.JRh(i.getInvitationStats().expired),t.R7$(11),t.R50("ngModel",i.searchTerm),t.R7$(3),t.R50("ngModel",i.statusFilter),t.R7$(),t.Dyx(i.statusOptions),t.R7$(4),t.Y8G("disabled",i.loading),t.R7$(3),t.vxM(66,i.loading?66:i.error?67:68),t.R7$(13),t.Y8G("formGroup",i.resendInvitationForm),t.R7$(12),t.SpI(" ",null==i.selectedInvitation?null:i.selectedInvitation.clientName,""),t.R7$(4),t.SpI(" ",null==i.selectedInvitation?null:i.selectedInvitation.email,""),t.R7$(5),t.Y8G("ngClass",i.getInvitationStatusClass(null==i.selectedInvitation?null:i.selectedInvitation.status)),t.R7$(),t.SpI(" ",i.getInvitationStatusText(null==i.selectedInvitation?null:i.selectedInvitation.status)," "),t.R7$(),t.vxM(102,null!=i.selectedInvitation&&i.selectedInvitation.invitedAt?102:-1),t.R7$(9),t.Ld(" Available variables: ","{","clientName","}",", ","{","firmName","}",", ","{","invitationLink","}",", ","{","expiryDate","}"," "),t.R7$(4),t.Y8G("disabled",i.resendLoading),t.R7$(2),t.Y8G("disabled",i.resendLoading),t.R7$(),t.vxM(118,i.resendLoading?118:119))},dependencies:[m.MD,m.YU,m.vh,r.YN,r.qT,r.xH,r.y7,r.me,r.wz,r.BC,r.cb,r.vS,r.X1,r.j4,r.JD,g.T,u.Q_,u.hZ],styles:[".search-box[_ngcontent-%COMP%]{position:relative}.search-box[_ngcontent-%COMP%]   .search-icon[_ngcontent-%COMP%]{position:absolute;top:50%;right:12px;transform:translateY(-50%);color:#74788d;font-size:16px}.card[_ngcontent-%COMP%]{box-shadow:0 .75rem 1.5rem #12263f08;border:1px solid #eff2f7}.card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{padding:1.5rem}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:600;color:#495057;border-top:none}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle;border-color:#eff2f7}.badge[_ngcontent-%COMP%]{font-size:.75rem;padding:.35em .65em}.badge.bg-warning[_ngcontent-%COMP%]{color:#212529}.btn-sm[_ngcontent-%COMP%]{padding:.25rem .5rem;font-size:.875rem}.font-size-14[_ngcontent-%COMP%]{font-size:14px!important}.font-size-24[_ngcontent-%COMP%]{font-size:24px!important}.font-size-48[_ngcontent-%COMP%]{font-size:48px!important}.text-truncate[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}@media (max-width: 768px){.table-responsive[_ngcontent-%COMP%]{font-size:.875rem}.btn-sm[_ngcontent-%COMP%]{padding:.2rem .4rem;font-size:.8rem}}.spinner-border[_ngcontent-%COMP%]{width:2rem;height:2rem}.card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);transition:transform .2s ease-in-out;box-shadow:0 1rem 2rem #12263f1a}"]})}}return e})();var z=d(964);const L=[{path:"",component:D,canActivate:[d(400).K],data:{role:"ACCOUNTANT"}},{path:"register/:token",component:z.I}];let X=(()=>{class e{static{this.\u0275fac=function(o){return new(o||e)}}static{this.\u0275mod=t.$C({type:e})}static{this.\u0275inj=t.G2t({imports:[v.iI.forChild(L),v.iI]})}}return e})(),B=(()=>{class e{static{this.\u0275fac=function(o){return new(o||e)}}static{this.\u0275mod=t.$C({type:e})}static{this.\u0275inj=t.G2t({imports:[m.MD,r.YN,r.X1,X]})}}return e})()}}]);