<div class="card h-100">
  <div class="card-header">
    <h4 class="card-title mb-0">Chat with Your Accountant</h4>
    <p class="text-muted mb-0">Get real-time support from your dedicated accounting team</p>
  </div>
  
  <div class="card-body d-flex flex-column p-0" style="height: 600px;">
    <!-- Messages Area -->
    <div class="flex-grow-1 overflow-auto p-3" #messagesContainer>
      <div *ngFor="let message of messages; let i = index">
        <!-- Date Separator -->
        <div *ngIf="shouldShowDateSeparator(i)" class="text-center my-3">
          <small class="text-muted bg-light px-2 py-1 rounded">{{formatDate(message.timestamp)}}</small>
        </div>
        
        <!-- Message -->
        <div class="d-flex mb-3" [class.justify-content-end]="isMyMessage(message)">
          <div class="message-wrapper" [class.client-message]="isMyMessage(message)" 
               [class.accountant-message]="message.senderType === 'ACCOUNTANT'"
               [class.ai-message]="isAIMessage(message)">
            
            <!-- Accountant/AI Avatar -->
            <div *ngIf="!isMyMessage(message)" class="avatar-sm me-2 flex-shrink-0">
              <div class="avatar-title text-white rounded-circle" 
                   [class.bg-primary]="message.senderType === 'ACCOUNTANT'"
                   [class.bg-info]="isAIMessage(message)">
                <i class="ri-user-line" *ngIf="message.senderType === 'ACCOUNTANT'"></i>
                <i class="ri-robot-line" *ngIf="isAIMessage(message)"></i>
              </div>
            </div>
            
            <!-- Message Content -->
            <div class="message-content" [class.client-content]="isMyMessage(message)" 
                 [class.accountant-content]="message.senderType === 'ACCOUNTANT'"
                 [class.ai-content]="isAIMessage(message)">
              <div class="message-header mb-1">
                <small class="text-muted">{{message.senderName}}</small>
                <small class="text-muted ms-2">{{formatTime(message.timestamp)}}</small>
              </div>
              <div class="message-body">
                {{message.content}}
              </div>
            </div>
            
            <!-- Client Avatar -->
            <div *ngIf="isMyMessage(message)" class="avatar-sm ms-2 flex-shrink-0">
              <div class="avatar-title bg-success text-white rounded-circle">
                <i class="ri-user-line"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Loading indicator -->
    <div *ngIf="isLoading" class="text-center p-3">
      <div class="spinner-border spinner-border-sm text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <small class="text-muted ms-2">Loading messages...</small>
    </div>

    <!-- Message Input -->
    <div class="border-top p-3">
      <div class="row g-2">
        <div class="col">
          <textarea class="form-control" rows="2" placeholder="Type your message... (Use @ai to get help from Tax AI Agent)" 
                    [(ngModel)]="newMessage" (keypress)="onKeyPress($event)"
                    [disabled]="isLoading"></textarea>
        </div>
        <div class="col-auto align-self-end">
          <button type="button" class="btn btn-primary" (click)="sendMessage()" 
                  [disabled]="!newMessage.trim() || isLoading">
            <i class="ri-send-plane-line"></i>
          </button>
        </div>
      </div>
      <small class="text-muted mt-1 d-block">Press Enter to send, Shift+Enter for new line. Type &#64;ai to get AI assistance.</small>
    </div>
  </div>
</div>

<!-- Chat Guidelines -->
<div class="card mt-3">
  <div class="card-body">
    <h6 class="card-title">Chat Guidelines</h6>
    <ul class="list-unstyled mb-0">
      <li class="mb-2"><i class="ri-time-line text-primary me-2"></i>Response time: Usually within 2-4 hours during business hours</li>
      <li class="mb-2"><i class="ri-calendar-line text-primary me-2"></i>Business hours: Monday-Friday, 9 AM - 6 PM EST</li>
      <li class="mb-2"><i class="ri-file-line text-primary me-2"></i>For document sharing, please use the Documents section</li>
      <li><i class="ri-phone-line text-primary me-2"></i>For urgent matters, please call: (555) 123-4567</li>
    </ul>
  </div>
</div>
