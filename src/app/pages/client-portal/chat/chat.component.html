<div class="chat-container">
  <!-- Chat Header -->
  <div class="chat-header">
    <div class="d-flex align-items-center">
      <div class="avatar-container me-3">
        <div class="avatar-circle bg-primary">
          <i class="ri-user-line text-white"></i>
        </div>
        <div class="status-indicator"></div>
      </div>
      <div>
        <h5 class="mb-0 chat-title">Sarah Johnson, CPA</h5>
        <small class="text-muted">Active now</small>
      </div>
    </div>
    <div class="chat-actions">
      <button class="btn btn-light btn-sm me-2">
        <i class="ri-search-line"></i>
      </button>
      <button class="btn btn-light btn-sm me-2">
        <i class="ri-settings-3-line"></i>
      </button>
      <button class="btn btn-light btn-sm">
        <i class="ri-more-2-line"></i>
      </button>
    </div>
  </div>
  
  <!-- Messages Area -->
  <div class="chat-messages" #messagesContainer>
    <!-- Date Separator -->
    <div class="date-separator">
      <span class="date-label">Today</span>
    </div>
    
    <div *ngFor="let message of messages; let i = index" class="message-container">
      <!-- Date Separator -->
      <div *ngIf="shouldShowDateSeparator(i)" class="date-separator">
        <span class="date-label">{{formatDate(message.timestamp)}}</span>
      </div>
      
      <!-- Message Bubble -->
      <div class="message-row" [class.message-sent]="isMyMessage(message)" [class.message-received]="!isMyMessage(message)">
        <!-- Avatar for received messages -->
        <div *ngIf="!isMyMessage(message)" class="message-avatar">
          <div class="avatar-circle" [class.bg-primary]="message.senderType === 'ACCOUNTANT'" [class.bg-info]="isAIMessage(message)">
            <i class="ri-user-line text-white" *ngIf="message.senderType === 'ACCOUNTANT'"></i>
            <i class="ri-robot-line text-white" *ngIf="isAIMessage(message)"></i>
          </div>
        </div>
        
        <!-- Message Bubble -->
        <div class="message-bubble" 
             [class.bubble-sent]="isMyMessage(message)"
             [class.bubble-received]="message.senderType === 'ACCOUNTANT'"
             [class.bubble-ai]="isAIMessage(message)">
          <div class="message-sender" *ngIf="!isMyMessage(message)">{{message.senderName}}</div>
          <div class="message-text">{{message.content}}</div>
          <div class="message-time">{{formatTime(message.timestamp)}}</div>
        </div>
        
        <!-- Message options -->
        <div class="message-options" *ngIf="!isMyMessage(message)">
          <button class="btn btn-sm btn-light">
            <i class="ri-more-2-fill"></i>
          </button>
        </div>
      </div>
    </div>
    
    <!-- Loading indicator -->
    <div *ngIf="isLoading" class="loading-container">
      <div class="spinner-border spinner-border-sm text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <small class="text-muted ms-2">Loading messages...</small>
    </div>
  </div>

  <!-- Message Input -->
  <div class="chat-input">
    <div class="input-container">
      <button class="btn btn-light attachment-btn">
        <i class="ri-emotion-line"></i>
      </button>
      <button class="btn btn-light attachment-btn">
        <i class="ri-attachment-2"></i>
      </button>
      <button class="btn btn-light attachment-btn">
        <i class="ri-file-line"></i>
      </button>
      <div class="input-wrapper">
        <textarea class="message-input" 
                  placeholder="Enter Message..." 
                  [(ngModel)]="newMessage" 
                  (keypress)="onKeyPress($event)"
                  [disabled]="isLoading"
                  rows="1"></textarea>
      </div>
      <button type="button" 
              class="btn send-btn" 
              (click)="sendMessage()" 
              [disabled]="!newMessage.trim() || isLoading">
        <i class="ri-send-plane-fill"></i>
      </button>
    </div>
  </div>
</div>

<!-- Chat Guidelines -->
<div class="card mt-3">
  <div class="card-body">
    <h6 class="card-title">Chat Guidelines</h6>
    <ul class="list-unstyled mb-0">
      <li class="mb-2"><i class="ri-time-line text-primary me-2"></i>Response time: Usually within 2-4 hours during business hours</li>
      <li class="mb-2"><i class="ri-calendar-line text-primary me-2"></i>Business hours: Monday-Friday, 9 AM - 6 PM EST</li>
      <li class="mb-2"><i class="ri-file-line text-primary me-2"></i>For document sharing, please use the Documents section</li>
      <li><i class="ri-phone-line text-primary me-2"></i>For urgent matters, please call: (555) 123-4567</li>
    </ul>
  </div>
</div>
