<div class="container-fluid">
  <app-page-title title="Read Email" [breadcrumbItems]="breadCrumbItems"></app-page-title>

  <div class="row">
    <div class="col-12">
      <div class="email-leftbar card">
        <button type="button" class="btn btn-danger btn-block" data-toggle="modal" data-target="#composemodal" (click)="open(content)">
          Compose
        </button>
        <div class="mail-list mt-4">
          <a [routerLink]="['../../inbox']" class="active"><i class="mdi mdi-email-outline me-2"></i> Inbox <span class="ms-1 float-end">(18)</span></a>
          <a [routerLink]="['../../inbox']"><i class="mdi mdi-star-outline me-2"></i>Starred</a>
          <a [routerLink]="['../../inbox']"><i class="mdi mdi-diamond-stone me-2"></i>Important</a>
          <a [routerLink]="['../../inbox']"><i class="mdi mdi-file-outline me-2"></i>Draft</a>
          <a [routerLink]="['../../inbox']"><i class="mdi mdi-email-check-outline me-2"></i>Sent Mail</a>
          <a [routerLink]="['../../inbox']"><i class="mdi mdi-trash-can-outline me-2"></i>Trash</a>
        </div>

        <h6 class="mt-4">Labels</h6>
        <div class="mail-list mt-1">
          <a href="javascript: void(0);"><span class="mdi mdi-arrow-right-drop-circle text-info float-end"></span>Theme Support</a>
          <a href="javascript: void(0);"><span class="mdi mdi-arrow-right-drop-circle text-warning float-end"></span>Freelance</a>
          <a href="javascript: void(0);"><span class="mdi mdi-arrow-right-drop-circle text-primary float-end"></span>Social</a>
          <a href="javascript: void(0);"><span class="mdi mdi-arrow-right-drop-circle text-danger float-end"></span>Friends</a>
          <a href="javascript: void(0);"><span class="mdi mdi-arrow-right-drop-circle text-success float-end"></span>Family</a>
        </div>

        <ng-template #content let-modal>
          <div class="modal-header">
            <h5 class="modal-title" id="composemodalTitle">New Message</h5>
            <button type="button" class="btn-close" (click)="modalRef?.hide()" aria-label="Close">
            </button>
          </div>
          <div class="modal-body">
            <form>
              <div class="mb-3">
                <input type="email" class="form-control" placeholder="To">
              </div>

              <div class="mb-3">
                <input type="text" class="form-control" placeholder="Subject">
              </div>
              <div class="mb-3">
                <!-- Editor -->
                <ngx-editor-menu [editor]="editor"> </ngx-editor-menu>
                <ngx-editor [editor]="editor" [ngModel]="html" [disabled]="false"
                  [placeholder]="'Type here...'"></ngx-editor>
                <!-- <ckeditor [editor]="Editor" data="<p>Content of the editor.</p>"></ckeditor> -->
              </div>

            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="modalRef?.hide()">Close</button>
            <button type="button" class="btn btn-primary">Send <i class="fab fa-telegram-plane ms-1"></i></button>
          </div>
        </ng-template>
      </div>

      <!-- Right Sidebar -->
      <div class="email-rightbar mb-3">

        <div class="card">
          <div class="btn-toolbar p-3" role="toolbar">
            <div class="btn-group me-2 mb-2 mb-sm-0">
              <button type="button" class="btn btn-primary"><i class="fa fa-inbox"></i></button>
              <button type="button" class="btn btn-primary"><i class="fa fa-exclamation-circle"></i></button>
              <button type="button" class="btn btn-primary"><i class="far fa-trash-alt"></i></button>
            </div>
            <div class="btn-group me-2 mb-2 mb-sm-0" dropdown>
              <button type="button" class="btn btn-primary dropdown-toggle" dropdownToggle data-toggle="dropdown" aria-expanded="false">
                <i class="fa fa-folder"></i> <i class="mdi mdi-chevron-down ms-1"></i>
              </button>
              <div class="dropdown-menu" *dropdownMenu>
                <a class="dropdown-item" href="javascript: void(0);">Updates</a>
                <a class="dropdown-item" href="javascript: void(0);">Social</a>
                <a class="dropdown-item" href="javascript: void(0);">Team Manage</a>
              </div>
            </div>
            <div class="btn-group me-2 mb-2 mb-sm-0" dropdown>
              <button type="button" class="btn btn-primary dropdown-toggle" dropdownToggle data-toggle="dropdown" aria-expanded="false">
                <i class="fa fa-tag"></i> <i class="mdi mdi-chevron-down ms-1"></i>
              </button>
              <div class="dropdown-menu" *dropdownMenu>
                <a class="dropdown-item" href="javascript: void(0);">Updates</a>
                <a class="dropdown-item" href="javascript: void(0);">Social</a>
                <a class="dropdown-item" href="javascript: void(0);">Team Manage</a>
              </div>
            </div>

            <div class="btn-group me-2 mb-2 mb-sm-0" dropdown>
              <button type="button" class="btn btn-primary dropdown-toggle" dropdownToggle data-toggle="dropdown" aria-expanded="false">
                More <i class="mdi mdi-dots-vertical ms-2"></i>
              </button>
              <div class="dropdown-menu" *dropdownMenu>
                <button type="button" class="dropdown-item">Mark as Unread</button>
                <a class="dropdown-item" href="javascript: void(0);">Mark as Important</a>
                <a class="dropdown-item" href="javascript: void(0);">Add to Tasks</a>
                <a class="dropdown-item" href="javascript: void(0);">Add Star</a>
                <a class="dropdown-item" href="javascript: void(0);">Mute</a>
              </div>
            </div>
          </div>

          <div class="card-body">
            <!-- Loading State -->
            <div *ngIf="isLoadingGmailMessage" class="text-center py-5">
              <div class="spinner-border text-primary mb-3" role="status">
                <span class="sr-only">Loading email details...</span>
              </div>
              <p class="text-muted">Loading email content...</p>
            </div>

            <!-- Email Content -->
            <div *ngIf="!isLoadingGmailMessage && gmailMessageDetails">
              <div class="d-flex mb-4">
                <div class="flex-shrink-0 me-3">
                  <div class="avatar-sm bg-primary rounded-circle d-flex align-items-center justify-content-center">
                    <i class="ri-user-line text-white"></i>
                  </div>
                </div>
                <div class="flex-grow-1">
                  <h5 class="font-size-14 mt-1">{{ gmailMessageDetails.fromName || 'Unknown Sender' }}</h5>
                  <small class="text-muted">{{ gmailMessageDetails.fromEmail }}</small>
                  <div class="mt-1">
                    <small class="text-muted">
                      <i class="ri-time-line me-1"></i>
                      {{ gmailMessageDetails.receivedAt | date:'medium' }}
                    </small>
                    <span *ngIf="gmailMessageDetails.hasAttachments" class="badge bg-info ms-2">
                      <i class="ri-attachment-line me-1"></i>Attachments
                    </span>
                    <span *ngIf="gmailMessageDetails.isStarred" class="text-warning ms-2">
                      <i class="ri-star-fill"></i>
                    </span>
                  </div>
                </div>
              </div>

              <h4 class="mt-0 font-size-16">{{ gmailMessageDetails.subject || 'No Subject' }}</h4>

              <!-- Email Labels -->
              <div class="mb-3" *ngIf="gmailMessageDetails.labels && gmailMessageDetails.labels.length > 0">
                <span *ngFor="let label of gmailMessageDetails.labels" 
                      class="badge bg-light text-dark me-1">{{ label }}</span>
              </div>

              <!-- Email Body -->
              <div class="email-content">
                <p>{{ gmailMessageDetails.snippet || gmailMessageDetails.bodyPreview }}</p>
              </div>

              <!-- Attachments Section (if any) -->
              <div *ngIf="gmailMessageDetails.hasAttachments" class="mt-4">
                <hr />
                <h6 class="mb-3">
                  <i class="ri-attachment-line me-2"></i>Attachments
                </h6>
                <div class="row">
                  <div class="col-xl-2 col-6">
                    <div class="card">
                      <div class="card-body text-center">
                        <i class="ri-file-line font-size-24 text-muted"></i>
                        <p class="mt-2 mb-1 font-size-12">Attachment</p>
                        <a href="javascript: void(0);" class="fw-medium" download>Download</a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Action Buttons -->
              <div class="mt-4">
                <a href="javascript: void(0);" class="btn btn-secondary me-2">
                  <i class="mdi mdi-reply"></i> Reply
                </a>
                <a href="javascript: void(0);" class="btn btn-light">
                  <i class="mdi mdi-reply-all"></i> Reply All
                </a>
              </div>
            </div>

            <!-- Fallback for when Gmail details are not available -->
            <div *ngIf="!isLoadingGmailMessage && !gmailMessageDetails && emailPreview" class="text-center py-4">
              <div class="text-muted">
                <i class="ri-mail-line font-size-48 mb-3 d-block"></i>
                <h5>Unable to load email details</h5>
                <p>Showing preview information:</p>
                <div class="text-start">
                  <h6>{{ emailPreview.subject }}</h6>
                  <p><strong>From:</strong> {{ emailPreview.title }}</p>
                  <p>{{ emailPreview.snippet }}</p>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
      <!-- card -->
    </div>
  </div>
</div>